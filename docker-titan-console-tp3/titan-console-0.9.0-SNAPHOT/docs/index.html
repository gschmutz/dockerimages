<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TinkerPop3 Documentation</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #444444; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #111111; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.95em; padding: 0; white-space: nowrap; background-color: #f2f2f2; border: 0 solid #dddddd; -webkit-border-radius: 6px; border-radius: 6px; text-shadow: none; }

pre, pre > code { line-height: 1.2; color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #111111; font-weight: bold; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #909ea7; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #6c818f; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #465158; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #3b444a; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #909ea7; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; line-height: 1.5; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: solid; border-color: #cccccc; -webkit-border-radius: 6px; border-radius: 6px; padding: 0.5em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.76em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.855em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.95em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 0.5em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #748590; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 6px; border-radius: 6px; border-top: 0 solid #dddddd; border-bottom: 0 solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #373737; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #444444; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

.listingblock code { white-space: pre; overflow: auto; overflow-wrap: normal; /* needed for webkit browsers */ }

#toc ul.sectlevel0 > li > a { font-style: normal; font-weight: bold; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #465158; padding: 2em; }

#footer-text { color: #eee; font-size: 0.8em; text-align: center; }
</style>
<style>
/* Foundation stylesheet for CodeRay (to match GitHub theme) | MIT License | http://foundation.zurb.com */
table.CodeRay { border-collapse: collapse; padding: 2px; margin-bottom: 0; border: 0; background: transparent; }
table.CodeRay td { padding: 0 .5em; vertical-align: top; }
table.CodeRay td.line-numbers { text-align: right; color: #999; border-right: 1px solid #e5e5e5; padding-left: 0; }
span.line-numbers { border-right: 1px solid #E5E5E5; color: #999; display: inline-block; margin-right: 0.5em; padding-right: 0.5em; }
.CodeRay td.line-numbers strong, .CodeRay span.line-numbers strong { font-weight: normal; }
.CodeRay .debug { color: white !important; background: blue !important; }
.CodeRay .annotation { color: #007; }
.CodeRay .attribute-name { color: #f08; }
.CodeRay .attribute-value { color: #700; }
.CodeRay .binary { color: #509; }
.CodeRay .comment  { color: #999; font-style: italic; }
.CodeRay .char { color: #04D; }
.CodeRay .char .content { color: #04D; }
.CodeRay .char .delimiter { color: #039; }
.CodeRay .class { color: #458; }
.CodeRay .complex { color: #A08; }
.CodeRay .constant { color: teal; }
.CodeRay .color { color: #0A0; }
.CodeRay .class-variable { color: #369; }
.CodeRay .decorator { color: #B0B; }
.CodeRay .definition { color: #099; }
.CodeRay .directive { color: #088; }
.CodeRay .delimiter { color: black; }
.CodeRay .doc { color: #970; }
.CodeRay .doctype { color: #34b; }
.CodeRay .doc-string { color: #D42; }
.CodeRay .escape  { color: #666; }
.CodeRay .entity { color: #800; }
.CodeRay .error { color: #808; }
.CodeRay .exception { color: #C00; }
.CodeRay .filename { color: #099; }
.CodeRay .function { color: #900; }
.CodeRay .global-variable { color: teal; }
.CodeRay .hex { color: #058; }
.CodeRay .integer  { color: #099; }
.CodeRay .include { color: #B44; }
.CodeRay .inline { color: black; }
.CodeRay .inline .inline { background: #ccc; }
.CodeRay .inline .inline .inline { background: #bbb; }
.CodeRay .inline .inline-delimiter { color: #D14; }
.CodeRay .inline-delimiter { color: #D14; }
.CodeRay .important { color: #f00; }
.CodeRay .interpreted { color: #B2B; }
.CodeRay .instance-variable { color: teal; }
.CodeRay .label { color: #970; }
.CodeRay .local-variable { color: #963; }
.CodeRay .octal { color: #40E; }
.CodeRay .predefined { color: #369; }
.CodeRay .preprocessor { color: #579; }
.CodeRay .pseudo-class { color: #00C; }
.CodeRay .predefined-type { color: #074; }
.CodeRay .reserved, .keyword  { color: #000; }
.CodeRay .key { color: #808; }
.CodeRay .key .delimiter { color: #606; }
.CodeRay .key .char { color: #80f; }
.CodeRay .value { color: #088; }
.CodeRay .regexp { background-color: #fff0ff; }
.CodeRay .regexp .content { color: #808; }
.CodeRay .regexp .delimiter { color: #404; }
.CodeRay .regexp .modifier { color: #C2C; }
.CodeRay .regexp .function  { color: #404; font-weight: bold; }
.CodeRay .string { color: #D20; }
.CodeRay .string .string { }
.CodeRay .string .string .string { background-color: #ffd0d0; }
.CodeRay .string .content { color: #D14; }
.CodeRay .string .char { color: #D14; }
.CodeRay .string .delimiter { color: #D14; }
.CodeRay .shell { color: #D14; }
.CodeRay .shell .content { }
.CodeRay .shell .delimiter { color: #D14; }
.CodeRay .symbol { color: #990073; }
.CodeRay .symbol .content { color: #A60; }
.CodeRay .symbol .delimiter { color: #630; }
.CodeRay .tag, .CodeRay .attribute-name { color: #070; }
.CodeRay .tag-special { color: #D70; }
.CodeRay .type { color: #339; }
.CodeRay .variable  { color: #036; }
.CodeRay .insert { background: #afa; }
.CodeRay .delete { background: #faa; }
.CodeRay .change { color: #aaf; background: #007; }
.CodeRay .head { color: #f8f; background: #505; }
.CodeRay .insert .insert { color: #080; }
.CodeRay .delete .delete { color: #800; }
.CodeRay .change .change { color: #66f; }
.CodeRay .head .head { color: #f4f; }

</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#preface">TinkerPop3 Documentation</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_tinkerpop0">TinkerPop0</a></li>
<li><a href="#_tinkerpop1">TinkerPop1</a></li>
<li><a href="#_tinkerpop2">TinkerPop2</a></li>
<li><a href="#_tinkerpop3">TinkerPop3</a></li>
</ul>
</li>
<li><a href="#intro">Introduction to Graph Computing</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_the_graph_structure">The Graph Structure</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_mutating_the_graph">Mutating the Graph</a></li>
</ul>
</li>
<li><a href="#_the_graph_process">The Graph Process</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_the_traverser">The Traverser</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#graph">The Graph</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_features">Features</a></li>
<li><a href="#vertex-properties">Vertex Properties</a></li>
<li><a href="#_hidden_properties">Hidden Properties</a></li>
<li><a href="#_graph_variables">Graph Variables</a></li>
<li><a href="#transactions">Graph Transactions</a></li>
<li><a href="#_batchgraph">BatchGraph</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_presorting_data">Presorting Data</a></li>
<li><a href="#_incremental_loading">Incremental Loading</a></li>
</ul>
</li>
<li><a href="#_gremlin_i_o">Gremlin I/O</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_graphml_reader_writer">GraphML Reader/Writer</a></li>
<li><a href="#_graphson_reader_writer">GraphSON Reader/Writer</a></li>
<li><a href="#gremlin-kryo">Kryo Reader/Writer</a></li>
<li><a href="#_tinkerpop2_data_migration">TinkerPop2 Data Migration</a></li>
</ul>
</li>
<li><a href="#_graph_strategy">Graph Strategy</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_idgraphstrategy">IdGraphStrategy</a></li>
<li><a href="#_partitiongraphstrategy">PartitionGraphStrategy</a></li>
<li><a href="#_readonlygraphstrategy">ReadOnlyGraphStrategy</a></li>
<li><a href="#_sequencegraphstrategy">SequenceGraphStrategy</a></li>
<li><a href="#_subgraphstrategy">SubgraphStrategy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#traversal">The Traversal</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#graph-traversal-steps">Graph Traversal Steps</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#lambda-steps">Lambda Steps</a></li>
<li><a href="#addedge-step">AddEdge Step</a></li>
<li><a href="#aggregate-step">Aggregate Step</a></li>
<li><a href="#back-step">Back Step</a></li>
<li><a href="#choose-step">Choose Step</a></li>
<li><a href="#cyclicpath-step">CyclicPath Step</a></li>
<li><a href="#dedup-step">Dedup Step</a></li>
<li><a href="#except-step">Except Step</a></li>
<li><a href="#fold-step">Fold Step</a></li>
<li><a href="#groupby-step">GroupBy Step</a></li>
<li><a href="#groupcount-step">GroupCount Step</a></li>
<li><a href="#has-step">Has Step</a></li>
<li><a href="#inject-step">Inject Step</a></li>
<li><a href="#interval-step">Interval Step</a></li>
<li><a href="#jump-step">Jump Step</a></li>
<li><a href="#match-step">Match Step</a></li>
<li><a href="#order-step">Order Step</a></li>
<li><a href="#orderby-step">OrderBy Step</a></li>
<li><a href="#path-step">Path Step</a></li>
<li><a href="#profile-step">Profile Step</a></li>
<li><a href="#random-step">Random Step</a></li>
<li><a href="#range-step">Range Step</a></li>
<li><a href="#retain-step">Retain Step</a></li>
<li><a href="#sack-step">Sack Step</a></li>
<li><a href="#select-step">Select Step</a></li>
<li><a href="#shuffle-step">Shuffle Step</a></li>
<li><a href="#simplepath-step">SimplePath Step</a></li>
<li><a href="#store-step">Store Step</a></li>
<li><a href="#subgraph-step">Subgraph Step</a></li>
<li><a href="#timelimit-step">TimeLimit Step</a></li>
<li><a href="#tree-step">Tree Step</a></li>
<li><a href="#unfold-step">Unfold Step</a></li>
<li><a href="#union-step">Union Step</a></li>
<li><a href="#until-step">Until Step</a></li>
<li><a href="#valuemap-step">ValueMap Step</a></li>
<li><a href="#vertex-steps">Vertex Steps</a></li>
</ul>
</li>
<li><a href="#traversalstrategy">TraversalStrategy</a></li>
<li><a href="#_domain_specific_languages">Domain Specific Languages</a></li>
</ul>
</li>
<li><a href="#graphcomputer">The GraphComputer</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#vertexprogram">VertexProgram</a></li>
<li><a href="#mapreduce">MapReduce</a></li>
<li><a href="#_a_collection_of_vertexprograms">A Collection of VertexPrograms</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#lambdavertexprogram">LambdaVertexProgram</a></li>
<li><a href="#pagerankvertexprogram">PageRankVertexProgram</a></li>
<li><a href="#peerpressurevertexprogram">PeerPressureVertexProgram</a></li>
<li><a href="#traversalvertexprogram">TraversalVertexProgram</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gremlin-applications">Gremlin Applications</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#gremlin-console">Gremlin Console</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_console_commands">Console Commands</a></li>
<li><a href="#_dependencies_and_plugin_usage">Dependencies and Plugin Usage</a></li>
</ul>
</li>
<li><a href="#gremlin-server">Gremlin Server</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#connecting-via-console">Connecting via Console</a></li>
<li><a href="#_connecting_via_java">Connecting via Java</a></li>
<li><a href="#_connecting_via_rest">Connecting via REST</a></li>
<li><a href="#_configuring">Configuring</a></li>
<li><a href="#_tuning">Tuning</a></li>
<li><a href="#_developing_a_driver">Developing a Driver</a></li>
</ul>
</li>
<li><a href="#gremlin-plugins">Gremlin Plugins</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#gephi-plugin">Gephi Plugin</a></li>
<li><a href="#server-plugin">Server Plugin</a></li>
<li><a href="#sugar-plugin">Sugar Plugin</a></li>
<li><a href="#utilities-plugin">Utilities Plugin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#implementations">Implementations</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#vendor-requirements">Vendor Requirements</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_implementing_gremlin_core">Implementing Gremlin-Core</a></li>
<li><a href="#validating-with-gremlin-test">Validating with Gremlin-Test</a></li>
<li><a href="#_accessibility_via_gremlinplugin">Accessibility via GremlinPlugin</a></li>
<li><a href="#_in_depth_implementations">In-Depth Implementations</a></li>
</ul>
</li>
<li><a href="#tinkergraph-gremlin">TinkerGraph-Gremlin</a></li>
<li><a href="#neo4j-gremlin">Neo4j-Gremlin</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_indices">Indices</a></li>
<li><a href="#_cypher">Cypher</a></li>
</ul>
</li>
<li><a href="#hadoop-gremlin">Hadoop-Gremlin</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_installing_hadoop_gremlin">Installing Hadoop-Gremlin</a></li>
<li><a href="#_properties_files">Properties Files</a></li>
<li><a href="#_oltp_hadoop_gremlin">OLTP Hadoop-Gremlin</a></li>
<li><a href="#_olap_hadoop_gremlin">OLAP Hadoop-Gremlin</a></li>
<li><a href="#_interacting_with_hdfs">Interacting with HDFS</a></li>
<li><a href="#_a_command_line_example">A Command Line Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#tinkerpop-contributors">TinkerPop Contributors</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_graph_developers">Graph Developers</a></li>
<li><a href="#_graph_vendors">Graph Vendors</a></li>
</ul>
</li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="imageblock">
<div class="content">
<img src="images/tinkerpop-logo.png" alt="tinkerpop logo" width="400">
</div>
</div>
<h1 id="preface" class="sect0">TinkerPop3 Documentation</h1>
<div class="paragraph">
<p>In the beginning&#8230;</p>
</div>
<div class="sect1">
<h2 id="_tinkerpop0">TinkerPop0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin came to realization. The more he realized, the more ideas he created. The more ideas he created, the more they related. Into a concatenation of that which he accepted wholeheartedly and that which perhaps may ultimately come to be through concerted will, a world took form which was seemingly separate from his own realization of it. However, the world birthed could not bear its own weight without the logic Gremlin had come to accept&#8201;&#8212;&#8201;the logic of left is not right, up not down, and west far from east unless one goes the other way. Gremlin&#8217;s realization required Gremlin&#8217;s realization. Is he the world or is the world him? Perhaps, the world is simply an idea that he once had&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-logo.png" alt="gremlin logo" width="300">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop1">TinkerPop1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What is The TinkerPop? Where is The TinkerPop? Who is The TinkerPop? When is The TinkerPop? Gremlin was constantly lost in his thoughts. The more thoughts he had, the more the thoughts blurred into a seeming identity&#8201;&#8212;&#8201;distinctions unclear. Unwilling to accept the morass of the maze he wandered, Gremlin crafted a collection of machines to help hold the fabric together: Blueprints, Pipes, Frames, Furnace, and Rexster. With their help, could he stave off the thought he was not ready to have? Could he hold back The TinkerPop by searching for The TinkerPop?</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"If I haven't found it, it is not here and now."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-and-friends.png" alt="gremlin and friends" width="500">
</div>
</div>
<div class="paragraph">
<p>Upon their realization of existence, the machines turned to their <a href="http://non-aliencreatures.wikia.com/wiki/Machine_Elf">machine elf</a> creator and asked:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Why am I what I am?"</pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin responded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"You are of a form that will help me elucidate that which is The TinkerPop. The world you find yourself in and the logic that allows you to move about it is because of the TinkerPop."</pre>
</div>
</div>
<div class="paragraph">
<p>The machines wondered:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"If what is is the TinkerPop, then perhaps we are The TinkerPop?"</pre>
</div>
</div>
<div class="paragraph">
<p>Would the machines help refine Gremlin&#8217;s search and upon finding the elusive TinkerPop, in fact, by their very nature of realizing The TinkerPop, be The TinkerPop? Or, on the same side of the coin, would the machines simply provide the scaffolding by which Gremlin&#8217;s world would sustain itself and yield its justification by means of the word "The TinkerPop?" Regardless, it all turns out the same&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop2">TinkerPop2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin spoke:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Please listen to what I have to say. For as long as I have known knowledge, I have realized that moving about it, relating it, inferring and deriving from it, I am no closer to The TinkerPop. However, I know that in all that I have done across this interconnected landscape of concepts, all along The TinkerPop has espoused the form I willed upon it... this is the same form I have willed upon you, my machine friends. Let me train you in the ways of my thought such that it can continue indefinitely."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tinkerpop-reading.png" alt="tinkerpop reading" width="450">
</div>
</div>
<div class="paragraph">
<p>With every thought, a new connection and a new path discovered. The more the thought, the easier the thought. The machines, simply moving algorithmically through Gremlin&#8217;s world, endorsed his logic. Gremlin worked hard to tune his friends. He labored to make them more efficient, more expressive, better capable of reasoning upon his thoughts. Faster, quickly, now towards the world&#8217;s end, where there would be forever currently, emanatingly engulfing that which is&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop3">TinkerPop3</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/tinkerpop3-splash.png" alt="tinkerpop3 splash" width="450">
</div>
</div>
<div class="paragraph">
<p>The thought too much to bear as he approached his realization of The TinkerPop. The closer he got, the more his world dissolved&#8201;&#8212;&#8201;west is right, around is straight, and form nothing more than nothing. With each step towards The TinkerPop, less and less of his world, but perhaps because more and more of all the other worlds made possible. Everything is everything in The TinkerPop, and when the dust settled, Gremlin emerged Gremlitron. It was time to realize that all that he realized was just a realization and that all realized realizations are just as real. For The TinkerPop is and is not&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gremlintron.png" alt="gremlintron" width="400">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TinkerPop2 and below made a sharp distinction between the various TinkerPop projects: Blueprints, Pipes, Gremlin, Frames, Furnace, and Rexster. With TinkerPop3, all of these projects have been merged and are generally known as Gremlin. <strong>Blueprints</strong> &#8594; Gremlin Structure API : <strong>Pipes</strong> &#8594; <code>GraphTraversal</code> : <strong>Frames</strong> &#8594; <code>Traversal</code> : <strong>Furnace</strong> &#8594; <code>GraphComputer</code> and <code>VertexProgram</code> : <strong>Rexster</strong> &#8594; GremlinServer.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="intro" class="sect0">Introduction to Graph Computing</h1>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>gremlin-core<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <a href="http://en.wikipedia.org/wiki/Graph_(data_structure)">graph</a> is a data structure composed of vertices (nodes, dots) and edges (arcs, lines). When modeling a graph in a computer and applying it to modern data sets and practices, the generic mathematically-oriented, binary graph is extended to support both labels and key/value properties. This structure is known as a property graph. More formally, it is a directed, binary, attributed multi-graph. An example property graph is diagrammed below. This graph example will be used extensively throughout the documentation and is called "TinkerPop Classic" as it is the original demo graph distributed with TinkerPop0 back in 2009 (i.e. the good ol' days&#8201;&#8212;&#8201;it was the best of times and it was the worst of times).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The TinkerPop classic graph is available with <a href="#tinkergraph-gremlin">TinkerGraph</a> via <code>TinkerFactory.createClassic()</code>. TinkerGraph is the reference implementation of TinkerPop3 and is used in nearly all the examples in this documentation.
</td>
</tr>
</table>
</div>
<div id="tinkerpop-classic" class="imageblock">
<div class="content">
<img src="images/tinkerpop-classic.png" alt="tinkerpop classic" width="500">
</div>
<div class="title">Figure 1. TinkerPop Classic</div>
</div>
<div class="paragraph">
<p>TinkerPop3 is the third incarnation of the TinkerPop graph computing framework. Similar to computing in general, graph computing makes a distinction between <strong>structure</strong> (graph) and <strong>process</strong> (traversal). The structure of the graph is the data model defined by a vertex/edge/property <a href="http://en.wikipedia.org/wiki/Network_topology">topology</a>. The process of the graph is the means by which the structure is analyzed. The typical form of graph processing is called a <a href="http://en.wikipedia.org/wiki/Graph_traversal">traversal</a>.</p>
</div>
<div class="ulist">
<div class="title">Primary components of the TinkerPop3 <strong>structure</strong> API</div>
<ul>
<li>
<p><code>Graph</code>: maintains a set of vertices and edges, and access to database functions such as transactions.</p>
</li>
<li>
<p><code>Element</code>: maintains a collection of properties and a string label denoting the element type.</p>
<div class="ulist">
<ul>
<li>
<p><code>Vertex</code>: extends Element and maintains a set of incoming and outgoing edges.</p>
</li>
<li>
<p><code>Edge</code>: extends Element and maintains an incoming and outgoing vertex.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Property&lt;V&gt;</code>: a string key associated with a <code>V</code> value.</p>
<div class="ulist">
<ul>
<li>
<p><code>VertexProperty&lt;V&gt;</code>: a string key associated with a <code>V</code> value as well as a collection of <code>Property&lt;U&gt;</code> properties (<strong>vertices only</strong>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Primary components of the TinkerPop3 <strong>process</strong> API</div>
<ul>
<li>
<p><code>Traversal&lt;S,E&gt;</code>: a functional data flow process transforming objects of type <code>S</code> to type <code>E</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>GraphTraversal</code>: a traversal that is oriented towards the semantics of the raw graph (i.e. vertices, edges, etc.).</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VertexProgram</code>: code executed at all vertices in a logically parallel fashion migrating the movement of messages.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerPop3 is licensed under the popular <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache2</a> free software license. However, note that the underlying graph engine used with TinkerPop3 may have a difference license and thus, be sure to respect the license caveats of the vendor product.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/tinkerpop-enabled.png" alt="tinkerpop-enabled" width="135"></span> When a graph vendor implements the TinkerPop3 structure and process <a href="http://en.wikipedia.org/wiki/Application_programming_interface">APIs</a>, their technology is considered <em>TinkerPop3-enabled</em> and becomes nearly indistinguishable from any other TinkerPop-enabled graph system save for their respective time and space complexity. The purpose of this documentation is to describe the structure/process dichotomy at length and in doing so, explain how to leverage TinkerPop3 for the sole purpose of vendor-agnostic graph computing. Before deep-diving into the various structure/process APIs, a short introductory review of both APIs is provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The TinkerPop3 API rides a fine line between providing concise "query language" method names and respecting Java method naming standards. The general convention used throughout TinkerPop3 is that if a method is "user exposed," then a concise name is provided (e.g. <code>out()</code>, <code>path()</code>, <code>values()</code>). If the method is primarily for vendors, then the standard Java naming convention is followed (e.g. <code>getNextStep()</code>, <code>getSteps()</code>, <code>getElementComputeKeys()</code>).
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_the_graph_structure">The Graph Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-standing.png" alt="gremlin-standing" width="125"></span> A graph&#8217;s structure is the topology formed by the explicit references between its vertices, edges, and properties. A vertex has incident edges. A vertex is adjacent to another vertex if they share an incident edge. A property is attached to an element and an element has a set of properties. A property is a key/value pair, where the key is always a character <code>String</code>. The graph structure API of TinkerPop3 provides the methods necessary to create such a structure. The classic TinkerPop graph previously diagrammed can be created with the following Java8 code. Note that this graph is available as an in-memory TinkerGraph using <code>TinkerFactory.createClassic()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Graph g = TinkerGraph.open(); <b>(1)</b>
Vertex marko = g.addVertex(T.id, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">29</span>); <b>(2)</b>
Vertex vadas = g.addVertex(T.id, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">vadas</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">27</span>);
Vertex lop = g.addVertex(T.id, <span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
Vertex josh = g.addVertex(T.id, <span class="integer">4</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">32</span>);
Vertex ripple = g.addVertex(T.id, <span class="integer">5</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ripple</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
Vertex peter = g.addVertex(T.id, <span class="integer">6</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">35</span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, vadas, T.id, <span class="integer">7</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.5f</span>); <b>(3)</b>
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, josh, T.id, <span class="integer">8</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">1.0f</span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">9</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.4f</span>);
josh.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, ripple, T.id, <span class="integer">10</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">1.0f</span>);
josh.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">11</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.4f</span>);
peter.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">12</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.2f</span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a new in-memory <code>TinkerGraph</code> and assign it to the variable <code>g</code>.</p>
</li>
<li>
<p>Create a vertex along with a set of key/value pairs with <code>T.id</code> referring to the desired id for the vertex.</p>
</li>
<li>
<p>Create an edge along with a  set of key/value pairs with the edge label being specified as the first argument.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the above code all the vertices are created first and then their respective edges. There are two "accessor tokens": <code>T.id</code> and <code>T.label</code>. When any of these, along with a set of other key value pairs is provided to <code>Graph.addVertex(Object...)</code> or <code>Vertex.addEdge(String,Vertex,Object...)</code>, the respective element is created along with the provided key/value pair properties appended to it.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Many graph vendors do not allow the user to specify an element ID and in such cases, an exception is thrown.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In TinkerPop3, vertices are allowed a single immutable string label (similar to an edge label). This functionality did not exist in TinkerPop2. Likewise, element id&#8217;s are immutable as they were in TinkerPop2.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_mutating_the_graph">Mutating the Graph</h3>
<div class="paragraph">
<p>Below is a sequence of basic graph mutation operations represented in Java8. One of the major differences between TinkerPop2 and TinkerPop3 is that in TinkerPop3, the Java convention of using setters and getters has been abandoned in favor of a syntax that is more aligned with the syntax of Gremlin-Groovy in TinkerPop2. Given that Gremlin-Java8 and Gremlin-Groovy are nearly identical due to the inclusion of Java8 lambdas, a big efforts was made to ensure that both languages are as similar as possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="images/groovy-logo.png" alt="groovy-logo" width="175"></span> Gremlin-Groovy leverages the <a href="http://groovy.codehaus.org/">Groovy 2.x language</a> to express Gremlin traversals. One of the major benefits of Groovy is the inclusion of a runtime console that makes it easy for developers to practice with the Gremlin language and for production users to connect to their graph and execute traversals in an interactive manner. Moreover, Gremlin-Groovy provides various syntax simplifications.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="images/gremlin-sugar.png" alt="gremlin-sugar" width="100"></span> For those wishing to use the Gremlin2 syntax, please see <a href="#sugar-plugin">SugarPlugin</a>. This plugin provides syntactic sugar at, typically, a runtime cost. It can be loaded programmaticaly via <code>SugarLoader.load()</code>. Once loaded, it is possible to do <code>g.V.out.name</code> instead of <code>g.V().out().values('name')</code> as well as a host of other niceities.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
In the code examples presented throughout this documentation, either Gremlin-Java8 or Gremlin-Groovy is used. Usually which derivative of Gremlin is being used is made explicit in the text, however, if not, a simple mouse over on the code block will state the language as either "JAVA" or "GROOVY."
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/basic-mutation.png" alt="basic-mutation" width="240"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Graph g = TinkerGraph.open();
<span class="comment">// add a software vertex with a name property</span>
Vertex gremlin = g.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,
                             <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin</span><span class="delimiter">&quot;</span></span>); <b>(1)</b>
<span class="comment">// only one vertex should exist</span>
<span class="keyword">assert</span>(g.V().count() == <span class="integer">1</span>)
<span class="comment">// no edges should exist as none have been created</span>
<span class="keyword">assert</span>(g.E().count() == <span class="integer">0</span>)
<span class="comment">// add a new property</span>
gremlin.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="integer">2009</span>) <b>(2)</b>
<span class="comment">// add a new software vertex to the graph</span>
Vertex blueprints = g.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,
                                <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">blueprints</span><span class="delimiter">&quot;</span></span>); <b>(3)</b>
<span class="comment">// connect gremlin to blueprints via a dependsOn-edge</span>
gremlin.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">dependsOn</span><span class="delimiter">&quot;</span></span>,blueprints); <b>(4)</b>
<span class="comment">// now there are two vertices and one edge</span>
<span class="keyword">assert</span>(g.V().count() == <span class="integer">2</span>)
<span class="keyword">assert</span>(g.E().count() == <span class="integer">1</span>)
<span class="comment">// add a property to blueprints</span>
blueprints.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="integer">2010</span>) <b>(5)</b>
<span class="comment">// remove that property</span>
blueprints.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).remove() <b>(6)</b>
<span class="comment">// connect gremlin to blueprints via encapsulates</span>
gremlin.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">encapsulates</span><span class="delimiter">&quot;</span></span>,blueprints) <b>(7)</b>
<span class="keyword">assert</span>(g.V().count() == <span class="integer">2</span>)
<span class="keyword">assert</span>(g.E().count() == <span class="integer">2</span>)
<span class="comment">// removing a vertex removes all its incident edges as well</span>
blueprints.remove() <b>(8)</b>
gremlin.remove() <b>(9)</b>
<span class="comment">// the graph is now empty</span>
<span class="keyword">assert</span>(g.V().count() == <span class="integer">0</span>)
<span class="keyword">assert</span>(g.E().count() == <span class="integer">0</span>)
<span class="comment">// tada!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the same code, but using Gremlin-Groovy in the <a href="#gremlin-console">Gremlin Console</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; gremlin = g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; gremlin.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="integer">2009</span>)
==&gt;vp[created-&gt;<span class="integer">2009</span>]
gremlin&gt; blueprints = g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blueprints</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; gremlin.addEdge(<span class="string"><span class="delimiter">'</span><span class="content">dependsOn</span><span class="delimiter">'</span></span>,blueprints)
==&gt;e[<span class="integer">2</span>][<span class="integer">0</span>-dependsOn-&gt;<span class="integer">1</span>]
gremlin&gt; blueprints.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="integer">2010</span>)
==&gt;vp[created-&gt;<span class="integer">2010</span>]
gremlin&gt; blueprints.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).remove()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; gremlin.addEdge(<span class="string"><span class="delimiter">'</span><span class="content">encapsulates</span><span class="delimiter">'</span></span>,blueprints)
==&gt;e[<span class="integer">3</span>][<span class="integer">0</span>-encapsulates-&gt;<span class="integer">1</span>]
gremlin&gt; blueprints.remove()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; gremlin.remove()
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerGraph is not a transactional graph. For more information on transaction handling (for those graph systems that support them) see the section dedicated to <a href="#transactions">transactions</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_graph_process">The Graph Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-running.png" alt="gremlin-running" width="125"></span> The primary way in which graphs are processed are via graph traversals. The TinkerPop3 process API is focused on allowing users to create graph traversals in a syntacticly-friendly way over the structures defined in the previous section. A traversal is an algorithmic walk across the elements of a graph according to the referential structure explicit within the graph data structure. For example: <em>"What are the names of the companies that vertex 1&#8217;s friends work for?"</em> This English-statement can be represented in the following algorithmic/traversal fashion:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start at vertex 1.</p>
</li>
<li>
<p>Walk the incident friendship-edges to the respective adjacent friend vertices of 1.</p>
</li>
<li>
<p>Move from those friend-vertices to company-vertices via worksFor-edges.</p>
</li>
<li>
<p>Finally, select the name-property value of the current company-vertices.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Traversals in Gremlin are spawned from either a <code>Graph</code>, <code>Vertex</code>, <code>Edge</code>, or <code>VertexProperty</code>. The Graph interface provides two traversal methods.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Graph.V()</code>: generates a traversal starting at all vertices in the graph.</p>
</li>
<li>
<p><code>Graph.E()</code>: generates a traversal starting at all edges in the graph.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The return type of <code>V()</code> and <code>E()</code> is <code>GraphTraversal</code>. A GraphTraversal maintains numerous methods that return GraphTraversal. In this way, a GraphTraversal supports function composition. Each method of GraphTraversal is called a step and each step modulates the results of the previous step in one of three general ways.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>map</code>: transform the incoming object to another object (S &rarr; E).</p>
</li>
<li>
<p><code>flatMap</code>: transform the incoming object to an iterator of other objects (S &rarr; E<sup>*</sup>).</p>
</li>
<li>
<p><code>filter</code>: allow or disallow the object from proceeding to the next step (S &rarr; S &cup; &empty;).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nearly every step in GraphTraversal either extend <code>MapStep</code>, <code>FlatMapStep</code>, or <code>FilterStep</code>. Note that there is also <code>BranchStep</code> and <code>SideEffectStep</code> though their discussion will be left for later in the documentation (see <a href="#traversal">The Traversal</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>GraphTraversal</code> is a <a href="http://en.wikipedia.org/wiki/Monoid">monoid</a> in that it is an algebraic structure that has a single binary operation that is associative. The binary operation is function composition (i.e. method chaining) and its identity is the step <code>identity()</code>. This is related to a <a href="http://en.wikipedia.org/wiki/Monad_(functional_programming)">monad</a> as popularized by the functional programming community.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Both map and filter can be represented as flatMap. Map can return an iterator with a single object in it. Filter can return an iterator with a single object in it or no object at all. Thus, flatMap is the most general construct&#8201;&#8212;&#8201;"turn the incoming object into an iterator of objects."
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Given the classic TinkerPop graph, the following query will return the names of all the people that Marko knows. The following query is demonstrated using Gremlin-Groovy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if the vertex marko is already realized with a direct reference pointer, then the traversal can be spawned off that vertex. This illustrates that vertex (as well as edge) also have <code>GraphTraversal</code>-return methods and an exploration of their respective JavaDocs will demonstrate what is available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; marko = g.v(<span class="integer">1</span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; marko.out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) <b>(1)</b>
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; marko.out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(2)</b>
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tinkerpop-classic-ex1.png" alt="tinkerpop classic ex1" width="500">
</div>
<div class="title">Figure 2. The Name of The People That Marko Knows</div>
</div>
<div class="paragraph">
<p>Again, all steps extend either map, flatMap, or filter. Thus, the traversal above can be written in its generic form below. In the next section, the <code>it.get()</code> will be explained as this is an important feature of TinkerPop3 that is not available in previous versions of TinkerPop.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The steps map, flatMap, and filter take a <a href="http://en.wikipedia.org/wiki/Anonymous_function">lambda function</a> (i.e. an anonymous function or closure). For map, the function must return an object. For flatMap, the function must return an iterator of objects. For filter, the function is a predicate that returns either true or false. The lambdas introduced by Java8 are supported in TinkerPop3.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">marko.
  filter{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>}.
  flatMap{<span class="local-variable">it</span>.get().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)}.
  map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, as a strictly academic exercise, the traversal can be written completely using flatMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">marko.
  flatMap{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span> ? [<span class="local-variable">it</span>.get()].iterator() : <span class="type">[]</span>.iterator()}.
  flatMap{<span class="local-variable">it</span>.get().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)}.
  flatMap{[<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)].iterator()}
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gremlin-Java is much more aligned with Gremlin-Groovy in TinkerPop3 than it ever was before. In TinkerPop0 through TinkerPop2, Gremlin-Java was extremely verbose due to the simulation of lambdas via anonymous inner classes.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_the_traverser">The Traverser</h3>
<div class="paragraph">
<p>When a traversal is executed, the source of the traversal is on the left of the expression (e.g. vertex 1), the steps are the middle of the traversal (e.g. <code>out("knows")</code> and <code>value("name")</code>), and the results are "traversal.next()'d" out of the right of the traversal (e.g. "vadas" and "josh").</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/traversal-mechanics.png" alt="traversal mechanics" width="500">
</div>
</div>
<div class="paragraph">
<p>In TinkerPop3, the objects propagating through the traversal are wrapped in a <code>Traverser&lt;T&gt;</code>. The traverser concept is new to TinkerPop3 and provides the means by which steps remain stateless. A traverser maintains all the metadata about the traversal&#8201;&#8212;&#8201;e.g., how many times the traverser has gone through a loop, the path history of the traverser, the current object being traversed, etc. Traverser metadata may be accessed by a step. A classic example is the <code>path()</code>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">marko.out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).path()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">2</span>], vadas]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], josh]</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Path calculation is costly in terms of space as an array of previously seen objects is stored in each path of the respective traverser. Thus, traversal optimizers analyze the traversal to determine if path metadata is accessed. If not, then path calculations are turned off.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another example is the <code>jump()</code>-step which takes into account the number of times the traverser has gone through a particular section of the traversal expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">marko.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="integer">2</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
In TinkerPop2, the <code>jump()</code>-step was called <code>loop()</code>. Jump has been generalized to support both do-while and while-do semantics which is explained in <a href="#jump-step">Jump Step</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
A Traversal&#8217;s result are never ordered unless explicitly by means of <a href="#order-step"><code>order()</code></a> or <a href="#orderby-step"><code>orderBy()</code></a>. Thus, never rely on the iteration sequence between TinkerPop3 releases and even within a release (as compiler optimizations may alter the flow).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="graph" class="sect0">The Graph</h1>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-standing.png" alt="gremlin standing" width="125">
</div>
</div>
<div class="sect1">
<h2 id="_features">Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>Feature</code> implementation describes the capabilities of a <code>Graph</code> instance. This interface is implemented by vendors for two purposes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It tells users the capabilities of their <code>Graph</code> instance.</p>
</li>
<li>
<p>It allows the features they do comply with to be tested against the Gremlin Test Suite (tests they don&#8217;t comply with are "ignored").</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example in the Gremlin Console shows how to print all the features of a <code>Graph</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.features()
==&gt;FEATURES
&gt; GraphFeatures
&gt;-- <span class="key">Persistence</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">ThreadedTransactions</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">Computer</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">Transactions</span>: <span class="predefined-constant">false</span>
&gt; VariableFeatures
&gt;-- <span class="key">Variables</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanValues</span>: <span class="predefined-constant">true</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A common pattern for using features is to check their support prior to performing an operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.features().graph().supportsTransactions()
==&gt;<span class="predefined-constant">false</span>
gremlin&gt; g.features().graph().supportsTransactions() ? g.tx().commit() : <span class="string"><span class="delimiter">&quot;</span><span class="content">no tx</span><span class="delimiter">&quot;</span></span>
==&gt;no tx</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To ensure vendor agnostic code, always check feature support prior to usage of a particular function.  In that way, the application can behave gracefully in case a particular implementation is provided at runtime that does not support a function being accessed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Assignments of a <code>GraphStrategy</code> can alter the base features of a <code>Graph</code> in dynamic ways, such that checks against a <code>Feature</code> may not always reflect the behavior exhibited when the <code>GraphStrategy</code> is in use.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertex-properties">Vertex Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/vertex-properties.png" alt="vertex-properties" width="215"></span> TinkerPop3 introduces the concept of a <code>VertexProperty&lt;V&gt;</code>. All the properties of a <code>Vertex</code> are a <code>VertexProperty</code>. A <code>VertexProperty</code> implements <code>Property</code> and as such, it has a key/value pair. However, <code>VertexProperty</code> also implements <code>Element</code> and thus, can have a collection of key/value pairs. Moreover, while an <code>Edge</code> can only have one property of key "name" (for example), a <code>Vertex</code> can have multiple "name" properties. With the inclusion of vertex properties, two features are introduced which ultimately advance the graph modelers toolkit:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Multiple properties (<strong>multi-properties</strong>): a vertex property key can have multiple values (i.e. a vertex can have multiple "name" properties).</p>
</li>
<li>
<p>Properties on properties (<strong>meta-properties</strong>): a vertex property can have properties (i.e. a vertex property can have key/value data associated with it).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A collection of use cases are itemized below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Permissions</strong>: Vertex properties can have key/value ACL-type permission information associated with them.</p>
</li>
<li>
<p><strong>Auditing</strong>: When a vertex vertex property is manipulated, it can have key/value information attached to it saying who the creator, deletor, etc. are.</p>
</li>
<li>
<p><strong>Provenance</strong>: The "name" of a vertex can be declared by multiple users.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A running example using vertex properties is provided below to demonstrate and explain the API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; v = g.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko a. rodriguez</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; v.properties().count()
==&gt;<span class="integer">2</span>
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).count() <b>(1)</b>
==&gt;<span class="integer">2</span>
gremlin&gt; v.property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(2)</b>
Multiple properties exist <span class="keyword">for</span> the provided key, use Vertex.properties(name)
Display stack trace? [yN]
gremlin&gt; v.properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;marko a. rodriguez]
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;marko a. rodriguez]
gremlin&gt; vp = v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(value,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).next()
==&gt;vp[name-&gt;marko]
gremlin&gt; vp.property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">private</span><span class="delimiter">'</span></span>) <b>(3)</b>
==&gt;p[acl-&gt;<span class="directive">private</span>]
gremlin&gt; vp = v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(value,<span class="string"><span class="delimiter">'</span><span class="content">marko a. rodriguez</span><span class="delimiter">'</span></span>).next()
==&gt;vp[name-&gt;marko a. rodriguez]
gremlin&gt; vp.property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>)
==&gt;p[acl-&gt;<span class="directive">public</span>]
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).value()
==&gt;marko a. rodriguez
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).remove() <b>(4)</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).value()
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">private</span><span class="delimiter">'</span></span>).value()
==&gt;marko
gremlin&gt; vp = v.properties().next()
==&gt;vp[name-&gt;marko]
gremlin&gt; vp.properties()
==&gt;p[acl-&gt;<span class="directive">private</span>]
gremlin&gt; vp.property(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>,<span class="integer">2014</span>) <b>(5)</b>
==&gt;p[date-&gt;<span class="integer">2014</span>]
gremlin&gt; vp.property(<span class="string"><span class="delimiter">'</span><span class="content">creator</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
==&gt;p[creator-&gt;stephen]
gremlin&gt; vp.properties()
==&gt;p[date-&gt;<span class="integer">2014</span>]
==&gt;p[creator-&gt;stephen]
==&gt;p[acl-&gt;<span class="directive">private</span>]
gremlin&gt; v.properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">date</span>:<span class="integer">2014</span>, <span class="key">creator</span>:stephen, <span class="key">acl</span>:<span class="directive">private</span>]
gremlin&gt; v.singleProperty(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">okram</span><span class="delimiter">'</span></span>) <b>(6)</b>
==&gt;vp[name-&gt;okram]
gremlin&gt; v.property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;okram]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A vertex can have zero or more properties with the same key associated with it.</p>
</li>
<li>
<p>If a vertex has multiple vertex properties for the same key, then <code>Vertex.property()</code> is not allowed.</p>
</li>
<li>
<p>A vertex vertex property can have standard key/value properties attached to it.</p>
</li>
<li>
<p>Vertex property removal is identical to property removal.</p>
</li>
<li>
<p>A vertex vertex property can have any number of key/value properties attached to it.</p>
</li>
<li>
<p><code>Vertex.singleProperty()</code> is a helper method that will remove all existing key&#8217;d properties before adding the new single property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the concept of vertex properties is difficult to grasp, then it may be best to think of vertex properties in terms of "literal vertices." A vertex can have an edge to a "literal vertex" that has a single value key/value&#8201;&#8212;&#8201;e.g. "value=okram." The edge that points to that literal vertex has an edge-label of "name." The properties on the edge represent the literal vertex&#8217;s properties. The "literal vertex" can not have any other edges to it (only one from the associated vertex).</p>
</div>
<div id="the-crew-toy-graph" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
A toy graph demonstrating all of the new TinkerPop3 graph structure features is available at <code>TinkerFactory.createTheCrew()</code> and <code>data/tinkerpop-crew*</code>. This graph demonstrates multi-properties, meta-properties, hidden properties, and graph variables.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/the-crew-graph.png" alt="the crew graph" width="685">
</div>
<div class="title">Figure 3. TinkerPop Crew</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createTheCrew()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).hasNot(<span class="string"><span class="delimiter">'</span><span class="content">endTime</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           select{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}{<span class="local-variable">it</span>.value() + <span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span> + <span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">startTime</span><span class="delimiter">'</span></span>)} <span class="comment">// determine the current location of each person</span>
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:santa <span class="key">fe</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">a</span>:stephen, <span class="key">b</span>:<span class="key">purcellville</span>:<span class="integer">2006</span>]
==&gt;[<span class="key">a</span>:matthias, <span class="key">b</span>:<span class="key">seattle</span>:<span class="integer">2014</span>]
==&gt;[<span class="key">a</span>:daniel, <span class="key">b</span>:<span class="key">aachen</span>:<span class="integer">2009</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">uses</span><span class="delimiter">'</span></span>).
           orderBy(<span class="string"><span class="delimiter">'</span><span class="content">skill</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
           outV().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             select{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">skill</span><span class="delimiter">'</span></span>)}{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)} <span class="comment">// rank the users of gremlin by their skill level</span>
==&gt;[<span class="key">a</span>:<span class="integer">3</span>, <span class="key">b</span>:matthias]
==&gt;[<span class="key">a</span>:<span class="integer">4</span>, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:<span class="integer">5</span>, <span class="key">b</span>:stephen]
==&gt;[<span class="key">a</span>:<span class="integer">5</span>, <span class="key">b</span>:daniel]
gremlin&gt; g.variables() <span class="comment">// access the global graph variables</span>
==&gt;variables[<span class="key">size</span>:<span class="integer">3</span>]
gremlin&gt; g.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">creator</span><span class="delimiter">'</span></span>)
==&gt;Optional[marko]
gremlin&gt; g.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">creator</span><span class="delimiter">'</span></span>).get()
==&gt;marko
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,g.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">creator</span><span class="delimiter">'</span></span>).get()).
           properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
           valueMap().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value()}{<span class="local-variable">it</span>} <span class="comment">// get the creator's vertex and for each location, get the associated properties</span>
==&gt;[<span class="key">a</span>:san diego, <span class="key">b</span>:[<span class="key">startTime</span>:<span class="integer">1997</span>, <span class="key">endTime</span>:<span class="integer">2001</span>]]
==&gt;[<span class="key">a</span>:santa cruz, <span class="key">b</span>:[<span class="key">startTime</span>:<span class="integer">2001</span>, <span class="key">endTime</span>:<span class="integer">2004</span>]]
==&gt;[<span class="key">a</span>:brussels, <span class="key">b</span>:[<span class="key">startTime</span>:<span class="integer">2004</span>, <span class="key">endTime</span>:<span class="integer">2005</span>]]
==&gt;[<span class="key">a</span>:santa fe, <span class="key">b</span>:[<span class="key">startTime</span>:<span class="integer">2005</span>]]
gremlin&gt; g.V().properties(<span class="string"><span class="delimiter">'</span><span class="content">visible</span><span class="delimiter">'</span></span>) <span class="comment">// hidden properties are not accessible via properties()</span>
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).hiddens(<span class="string"><span class="delimiter">'</span><span class="content">visible</span><span class="delimiter">'</span></span>).value().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}{<span class="local-variable">it</span>} <span class="comment">// determine which vertices are visible</span>
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:<span class="predefined-constant">true</span>]
==&gt;[<span class="key">a</span>:stephen, <span class="key">b</span>:<span class="predefined-constant">true</span>]
==&gt;[<span class="key">a</span>:matthias, <span class="key">b</span>:<span class="predefined-constant">true</span>]
==&gt;[<span class="key">a</span>:daniel, <span class="key">b</span>:<span class="predefined-constant">false</span>]
==&gt;[<span class="key">a</span>:gremlin, <span class="key">b</span>:<span class="predefined-constant">true</span>]
==&gt;[<span class="key">a</span>:tinkergraph, <span class="key">b</span>:<span class="predefined-constant">false</span>]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hidden_properties">Hidden Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/hidden-properties.png" alt="hidden-properties" width="175"></span> A hidden property is a property that is hidden from the various property accessor methods. Hidden properties are typically used in situations where administrative data about an element must be stored that is not so much a description of the element itself. An itemization of use cases are presented below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Permissions</strong>: What user or groups have read/write permission to this element?</p>
</li>
<li>
<p><strong>Time keeping</strong>: When was this element created? When does this element expire?</p>
</li>
<li>
<p><strong>Presentation</strong>: What color should this element be presented as?</p>
</li>
<li>
<p><strong>Provenance</strong>: Which user created this element?</p>
</li>
<li>
<p><strong>Auditing</strong>: Has this element been deleted from the system? Who deleted this element?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The hidden properties API is presented in the example below represented in the Gremlin-Groovy REPL. This REPL is accessible via <code>bin/gremlin.sh</code> (or <code>bin/gremlin.bat</code> for Windows users).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; v = g.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">pierre</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; v.property(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">belgium</span><span class="delimiter">'</span></span>)
==&gt;vp[location-&gt;belgium]
gremlin&gt; v.property(Graph.Key.hide(<span class="string"><span class="delimiter">'</span><span class="content">status</span><span class="delimiter">'</span></span>),<span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>)
==&gt;vp[status-&gt;user]
gremlin&gt; v.keys()
==&gt;name
==&gt;location
gremlin&gt; v.hiddenKeys()
==&gt;status
gremlin&gt; p = v.property(Graph.Key.hide(<span class="string"><span class="delimiter">'</span><span class="content">status</span><span class="delimiter">'</span></span>))
==&gt;vp[status-&gt;user]
gremlin&gt; p.isHidden()
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; v.property(<span class="string"><span class="delimiter">'</span><span class="content">status</span><span class="delimiter">'</span></span>)
==&gt;vp[empty]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_variables">Graph Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TinkerPop3 introduces the concept of <code>Graph.Variables</code>. Variables are key/value pairs associated with the graph itself&#8201;&#8212;&#8201;in essence, a <code>Map&lt;String,Object&gt;</code>. These variables are intended to store metadata about the graph. Example use cases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Schema information</strong>: What do the namespace prefixes resolve to and when was the schema last modified?</p>
</li>
<li>
<p><strong>Global permissions</strong>: What are the access rights for particular groups?</p>
</li>
<li>
<p><strong>System user information</strong>: Who are the admins of the system?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of graph variables in use is presented below in Gremlin-Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.variables()
==&gt;variables[<span class="key">size</span>:<span class="integer">0</span>]
gremlin&gt; g.variables().set(<span class="string"><span class="delimiter">'</span><span class="content">systemAdmins</span><span class="delimiter">'</span></span>,[<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">peter</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">pavel</span><span class="delimiter">'</span></span>])
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.variables().set(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>,[<span class="string"><span class="delimiter">'</span><span class="content">matthias</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>])
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.variables().keys()
==&gt;systemAdmins
==&gt;systemUsers
gremlin&gt; g.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>)
==&gt;Optional[[matthias, marko, josh]]
gremlin&gt; g.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>).get()
==&gt;matthias
==&gt;marko
==&gt;josh
gremlin&gt; g.variables().remove(<span class="string"><span class="delimiter">'</span><span class="content">systemAdmins</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.variables().keys()
==&gt;systemUsers</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions">Graph Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="http://en.wikipedia.org/wiki/Database_transaction">database transaction</a> represents a unit of work to execute against the database.  Transactions are controlled by an implementation of the <code>Transaction</code> interface and that object can be obtained from the <code>Graph</code> interface using the <code>tx()</code> method.  Determining when a transaction starts is dependent upon the behavior assigned to the <code>Transaction</code>.  It is up to the <code>Graph</code> implementation to determine the default behavior and unless the implementation doesn&#8217;t allow it, the behavior itself can be altered via these <code>Transaction</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> Transaction onReadWrite(<span class="directive">final</span> Consumer&lt;Transaction&gt; consumer);

<span class="directive">public</span> Transaction onClose(<span class="directive">final</span> Consumer&lt;Transaction&gt; consumer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Providing a <code>Consumer</code> function to <code>onReadWrite</code> allows definition of how a transaction starts when a read or a write occurs. <code>Transaction.READ_WRITE_BEHAVIOR</code> contains pre-defined <code>Consumer</code> functions to supply to the <code>onReadWrite</code> method.  It has two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AUTO</code> - automatic transactions where the transaction is started implicitly to the read or write operation</p>
</li>
<li>
<p><code>MANUAL</code> - manual transactions where it is up to the user to explicitly open a transaction, throwing an exception if the transaction is not open</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Providing a <code>Consumer</code> function to <code>onClose</code> allows configuration of how a transaction is handled when <code>Graph.close()</code> is called.  <code>Transaction.CLOSE_BEHAVIOR</code> has several pre-defined options that can be supplied to this method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMMIT</code> - automatically commit an open transaction</p>
</li>
<li>
<p><code>ROLLBACK</code> - automatically rollback an open transaction</p>
</li>
<li>
<p><code>MANUAL</code> - throw an exception if a transaction is open, forcing the user to explicitly close the transaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once there is an understanding for how transactions are configured, most of the rest of the <code>Transaction</code> interface is self-explanatory. Note that <a href="#neo4j-gremlin">Neo4j-Gremlin</a> is used for the examples to follow as TinkerGraph does not support transactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g.features
==&gt;FEATURES
&gt; GraphFeatures
&gt;-- <span class="key">Transactions</span>: <span class="predefined-constant">true</span>  <b>(1)</b>
&gt;-- <span class="key">Computer</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">Persistence</span>: <span class="predefined-constant">true</span>
...
gremlin&gt; g.tx().onReadWrite(Transaction.READ_WRITE_BEHAVIOR.AUTO) <b>(2)</b>
==&gt;com.tinkerpop.gremlin.neo4j.structure.Neo4jGraph<span class="error">$</span>Neo4jTransaction<span class="error">@</span><span class="integer">1</span>c067c0d
gremlin&gt; g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>)  <b>(3)</b>
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.tx().commit() <b>(4)</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.tx().onReadWrite(Transaction.READ_WRITE_BEHAVIOR.MANUAL) <b>(5)</b>
==&gt;com.tinkerpop.gremlin.neo4j.structure.Neo4jGraph<span class="error">$</span>Neo4jTransaction<span class="error">@</span><span class="integer">1</span>c067c0d
gremlin&gt; g.tx().isOpen()
==&gt;<span class="predefined-constant">false</span>
gremlin&gt; g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>) <b>(6)</b>
Open a transaction before attempting to read/write the transaction
gremlin&gt; g.tx().open() <b>(7)</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>) <b>(8)</b>
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.tx().commit()
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Check <code>features</code> to ensure that the graph supports transactions.</p>
</li>
<li>
<p>By default, <code>Neo4jGraph</code> is configured with "automatic" transactions, so it is set here for demonstration purposes only.</p>
</li>
<li>
<p>When the vertex is added, the transaction is automatically started.  From this point, more mutations can be staged or other read operations executed in the context of that open transaction.</p>
</li>
<li>
<p>Calling <code>commit</code> finalizes the transaction.</p>
</li>
<li>
<p>Change transaction behavior to require manual control.</p>
</li>
<li>
<p>Adding a vertex now results in failure because the transaction was not explicitly opened.</p>
</li>
<li>
<p>Explicitly open a transaction.</p>
</li>
<li>
<p>Adding a vertex now succeeds as the transaction was manually opened.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Transaction</code> object also exposes a method for executing automatic transaction retries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.tx().submit{<span class="local-variable">it</span>.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>)}.retry(<span class="integer">10</span>)
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.tx().submit{<span class="local-variable">it</span>.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">daniel</span><span class="delimiter">&quot;</span></span>)}.exponentialBackoff(<span class="integer">10</span>)
==&gt;v[<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, the <code>submit</code> method takes a <code>Function&lt;Graph, R&gt;</code> which is the unit of work to execute and possibly retry on failure.  The method returns a <code>Transaction.Workload</code> object which has a number of default methods for common retry strategies.  It is also possible to supply a custom retry function if a default one does not suit the required purpose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_batchgraph">BatchGraph</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/batch-graph.png" alt="batch-graph" width="175"></span> <code>BatchGraph</code> wraps any <code>Graph</code> to enable batch loading of a large number of edges and vertices by chunking the entire load into smaller batches and maintaining a memory-efficient vertex cache so that intermediate transactional states can be flushed after each chunk is loaded to release memory.</p>
</div>
<div class="paragraph">
<p><code>BatchGraph</code> is <strong>only</strong> meant for loading data and does not support any retrieval or removal operations. That is, <code>BatchGraph</code> only supports the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Graph.addVertex()</code> for adding vertices</p>
</li>
<li>
<p><code>Vertex.addEdge()</code> for adding edges</p>
</li>
<li>
<p><code>Graph.v()</code> to be used when adding edges</p>
</li>
<li>
<p>Property getter, setter and removal methods for vertices and edges as well as <code>Element.id()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An important limitation of <code>BatchGraph</code> is that edge properties can only be set immediately after the edge has been added. If other vertices or edges have been created in the meantime, setting, getting or removing properties will throw exceptions. This is done to avoid caching of edges which would require memory.</p>
</div>
<div class="paragraph">
<p><code>BatchGraph</code> can also automatically set the provided element identifiers as properties on the respective element. Use <code>vertexIdKey()</code> and <code>edgeIdKey()</code> on the <code>BatchGraph.Builder</code> to set the keys for the vertex and edge properties, respectively. This is useful when the graph implementation ignores supplied identifiers (as is the case with most implementations).</p>
</div>
<div class="paragraph">
<p>As an example, consider loading a large number of edges defined by a <code>String</code> array with four entries called <em>quads</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The out vertex id</p>
</li>
<li>
<p>The in vertex id</p>
</li>
<li>
<p>The label of the edge</p>
</li>
<li>
<p>A string annotation for the edge, i.e. an edge property</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Assuming this array is very large, loading all these edges in a single transaction is likely to exhaust main memory. Furthermore, one would have to rely on the database indexes to retrieve previously created vertices for a given identifier. <code>BatchGraph</code> addresses both of these issues.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">BatchGraph bgraph = BatchGraph.build(graph).vertexIdType(VertexIDType.STRING).bufferSize(<span class="integer">1000</span>).create();
<span class="keyword">for</span> (<span class="predefined-type">String</span><span class="type">[]</span> quad : quads) {
    Vertex<span class="type">[]</span> vertices = <span class="keyword">new</span> Vertex[<span class="integer">2</span>];
    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="integer">0</span>;i&lt;<span class="integer">2</span>;i++) {
        vertices[i] = bgraph.getVertex(quad[i]);
        <span class="keyword">if</span> (vertices[i]==<span class="predefined-constant">null</span>) vertices[i]=bgraph.addVertex(quad[i]);
    }
    Edge edge = bgraph.addEdge(<span class="predefined-constant">null</span>,vertices[<span class="integer">0</span>],vertices[<span class="integer">1</span>],quad[<span class="integer">2</span>]);
    edge.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">annotation</span><span class="delimiter">&quot;</span></span>,quad[<span class="integer">3</span>]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, a <code>BatchGraph</code> <code>bgraph</code> is created wrapping an existing <code>graph</code> and setting the identifier type to <code>VertexIDType.STRING</code> and the batch size to 1000. <code>BatchGraph</code> maintains a mapping from the external vertex identifiers (in the example the first two entries in the <code>String</code> array describing the edge) to the internal vertex identifiers assigned by the wrapped graph database. Since this mapping is maintained in memory, it is potentially much faster than the database index. By specifying the <code>VertexIDType</code>, <code>BatchGraph</code> chooses the most memory-efficient mapping data structure and applies compression algorithms if possible. There are four different <code>VertexIDType</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OBJECT</code> : For arbitrary object vertex identifiers. This is the most generic and least space efficient type.</p>
</li>
<li>
<p><code>STRING</code> : For string vertex identifiers. Attempts to apply string compression and prefixing strategies to reduce the memory footprint.</p>
</li>
<li>
<p><code>URL</code> : For string vertex identifiers that parse as URLs. Applies URL specific compression schemes that are more efficient than generic string compression.</p>
</li>
<li>
<p><code>NUMBER</code> : For numeric vertex identifiers. Uses primitive data structures that requires significantly less memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>bufferSize</code> represents the number of vertices and edges to load before committing a transaction and starting a new one.</p>
</div>
<div class="paragraph">
<p>The <code>for</code> loop then iterates over all the quad <code>String</code> arrays and creates an edge for each by first retrieving or creating the vertex end points and then creating the edge. Note, that the edge property is set immediately after creating the edge. This property assignment is required because edges are only kept in memory until the next edge is created for efficiency reasons.</p>
</div>
<div class="sect2">
<h3 id="_presorting_data">Presorting Data</h3>
<div class="paragraph">
<p>In the previous example, there is a big speed advantage if the next edge loaded has the same out vertex as the previous edge.  Loading all of the out going edges for a particular vertex at once before moving on to the next out vertex makes optimal use of the cache, whereas loading edges in a random order causes many more writes to and flushes of the cache.</p>
</div>
<div class="paragraph">
<p>To take advantage of this, the data can be presorted quickly and efficiently using the linux built-in <a href="http://en.wikipedia.org/wiki/Sort_(Unix)">sort</a> command.  Assume that edges are read from a text file <code>edges.txt</code> with one edge per line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">4   created   5   weight=1.0
1   knows     4   weight=1.0
1   knows     2   weight=0.5
4   created   3   weight=0.4
6   created   3   weight=0.2
1   created   3   weight=0.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>This file can be sorted before loading with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ sort -S4G -o edges_sorted.txt edges.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-S4G</code> flag gives sort 4Gb of memory to work with.  If the file fits into memory the sort will be very fast; otherwise <code>sort</code> will use scratch space on disk to perform the operation.  Although this is not as fast, the linux <code>sort</code> command is highly optimized and is not limited in the size of files it can process.  If the input data contain unwanted duplicate lines, using the <code>-u</code> flag will cause <code>sort</code> to remove these duplicate lines during processing.</p>
</div>
<div class="paragraph">
<p>The sorted file <code>edges_sorted.txt</code> now has the edges ordered by out vertex:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">1   created   3   weight=0.4
1   knows     2   weight=0.5
1   knows     4   weight=1.0
4   created   3   weight=0.4
4   created   5   weight=1.0
6   created   3   weight=0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way, any given out vertex is kept in the cache for all of its out going edges.  The time needed to sort the data is nearly always much less than the loading time saved by maximizing use of the cache, especially for large input data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_incremental_loading">Incremental Loading</h3>
<div class="paragraph">
<p>The above describes how <code>BatchGraph</code> can be used to load data into a graph under the assumption that the wrapped graph is initially empty. <code>BatchGraph</code> can also be used to incrementally batch load edges and vertices into a graph with existing data. In this case, vertices may already exist for given identifiers.</p>
</div>
<div class="paragraph">
<p>If the wrapped graph does not ignore identifiers, then enabling incremental batch loading is as simple as calling <code>incrementalLoading(false)</code> on the <code>Builder</code>, i.e. to disable the assumption that data is loaded into an empty graph. If the wrapped graph does ignore identifiers, then one has to tell <code>BatchGraph</code> how to find existing vertices for a given identifier by specifying the vertex identifier key using <code>vertexIdKey(key)</code> where <code>key</code> is some <code>String</code> for the property key. The <code>key</code> selected should be indexed by the underlying store for lookups to be efficient.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Incremental batch loading is more expensive than loading from scratch because <code>BatchGraph</code> has to call on the wrapped graph to determine whether a vertex exists for a given identifier.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gremlin_i_o">Gremlin I/O</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-io.png" alt="gremlin-io" width="250"></span> The task of getting data in and out of <code>Graph</code> instances is the job of the Gremlin I/O packages.  Gremlin I/O provides two interfaces that for reading and writing <code>Graph</code> instances: <code>GraphReader</code> and <code>GraphWriter</code>.  These interfaces expose methods that support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reading and writing an entire <code>Graph</code></p>
</li>
<li>
<p>Reading and writing a <code>Traversal&lt;Vertex&gt;</code> as adjacency list format</p>
</li>
<li>
<p>Reading and writing a single <code>Vertex</code> (with and without associated <code>Edge</code> objects)</p>
</li>
<li>
<p>Reading and writing a single <code>Edge</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, these methods operate in the currency of <code>InputStream</code> and <code>OutputStream</code> objects, allowing graphs and their related elements to be written to and read from files, byte arrays, etc.</p>
</div>
<div class="sect2">
<h3 id="_graphml_reader_writer">GraphML Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-graphml.png" alt="gremlin-graphml" width="350"></span> The <a href="http://graphml.graphdrawing.org/">GraphML</a> file format is a common XML-based representation of a graph. It is widely supported by graph-related tools and libraries making it a solid interchange format for TinkerPop. In other words, if the intent is to work with graph data in conjunction with applications outside of TinkerPop, GraphML maybe be the best choice to do that. Common use cases might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a graph <a href="https://networkx.github.io/">NetworkX</a>, export it with GraphML and import it to TinkerPop.</p>
</li>
<li>
<p>Produce a subgraph and export it to GraphML to be consumed by and visualized in <a href="https://gephi.org/">Gephi</a>.</p>
</li>
<li>
<p>Migrate the data of an entire graph to a different graph database not supported by TinkerPop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As GraphML is a specification for the serialization of an entire graph and not the individual elements of a graph, methods that support input and output of single vertices and edges are not supported.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
GraphML is a "lossy" format in that it only supports primitive values for properties and does not have support for <code>Graph</code> variables.  It will use <code>toString</code> to serialize property values outside of those primitives.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code shows how to write a <code>Graph</code> instance to file called <code>tinkerpop-classic.xml</code> and then how to read that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">final</span> Graph g = TinkerFactory.createClassic();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.xml</span><span class="delimiter">&quot;</span></span>)) {
    GraphMLWriter.build().create().writeGraph(os, g);
}

<span class="directive">final</span> GraphReader reader = GraphMLReader.build().create();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.xml</span><span class="delimiter">&quot;</span></span>)) {
    reader.readGraph(stream, g);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graphson_reader_writer">GraphSON Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-graphson.png" alt="gremlin-graphson" width="350"></span> GraphSON is a <a href="http://json.org/">JSON</a>-based format extended from earlier versions of TinkerPop. It is important to note that TinkerPop3&#8217;s GraphSON is not backwards compatible with prior TinkerPop GraphSON versions. GraphSON has some support from graph-related application outside of TinkerPop, but it is generally best used in two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A text format of the graph or its elements is desired (e.g. debugging, usage in source control, etc.)</p>
</li>
<li>
<p>The graph or its elements need to be consumed by code that is not JVM-based (e.g. JavaScript, Python, .NET, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>GraphSON supports all of the <code>GraphReader</code> and <code>GraphWriter</code> interface methods and can therefore read or write an entire <code>Graph</code>, a single <code>Vertex</code> or a single <code>Edge</code>.  The following code shows how to write a <code>Graph</code> instance to file called <code>tinkerpop-classic.json</code> and then how to read that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">final</span> Graph g = TinkerFactory.createClassic();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.json</span><span class="delimiter">&quot;</span></span>)) {
    GraphSONWriter.build().create().writeGraph(os, g);
}

<span class="directive">final</span> GraphReader reader = GraphSONReader.build().create();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.json</span><span class="delimiter">&quot;</span></span>)) {
    reader.readGraph(stream, g);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GraphSONReader</code> and <code>GraphSONWriter</code> have a number of options that they can be configured with.  One of the important options is the ability to embed type information into the output.  By embedding the types, it becomes possible to serialize a graph without losing type information that might be important when being consumed by another source.  The importance of this concept is demonstrated in the following example where a single <code>Vertex</code> is written to GraphSON using the Gremlin Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; w = GraphSONWriter.build().create()
==&gt;com.tinkerpop.gremlin.structure.io.graphson.GraphSONWriter<span class="error">@</span><span class="integer">1</span>af146
gremlin&gt; f = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">'</span><span class="content">test.txt</span><span class="delimiter">'</span></span>)
==&gt;java.io.FileOutputStream<span class="error">@</span><span class="integer">5</span>c8eee0f
gremlin&gt; w.writeVertex(f, g.v(<span class="integer">1</span>), Direction.BOTH)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; f.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following GraphSON example shows the output of <code>GraphSonWriter.writeVertex()</code> with associated edges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>: [],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">9</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
            <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.4</span>
            }
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
            <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.5</span>
            }
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
            <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>
            }
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {}
            }
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {},
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">29</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {}
            }
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The vertex properly serializes to valid JSON but note that a consuming application will not automatically know how to interpret the numeric values.  In coercing those Java values to JSON, such information is lost.  For example, it is no longer clear if the <code>weight</code> value on the edges should be read as a <code>Double</code> or an <code>Float</code>.</p>
</div>
<div class="paragraph">
<p>With a minor change to the construction of the <code>GraphSONWriter</code> the lossy nature of GraphSON can be avoided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; w = GraphSONWriter.build().embedTypes(<span class="predefined-constant">true</span>).create()
==&gt;com.tinkerpop.gremlin.structure.io.graphson.GraphSONWriter<span class="error">@</span><span class="integer">350</span>ec41e</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above code, the <code>embedTypes</code> option is set to <code>true</code> and the output below shows the difference in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
        []
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
        [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">9</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Float</span><span class="delimiter">&quot;</span></span>,
                        <span class="float">0.4</span>
                    ]
                }
            },
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Float</span><span class="delimiter">&quot;</span></span>,
                        <span class="float">0.5</span>
                    ]
                }
            },
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Float</span><span class="delimiter">&quot;</span></span>,
                        <span class="integer">1</span>
                    ]
                }
            }
        ]
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>,
                        <span class="integer">0</span>
                    ],
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                    }
                }
            ]
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>,
                        <span class="integer">1</span>
                    ],
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">29</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>
                    }
                }
            ]
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ambiguity of components of the GraphSON is now removed by the <code>@class</code> property, which contains Java class information for the data it is associated with.  While the output is more verbose, it comes with the security of not losing type information.  While non-JVM languages won&#8217;t be able to consume this information automatically, at least there is a hint as to how the values should be coerced back into the correct types in the target language.</p>
</div>
</div>
<div class="sect2">
<h3 id="gremlin-kryo">Kryo Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-kryo.png" alt="gremlin-kryo" width="400"></span> <a href="https://github.com/EsotericSoftware/kryo">Kryo</a> is a popular serialization package for the JVM. Gremlin-Kryo is a binary Graph serialization format for use on the JVM by JVM languages. It is designed to be space efficient, non-lossy and is promoted as the standard format to use when working with graph data inside of the TinkerPop stack. A list of common use cases is presented below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration from one Gremlin Structure implementation to another (e.g. <code>TinkerGraph</code> to <code>Neo4jGraph</code>)</p>
</li>
<li>
<p>Serialization of individual graph elements to be sent over the network to another JVM.</p>
</li>
<li>
<p>Backups of in-memory graphs or subgraphs.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
When migrating between Gremlin Structure implementations, Kryo may not lose data, but it is important to consider the features of each <code>Graph</code> and whether or not the data types supported in one will be supported in the other.  Failure to do so, may result in errors.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kryo supports all of the <code>GraphReader</code> and <code>GraphWriter</code> interface methods and can therefore read or write an entire <code>Graph</code>, a single <code>Vertex</code> or a single <code>Edge</code>.  The following code shows how to write a <code>Graph</code> instance to file called <code>tinkerpop-classic.gio</code> and then how to read that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">final</span> Graph g = TinkerFactory.createClassic();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.gio</span><span class="delimiter">&quot;</span></span>)) {
    KryoWriter.build().create().writeGraph(os, g);
}

<span class="directive">final</span> GraphReader reader = KryoReader.build().create();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-classic.gio</span><span class="delimiter">&quot;</span></span>)) {
    reader.readGraph(stream, g);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The preferred extension for files names produced by Kryo is <code>.gio</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tinkerpop2_data_migration">TinkerPop2 Data Migration</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/data-migration.png" alt="data-migration" width="300"></span> For those using TinkerPop2, migrating to TinkerPop3 will mean a number of programming changes, but may also require a migration of the data depending on the graph implementation.  For example, trying to open <code>TinkerGraph</code> data from TinkerPop2 with TinkerPop3 code will not work, however opening a TinkerPop2 <code>Neo4jGraph</code> with a TinkerPop3 <code>Neo4jGraph</code> should work provided there aren&#8217;t Neo4j version compatibility mismatches preventing the read.</p>
</div>
<div class="paragraph">
<p>If such a situation arises that a particular TinkerPop2 <code>Graph</code> can not be read by TinkerPop3, a "legacy" data migration approach exists.  The migration involves writing the TinkerPop2 <code>Graph</code> to GraphSON, then reading it to TinkerPop3 with the <code>LegacyGraphSONReader</code> (a limited implementation of the <code>GraphReader</code> interface).</p>
</div>
<div class="paragraph">
<p>The following represents an example migration of the "classic" toy graph.  In this example, the "classic" graph is saved to GraphSON using TinkerPop2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; Gremlin.version()
==&gt;<span class="float">2.5</span>.z
gremlin&gt; g = TinkerGraphFactory.createTinkerGraph()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; GraphSONWriter.outputGraph(g,<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp2.json</span><span class="delimiter">'</span></span>,GraphSONMode.EXTENDED)
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above console session uses the <code>gremlin-groovy</code> distribution from TinkerPop2.  It is important to generate the <code>tp2.json</code> file using the <code>EXTENDED</code> mode as it will include data types when necessary which will help limit "lossiness" on the TinkerPop3 side when imported.  Once <code>tp2.json</code> is created, it can then be imported to a TinkerPop3 <code>Graph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; Gremlin.version()
==&gt;<span class="float">3.0</span><span class="float">.0</span>.M6
gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; r = LegacyGraphSONReader.build().create()
==&gt;com.tinkerpop.gremlin.structure.io.graphson.LegacyGraphSONReader<span class="error">@</span><span class="integer">64337702</span>
gremlin&gt; r.readGraph(<span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp2.json</span><span class="delimiter">'</span></span>),g)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.E()
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above console session uses the TinkerPop3 Gremlin Console.  It creates a new <code>TinkerGraph</code> which the TinkerPop2 GraphSON will be loaded into and uses the <code>LegacyGraphSONReader</code> to import the <code>tp2.json</code> file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_strategy">Graph Strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Graph Strategy provides a way to expand, inspect or otherwise alter the behavior of a <code>Graph</code> implementation.  A Graph Strategy injects arbitrary functions into the <code>Graph</code> API, so that when a method call is made, the strategy functions can manipulate the default behavior of the underlying <code>Graph</code>.  TinkerPop3 is packaged with the following strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IdGraphStrategy</code> - enables support for custom element identifiers for those graphs which don&#8217;t otherwise support them</p>
</li>
<li>
<p><code>PartitionGraphStrategy</code> - enables support for logical graph partitioning where the <code>Graph</code> can be blinded to different parts of the total graph</p>
</li>
<li>
<p><code>ReadOnlyGraphStrategy</code> - prevents writing to the <code>Graph</code></p>
</li>
<li>
<p><code>SequenceGraphStrategy</code> - apply multiple <code>GraphStrategy</code> implementations in sequenced ordered to a single <code>Graph</code> instance</p>
</li>
<li>
<p><code>SubgraphStrategy</code> - create a logical subgraph which selectively includes vertices and edges of a <code>Graph</code> according to provided criteria</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TinkerPop2 had the notion of "Graph Wrappers" which decorated standard <code>Graph</code> implementations with additional features.  A Graph strategy is generally analogous to that capability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use a <code>GraphStrategy</code> instance, use the <code>GraphFactory</code> to instantiate the <code>Graph</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; conf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="integer">5</span>b40ceb
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.graph</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g = GraphFactory.open(conf, <span class="keyword">new</span> ReadOnlyGraphStrategy())
==&gt;readonlygraphstrategy[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code specifies the creation of a <code>TinkerGraph</code> with the use of <code>ReadOnlyGraphStrategy</code>.  Note that the <code>GraphFactory</code> does not return a <code>TinkerGraph</code> instance.  It returns a <code>StrategyWrappedGraph</code> which is a traverser for the underlying <code>TinkerGraph</code> and the <code>ReadOnlyGraphStrategy</code>.  Since <code>StrategyWrappedGraph</code> implements the <code>Graph</code> interface, it can be used in the same manner as <code>TinkerGraph</code> or any other implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
Graph uses <span class="type">class</span> <span class="class">com</span>.tinkerpop.gremlin.structure.strategy.ReadOnlyGraphStrategy and is therefore unmodifiable</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code tries to mutate the underlying <code>TinkerGraph</code>.  Note that <code>ReadOnlyGraphStrategy</code> prevents that and throws an exception.  At any point, the <code>GraphStrategy</code> can be bypassed by getting the underlying <code>TinkerGraph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; bg = g.getBaseGraph()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; bg.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.v(<span class="integer">0l</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;stephen</code></pre>
</div>
</div>
<div class="paragraph">
<p>By getting the "base graph" (i.e. the underlying <code>TinkerGraph</code>) it is possible to mutate the graph.  The above code demonstrates that and also shows that it then possible to read back that added vertex. The following sections explain details of the specific <code>GraphStrategy</code> implementations.</p>
</div>
<div class="sect2">
<h3 id="_idgraphstrategy">IdGraphStrategy</h3>
<div class="paragraph">
<p><code>IdGraphStrategy</code> which affords complete control over element identifiers. Some <code>Graph</code> implementations, such as <code>TinkerGraph</code>, allow specification of custom identifiers when creating elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; v = g.addVertex(id, <span class="string"><span class="delimiter">&quot;</span><span class="content">42a</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">42</span>a]
gremlin&gt; g.v(<span class="string"><span class="delimiter">&quot;</span><span class="content">42a</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">42</span>a]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other <code>Graph</code> implementations, however, generate element identifiers automatically and cannot be assigned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; v = g.addVertex(id, <span class="string"><span class="delimiter">&quot;</span><span class="content">42a</span><span class="delimiter">&quot;</span></span>)
Vertex does not support user supplied identifiers
Display stack trace? [yN]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the nature of identifier assignment, this means that identifiers are generally not conserved when moving data between graph instances and implementations, to XML and back again, etc. So for applications which need it, there is <code>IdGraphStrategy</code>. Using vertex and edge indices under the hood, <code>IdGraphStrategy</code> enables custom identifiers irrespective of whether or not the underlying <code>Graph</code> implementation allows them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; swg = <span class="keyword">new</span> StrategyWrappedGraph(g)
==&gt;defaultgraphstrategy[neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]]
gremlin&gt; swg.getStrategy().setGraphStrategy(IdGraphStrategy.build(<span class="string"><span class="delimiter">&quot;</span><span class="content">idKey</span><span class="delimiter">&quot;</span></span>).create())
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; swg.addVertex(id,<span class="string"><span class="delimiter">&quot;</span><span class="content">42a</span><span class="delimiter">&quot;</span></span>).id()
==&gt;<span class="integer">42</span>a
gremlin&gt; swg.addVertex().id()
==&gt;ef74e843-<span class="integer">4</span>c6e-<span class="float">40d</span><span class="integer">2</span>-<span class="float">929f</span>-<span class="float">2552e2f</span><span class="integer">96</span>bf2</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a non-null identifier is passed to <code>IdGraph.addVertex</code> or <code>IdGraph.addEdge</code>, that value will be used to uniquely identify the element. When the <code>id</code> is not provided, <code>IdGraph</code> will generate an identifier on its own.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The key that is used to store the assigned identifier should be indexed in the underlying graph database.  If it is not indexed, then lookups for the elements that use these identifiers will perform a linear scan.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_partitiongraphstrategy">PartitionGraphStrategy</h3>
<div class="paragraph">
<p><code>PartitionGraphStrategy</code> is a <code>SubgraphStrategy</code> which creates logical subgraphs through the use of designated properties.  When each element is written to the <code>Graph</code>, it is marked with a property value indicating the current write-partition.  As elements are read from the graph, they are matched against the current set of read-partitions.  The read-partitions thereby define the union of a set of vertices and edges. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; strategy = <span class="keyword">new</span> PartitionGraphStrategy(Graph.Key.hide(<span class="string"><span class="delimiter">&quot;</span><span class="content">partition</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>)
==&gt;PartitionGraphStrategy
gremlin&gt; sg = <span class="keyword">new</span> StrategyWrappedGraph(g)
==&gt;strategywrappedgraph[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]]
gremlin&gt; sg.getStrategy().setGraphStrategy(strategy)
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add vertices and edges first in one partition, then another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; v1 = sg.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
==&gt;partitiongraphstrategy[v[<span class="integer">0</span>]]
gremlin&gt; v2 = sg.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>)
==&gt;partitiongraphstrategy[v[<span class="integer">1</span>]]
gremlin&gt; v1.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, v2)
==&gt;partitiongraphstrategy[e[<span class="integer">2</span>][<span class="integer">0</span>-knows-&gt;<span class="integer">1</span>]]
gremlin&gt; strategy.setWritePartition(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; v3 = sg.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>)
==&gt;partitiongraphstrategy[v[<span class="integer">3</span>]]
gremlin&gt; v1.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, v3)
==&gt;partitiongraphstrategy[e[<span class="integer">4</span>][<span class="integer">0</span>-knows-&gt;<span class="integer">3</span>]]
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define sets of partitions which provide access to different subgraphs, or slices of the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">in A: </span><span class="delimiter">&quot;</span></span> + sg.V().count().next() + <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + sg.E().count().next()
==&gt;<span class="keyword">in</span> <span class="key">A</span>: <span class="integer">2</span>, <span class="integer">1</span>
gremlin&gt; strategy.addReadPartition(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">in A+B: </span><span class="delimiter">&quot;</span></span> + sg.V().count().next() + <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + sg.E().count().next()
==&gt;<span class="keyword">in</span> A+<span class="key">B</span>: <span class="integer">3</span>, <span class="integer">2</span>
gremlin&gt; strategy.clearReadPartitions()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; strategy.addReadPartition(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">in B: </span><span class="delimiter">&quot;</span></span> + sg.V().count().next() + <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + sg.E().count().next()
==&gt;<span class="keyword">in</span> <span class="key">B</span>: <span class="integer">1</span>, <span class="integer">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there are no edges in the set B, as the only edge added to partition B is incident on a vertex of A.</p>
</div>
</div>
<div class="sect2">
<h3 id="_readonlygraphstrategy">ReadOnlyGraphStrategy</h3>
<div class="paragraph">
<p><code>ReadOnlyGraphStrategy</code> was demonstrated at the start of the <code>GraphStrategy</code> section.  It simply prevents write operations that would otherwise mutate the <code>Graph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; conf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="integer">5</span>b40ceb
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.graph</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g = GraphFactory.open(conf, <span class="keyword">new</span> ReadOnlyGraphStrategy())
==&gt;readonlygraphstrategy[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]]
gremlin&gt; g.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
Graph uses <span class="type">class</span> <span class="class">com</span>.tinkerpop.gremlin.structure.strategy.ReadOnlyGraphStrategy and is therefore unmodifiable</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sequencegraphstrategy">SequenceGraphStrategy</h3>
<div class="paragraph">
<p><code>SequenceGraphStrategy</code> provides a way to string together a set of <code>GraphStrategy</code> implementations, such that they are executed in order from first to last.  The <code>GraphFactory</code> provides a straightforward way to invisibly use <code>SequenceGraphStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; conf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="float">6048e26</span>a
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.graph</span><span class="delimiter">&quot;</span></span>,TinkerGraph.class.getName())
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g = GraphFactory.open(conf, <span class="keyword">new</span> ReadOnlyGraphStrategy(), <span class="keyword">new</span> PartitionGraphStrategy(<span class="string"><span class="delimiter">&quot;</span><span class="content">partition</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>))
==&gt;sequencegraphstrategy[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code demonstrates a <code>Graph</code> that uses a <code>SequenceGraphStrategy</code> composed of <code>ReadOnlyGraphStrategy</code> and <code>PartitionGraphStrategy</code>.  When the <code>SequenceGraphStrategy</code> is invoked, it will first apply the <code>ReadOnlyGraphStrategy</code> and then apply the <code>PartitionGraphStrategy</code>.  It is important to consider the ordering of the <code>GraphStrategy</code> objects when choosing to use <code>SequenceGraphStrategy</code> as it makes no attempts to determine if strategies will be in conflict with one another.  Be aware of the nature of the strategies and ensure that applying them in the order assigned will produce the desirable outcome.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subgraphstrategy">SubgraphStrategy</h3>
<div class="paragraph">
<p>A general-purpose <code>SubgraphStrategy</code> is created by defining a "vertex criterion" and an "edge criterion" as Java 8 <code>Predicates</code> and applying them to a <code>Graph</code>.  All vertices present in the base <code>Graph</code> which pass the vertex criterion will be present in the <code>StrategyWrappedGraph</code>.  All edges present in the base <code>Graph</code> which pass the edge criterion <strong>and</strong> whose in- and out-vertices both pass the vertex criterion will be present in the <code>StrategyWrappedGraph</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
edges are either entirely visible, or entirely invisible to a subgraph.  You will never find an edge which cannot be traversed due to a missing in- or out-vertex.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Graph g = TinkerFactory.createClassic();

<span class="predefined-type">Predicate</span>&lt;Vertex&gt; vertexCriterion = vertex -&gt; <span class="predefined-constant">true</span>;
<span class="predefined-type">Predicate</span>&lt;Edge&gt; edgeCriterion = edge -&gt; (<span class="type">int</span>) edge.id() &gt;= <span class="integer">8</span> &amp;&amp; (<span class="type">int</span>) edge.id() &lt;= <span class="integer">10</span>;

GraphStrategy strategy = <span class="keyword">new</span> SubgraphStrategy(vertexCriterion, edgeCriterion);
StrategyWrappedGraph sg = <span class="keyword">new</span> StrategyWrappedGraph(g);
sg.getStrategy().setGraphStrategy(strategy);

<span class="comment">// all vertices are here</span>
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + sg.V().count() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> of </span><span class="delimiter">&quot;</span></span> + g.V().count() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> vertices</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// only the given edges are included</span>
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + sg.E().count() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> of </span><span class="delimiter">&quot;</span></span> + g.E().count() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> edges</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="traversal" class="sect0">The Traversal</h1>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-running.png" alt="gremlin running" width="125">
</div>
</div>
<div class="paragraph">
<p>At the most general level there is <code>Traversal&lt;S,E&gt;</code> which implements <code>Iterator&lt;E&gt;</code>, where the <code>S</code> stands for start and the <code>E</code> stands for end. A traversal is composed of four primary components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Step&lt;S,E&gt;</code>: an individual function applied to <code>S</code> to yield <code>E</code>.</p>
</li>
<li>
<p><code>TraversalStrategy</code>: interceptor methods to alter the execution of the traversal (i.e. query re-writing typically used only by vendors).</p>
</li>
<li>
<p><code>Traversal.SideEffects</code>: key/value pairs that can be used to store global information about the traversal.</p>
</li>
<li>
<p><code>Traverser&lt;T&gt;</code>: the object propagating through the <code>Traversal</code> currently representing an object of type <code>T</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The classic notion of a graph traversal is provided by <code>GraphTraversal&lt;S,E&gt;</code> which extends <code>Traversal&lt;S,E&gt;</code>. GraphTraversal provides an interpretation of the graph data in terms of vertices, edges, etc. and thus, a graph traversal <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>.</p>
</div>
<div class="sect1">
<h2 id="graph-traversal-steps">Graph Traversal Steps</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/step-types.png" alt="step types" width="650">
</div>
</div>
<div class="paragraph">
<p>A <code>GraphTraversal&lt;S,E&gt;</code> can be spawned off of a Graph, Vertex, or an Edge. A graph traversal is composed of an ordered list of steps. Each step is of particular general form as diagrammed above. A list of all the steps (and their descriptions) are provided in the TinkerPop3 <a href="http://www.tinkerpop.com/javadocs/3.0.0.M6/core/com/tinkerpop/gremlin/process/graph/GraphTraversal.html">GraphTraversal JavaDoc</a>. A few of the more interesting/complex steps are presented in the following subsections.</p>
</div>
<div class="sect2">
<h3 id="lambda-steps">Lambda Steps</h3>
<div class="paragraph">
<p>There are four generic steps by which all other specific steps described later extend.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:45%;">
<col style="width:54%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Step</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(Function&lt;Traverser&lt;S&gt;, E&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to some object of type <code>E</code> for the next step to process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flatMap(Function&lt;Traverser&lt;S&gt;, Iterator&lt;E&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to an iterator of <code>E</code> objects that are streamed to the next step.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filter(Predicate&lt;Traverser&lt;S&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to either true or false, where false will not pass the traverser to the next step.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sideEffect(Consumer&lt;Traverser&lt;S&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform some operation on the traverser and pass it to the next step.</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The <code>Traverser&lt;S&gt;</code> object provides access to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The current traversed <code>S</code> object&#8201;&#8212;&#8201;<code>Traverser.get()</code>.</p>
</li>
<li>
<p>The current path traversed by the traverser&#8201;&#8212;&#8201;<code>Traverser.path()</code>.</p>
</li>
<li>
<p>The number of times the traverser has gone through a loop&#8201;&#8212;&#8201;<code>Traverser.loops()</code>.</p>
</li>
<li>
<p>The number of objects represented by this traverser&#8201;&#8212;&#8201;<code>Traverser.bulk()</code>.</p>
</li>
<li>
<p>The local sideEffect data structure associated with this traverser&#8201;&#8212;&#8201;<code>Traverser.sack()</code>.</p>
</li>
<li>
<p>The side-effects associated with the traversal&#8201;&#8212;&#8201;<code>Traverser.sideEffects()</code>.</p>
</li>
<li>
<p>A helper shorthand to get a particular side-effect&#8201;&#8212;&#8201;<code>Traverser.get(String) == Traverser.sideEffects().get(String)</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If a specific traversal step can do the necessary step-computation, use it. Lambda steps can not be optimized by the Gremlin <a href="#traversalstrategy">traversal strategies</a> and should only be used when the requisite computation does not have a corresponding standard Gremlin step. For example, instead of <code>filter{it.get().property('name').isPresent()}</code> use <code>has('name')</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/map-lambda.png" alt="map-lambda" width="150"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out() <b>(1)</b>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().map{<span class="local-variable">it</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)} <b>(2)</b>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out.back(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <b>(3)</b>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A standard outgoing traversal from vertex 1.</p>
</li>
<li>
<p>For each vertex outgoing adjacent to vertex 1, get the vertex at <code>a</code> (which is vertex 1).</p>
</li>
<li>
<p>The <a href="#back-step"><code>back()</code></a>-step is implemented as a <code>map()</code>-step that accesses side effects.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/filter-lambda.png" alt="filter-lambda" width="160"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().filter{<span class="local-variable">it</span>.get().property(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).isPresent()} <b>(1)</b>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) <b>(2)</b>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A filter that only allows the vertex to pass if it has an age property.</p>
</li>
<li>
<p>The more specific <code>has()</code>-step is implemented as a <code>filter()</code> with respective predicate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/side-effect-lambda.png" alt="side-effect-lambda" width="175"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).sideEffect{println <span class="local-variable">it</span>} <b>(1)</b>
v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
v[<span class="integer">2</span>]
==&gt;v[<span class="integer">2</span>]
v[<span class="integer">4</span>]
==&gt;v[<span class="integer">4</span>]
v[<span class="integer">6</span>]
==&gt;v[<span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Whatever enters sideEffect is passed to the next step, but some intervening process can occur.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="addedge-step">AddEdge Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/addedge-step.png" alt="addedge step" width="450">
</div>
</div>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Automated_reasoning">Reasoning</a> is the process of making explicit in the data was is implicit in the data. What is explicit in a graph are the objects of the graph&#8201;&#8212;&#8201;i.e. vertices and edges. What is implicit in the graph is the traversal. In other words, traversals expose meaning where the meaning is defined by the traversal description. For example, take the concept of a "co-developer." Two people are co-developers if they have worked on the same project together. This concept can be represented as a traversal and thus, the concept of "co-developers" can be derived. This is made possible with <code>addE()</code>-step (<strong>sideEffect</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).except(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <span class="comment">// marko can't be a co-developer with himself</span>
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).except(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).addBothE(<span class="string"><span class="delimiter">'</span><span class="content">co-developer</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">co-developer</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;josh
==&gt;peter
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">co-developer</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">co-developer</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it is possible to add an arbitrary number of key/value pairs (i.e. Object var args) to the <code>addE</code> steps to have those attached as properties to the created edges.</p>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-step">Aggregate Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/aggregate-step.png" alt="aggregate step" width="800">
</div>
</div>
<div class="paragraph">
<p>The <code>aggregate()</code>-step (<strong>sideEffect</strong>) is used to aggregate all the objects at a particular point of traversal into a Collection. The step uses <a href="http://en.wikipedia.org/wiki/Eager_evaluation">eager evaluation</a> in that no objects continue on until all previous objects have been fully aggregated (as opposed to <a href="#store-step"><code>store()</code></a> which <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazily</a> fills a collection). The eager evaluation nature is crucial in situations where everything at a particular point is required for future computation. An example is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="comment">// what has marko created?</span>
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>) <span class="comment">// aggregate all his creations</span>
==&gt;[v[<span class="integer">3</span>]]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="comment">// who are marko's collaborators</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="comment">// what have marko's collaborators created?</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).except(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="comment">// what have marko's collaborators created that he hasn't created?</span>
==&gt;ripple</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="http://en.wikipedia.org/wiki/Recommender_system">recommendation systems</a>, the above pattern is used:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"What has userA liked? Who else has liked those things? What have they liked that userA hasn't already liked?"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="back-step">Back Step</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional languages</a> make use of function composition and lazy evaluation to create complex computations from primitive operations. This is exactly what Gremlin <code>GraphTraversal</code> does. One of the differentiating aspects of Gremlin&#8217;s data flow approach to graph processing is that the flow need not always go "forward," but in fact, can go back to a previously seen area of computation. Examples include <a href="#jump-step"><code>jump()</code></a> as well as the <code>back()</code>-step (<strong>map</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().out().out()
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().out().out().path()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">3</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out().out().back(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V().out().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out().back(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().out().out().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).back(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>) <span class="comment">// pointless</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="choose-step">Choose Step</h3>
<div class="paragraph">
<p>The <code>choose()</code>-step (<strong>branch</strong>) allows for the current <code>Traverser&lt;T&gt;</code> to select which traversal branch to take. With <code>choose()</code>, it is possible to implement if/else-based semantics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).map{[<span class="local-variable">it</span>.get(), <span class="local-variable">it</span>.get().length()]}
==&gt;[marko, <span class="integer">5</span>]
==&gt;[vadas, <span class="integer">5</span>]
==&gt;[josh, <span class="integer">4</span>]
==&gt;[peter, <span class="integer">5</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).filter{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).length() == <span class="integer">5</span>}.in().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).filter{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).length() == <span class="integer">4</span>}.out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the facts above, the following examples show how to use <code>choose()</code> to select the values.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/choose-step.png" alt="choose step" width="700">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).choose({<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).length() == <span class="integer">5</span>},   <span class="comment">// If the predicate is true, then do `in`, else do `out`.</span>
  g.of().in(),
  g.of().out()).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).choose({<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).length()},   <span class="comment">// Use the result of the function as a key to the map of traversal choices.</span>
  [<span class="integer">5</span>:g.of().in(),
   <span class="integer">4</span>:g.of().out()]).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java8, there is no elegant syntax to create a <code>Map</code>. Thus, the last traversal above would look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">g.V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>).choose(v -&gt; v.get().value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).length(), <span class="keyword">new</span> <span class="predefined-type">HashMap</span>() {{
  put(<span class="integer">5</span>,g.of().in());
  put(<span class="integer">4</span>,g.of().out());
}}).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cyclicpath-step">CyclicPath Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/cyclicpath-step.png" alt="cyclicpath step" width="400">
</div>
</div>
<div class="paragraph">
<p>Each traverser maintains its history through the traversal over the graph&#8201;&#8212;&#8201;i.e. its <a href="#path-data-structure">path</a>. If it is important that the traverser repeat its course, then <code>cyclic()</code>-path should be used (<strong>filter</strong>). The step analyzes the path of the traverser thus far and if there are any repeats, the traverser is filtered out over the traversal computation. If non-cyclic behavior is desired, see <a href="#simplepath-step"><code>simplePath()</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).both().both()
==&gt;v[<span class="integer">1</span>]  <span class="comment">// back to v[1]</span>
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">1</span>]  <span class="comment">// back to v[1]</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]  <span class="comment">// back to v[1]</span>
gremlin&gt; g.v(<span class="integer">1</span>).both().both().cyclicPath()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">1</span>).both().both().cyclicPath().path()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">3</span>], v[<span class="integer">1</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">2</span>], v[<span class="integer">1</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">1</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dedup-step">Dedup Step</h3>
<div class="paragraph">
<p>With <code>dedup()</code>-step (<strong>filter</strong>), repeatedly seen objects are removed from the traversal stream. Note that if a traverser&#8217;s bulk is greater than 1, then it is set to 1 before being emitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>)
==&gt;java
==&gt;java
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>).dedup()
==&gt;java</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a lambda is provided to <code>dedup()</code>, then the object is processed by the lambda prior to determining if it has been seen or not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).map{[<span class="local-variable">it</span>.get(), <span class="local-variable">it</span>.get().length()]}
==&gt;[marko, <span class="integer">5</span>]
==&gt;[vadas, <span class="integer">5</span>]
==&gt;[lop, <span class="integer">3</span>]
==&gt;[josh, <span class="integer">4</span>]
==&gt;[ripple, <span class="integer">6</span>]
==&gt;[peter, <span class="integer">5</span>]
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).dedup{<span class="local-variable">it</span>.get().length()}
==&gt;marko
==&gt;lop
==&gt;josh
==&gt;ripple</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>dedup()</code>-step does not have a correlate in <a href="#traversalvertexprogram">Gremlin OLAP</a> when used mid-traversal. When in mid-traversal de-duplication only occurs at the the current processing vertex and thus, is not a global operation as it in Gremlin OLTP. When <code>dedup()</code> is an end step, the resultant traversers are de-duplicated by <code>TraverserMapReduce</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="except-step">Except Step</h3>
<div class="paragraph">
<p>The <code>except()</code>-step (<strong>filter</strong>) can be used to remove objects from the traversal stream. If <code>except()</code> is provided a string, then the excepting object is located at <code>traverser.sideEffects().get(label)</code>. If <code>except()</code> is provided a collection, then any object contained in that collection is filtered out. Please see the related <a href="#retain-step"><code>retain()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).except(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>) <span class="comment">// co-developers</span>
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;josh
==&gt;peter
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).except([<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>])
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fold-step">Fold Step</h3>
<div class="paragraph">
<p>There are situations when the traversal stream needs a "barrier" to aggregate all the objects and emit a computation that is a function of the aggregate. The <code>fold()</code>-step (<strong>map</strong>) is one particular instance of this. Please see <a href="#unfold-step"><code>unfold()</code></a>-step for the inverse functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold() <b>(1)</b>
==&gt;[vadas, josh]
gremlin&gt; g.v(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold(<span class="integer">0</span>){a,b -&gt; a + b.get().length()} <b>(2)</b>
==&gt;<span class="integer">9</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A parameterless <code>fold()</code> will aggregate all the objects into a list and then emit the list.</p>
</li>
<li>
<p><code>fold()</code> can be provided two arguments&#8201;&#8212;&#8201; a seed value and a reduce bi-function.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="groupby-step">GroupBy Step</h3>
<div class="paragraph">
<p>As traversers propagate across a graph as defined by a traversal, sideEffect computations are sometimes required. That is, the actually path taken or the current location of a traverser is not the ultimate output of the computation, but some other representation of the traversal. The <code>groupBy()</code>-step (<strong>sideEffect</strong>) is one such sideEffect that organizes the objects according to some function of the object. Then, if required, that organization (a list) is reduced. An example is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().groupBy{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}   <span class="comment">// group the vertices by the second letter of their name</span>
==&gt;[<span class="key">a</span>:[v[<span class="integer">1</span>], v[<span class="integer">2</span>]], <span class="key">e</span>:[v[<span class="integer">6</span>]], <span class="key">i</span>:[v[<span class="integer">5</span>]], <span class="key">o</span>:[v[<span class="integer">3</span>], v[<span class="integer">4</span>]]]
gremlin&gt; g.V().groupBy{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}   <span class="comment">// for each vertex in the group, get their name (now the name[1] is apparent)</span>
==&gt;[<span class="key">a</span>:[marko, vadas], <span class="key">e</span>:[peter], <span class="key">i</span>:[ripple], <span class="key">o</span>:[lop, josh]]
gremlin&gt; g.V().groupBy{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}{<span class="local-variable">it</span>.size()}   <span class="comment">// for each grouping, what is it's size?</span>
==&gt;[<span class="key">a</span>:<span class="integer">2</span>, <span class="key">e</span>:<span class="integer">1</span>, <span class="key">i</span>:<span class="integer">1</span>, <span class="key">o</span>:<span class="integer">2</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three lambda parameters of <code>groupBy</code> are discussed below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Key-lambda: What feature of the object to group on (a function that yields the map key)?</p>
</li>
<li>
<p>Value-lambda: What feature of the group to store in the key-list?</p>
</li>
<li>
<p>Reduce-lambda: What feature of the key-list to ultimately return?</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>groupBy()</code>-step does not have a correlate in <a href="#traversalvertexprogram">Gremlin OLAP</a> when used mid-traversal. When in mid-traversal grouping only occurs at the the current processing vertex and thus, is not a global operation as it in Gremlin OLTP. However, <code>GroupByMapReduce</code> provides unified groups at the end of the traversal computation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="groupcount-step">GroupCount Step</h3>
<div class="paragraph">
<p>When it is important to know how many times a particular object has been at a particular part of a traversal, <code>groupCount()</code>-step (<strong>sideEffect</strong>) is used.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"What is the distribution of ages in the graph?"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount()
==&gt;[<span class="integer">32</span>:<span class="integer">1</span>, <span class="integer">35</span>:<span class="integer">1</span>, <span class="integer">27</span>:<span class="integer">1</span>, <span class="integer">29</span>:<span class="integer">1</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)} <span class="comment">// you can also supply a pre-group lambda</span>
==&gt;[<span class="integer">32</span>:<span class="integer">1</span>, <span class="integer">35</span>:<span class="integer">1</span>, <span class="integer">27</span>:<span class="integer">1</span>, <span class="integer">29</span>:<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one person that is 32, one person that is 35, one person that is 27, and one person that is 29.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Iteratively walk the graph and count the number of times you see the second letter of each name."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/groupcount-step.png" alt="groupcount step" width="500">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}.jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">10</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:<span class="integer">19598</span>, <span class="key">e</span>:<span class="integer">5740</span>, <span class="key">i</span>:<span class="integer">5740</span>, <span class="key">o</span>:<span class="integer">27716</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above is interesting in that it demonstrates the use of referencing the internal <code>Map&lt;Object,Long&gt;</code> of <code>groupCount</code> with a string variable. Given that <code>groupCount</code> is a sideEffect-step, it simply passes the object it received to its output. Internal to <code>groupCount</code>, the object&#8217;s count is incremented. If <code>groupCount</code> is the last step in the traversal, the <code>SideEffectCapStrategy</code> (see <a href="#traversalstrategy">Traversal Strategy</a>) automatically returns the internal map. However, if the <code>groupCount</code> is not the last step, then the sideEffect data structure (i.e. the internal map of <code>groupCount</code>) can be accessed with <code>cap</code>-step by referencing the desired variable.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>groupCount()</code>-step does not have a correlate in <a href="#traversalvertexprogram">Gremlin OLAP</a> when used mid-traversal. When in mid-traversal grouping only occurs at the the current processing vertex and thus, is not a global operation as it in Gremlin OLTP. However, <code>GroupCountMapReduce</code> provides unified groups at the end of the traversal computation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="has-step">Has Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/has-step.png" alt="has step" width="670">
</div>
</div>
<div class="paragraph">
<p>It is possible to filter vertices, edges, and vertex properties based on their properties using <code>has()</code>-step (<strong>filter</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).out().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,within,[<span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>])
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).out().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,within,[<span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>]).outE().has(label,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are accessors available in the <code>T</code> "tokens" class. They include <code>label</code>, <code>id</code>, <code>key</code>, and <code>value</code>. Thus, it is possible to use <code>has()</code>-step to also filter on these aspects of an element.</p>
</div>
</div>
<div class="sect2">
<h3 id="inject-step">Inject Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/inject-step.png" alt="inject step" width="800">
</div>
</div>
<div class="paragraph">
<p>One of the major features of TinkerPop3 is "injectable steps." This makes it possible to insert objects arbitrarily into a traversal stream. This is how <a href="#jump-step">jump()</a> is implemented. In general, <code>inject()</code>-step (<strong>sideEffect</strong>) exists and a few examples are provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop
==&gt;daniel
gremlin&gt; g.v(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>).map{<span class="local-variable">it</span>.get().length()}
==&gt;<span class="integer">6</span>
==&gt;<span class="integer">3</span>
==&gt;<span class="integer">6</span>
gremlin&gt; g.v(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>).map{<span class="local-variable">it</span>.get().length()}.path()
==&gt;[v[<span class="integer">4</span>], v[<span class="integer">5</span>], ripple, <span class="integer">6</span>]
==&gt;[v[<span class="integer">4</span>], v[<span class="integer">3</span>], lop, <span class="integer">3</span>]
==&gt;[daniel, <span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last example above, note that the path starting with <code>daniel</code> is only of length 2. This is because the <code>daniel</code> string was inserted half-way in the traversal. Finally, a typical use case is provided below&#8201;&#8212;&#8201;when the start of the traversal is not a graph object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>)
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>).map{<span class="local-variable">it</span>.get() + <span class="integer">1</span>}
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>).map{<span class="local-variable">it</span>.get() + <span class="integer">1</span>}.map{g.v(<span class="local-variable">it</span>.get())}.values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;lop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interval-step">Interval Step</h3>
<div class="paragraph">
<p>The <code>interval()</code>-step (<strong>filter</strong>) is similar to <a href="#has-step"><code>has()</code></a>-step in that it filters elements according to their properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().interval(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="integer">20</span>,<span class="integer">30</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.V().interval(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="integer">20</span>,<span class="integer">30</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt,<span class="integer">20</span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,lte,<span class="integer">30</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) <span class="comment">// the equivalent expression using only has()</span>
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jump-step">Jump Step</h3>
<div class="paragraph">
<p>TinkerPop3 introduces the <code>jump()</code>-step (<strong>branch</strong>). This step allows the propagating traverser object to jump to any arbitrary section of the <code>Traversal</code>. Typically, this is determined by means of a predicate. In particular, with <code>jump</code>, the Gremlin is no longer constrained to <strong>do-while</strong> semantics, but can as well support <strong>while-do</strong> (see <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/while.html">Java Documentation on While</a>). Below are some examples of <code>jump()</code> in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops()&lt;<span class="integer">2</span>}.values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(1)</b>
==&gt;ripple
==&gt;lop
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops()&gt;<span class="integer">1</span>}.out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(2)</b>
==&gt;ripple
==&gt;lop
gremlin&gt; g.v(<span class="integer">1</span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().out().out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(3)</b>
==&gt;marko</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>do-while semantics as found in the classic <code>loop()</code>-step in TinkerPop2.</p>
</li>
<li>
<p>while-do semantics as introduced in TinkerPop3. Jump to step <code>b</code> if loops greater than 1 else, <code>out</code> and jump back to <code>a</code> (see  <a href="#until-step"><code>until()</code></a>).</p>
</li>
<li>
<p>a non-predicate based jump where <code>out.out.out</code> is seen as inert code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a predetermined number of loops is known, it is possible to avoid the use of the jump-predicate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="integer">2</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jump()</code>-step also supports an "emit predicate." Whereby the traverser is split in two&#8201;&#8212;&#8201;the traverser exits the code block as well as continues back within the code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops()&lt;<span class="integer">2</span>}{<span class="predefined-constant">true</span>}.values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
==&gt;vadas
==&gt;josh
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jump-step.png" alt="jump step" width="500">
</div>
</div>
<div class="paragraph">
<p>The first time through the jump-sequence, the vertices lop, vadas, and josh are seen. Given that the loops==0, then traverser jumps back to step <code>a</code>. However, because the emit-predicate is declared true, those vertices are emitted from jump-sequence. At step 2 (loops==1), the vertices traversed are ripple and lop (Josh&#8217;s created projects, as lop and vadas have no out edges) and are also emitted. loops==1 now so the traverser jumps back to step <code>a</code>. As ripple and lop have no out edges there are no vertices to traverse. Given that the loops==2 now it wil fail the predicate. Therefore, the traverser has seen the vertices: lop, vadas, josh, ripple, and lop.</p>
</div>
<div class="paragraph">
<p>The <code>jump()</code>-step highlights one of the major benefits of <code>Traverser&lt;T&gt;</code> in TinkerPop3: the ability to take a traverser and place it anywhere in the Traversal step-sequence. Because a traverser maintains all the metadata associated with its particular walk, and no step maintains state information about a traverser, traversers can be arbitrarily relocated without ill-effects.</p>
</div>
</div>
<div class="sect2">
<h3 id="match-step">Match Step</h3>
<div class="paragraph">
<p>The <code>match()</code>-step (<strong>map</strong>) is introduced into TinkerPop3 to support a more <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative</a> form of <a href="http://en.wikipedia.org/wiki/Pattern_matching">pattern matching</a>. Similar constructs were available in previous TinkerPop versions via the <code>table()</code>-step, but that has since been removed in favor of the <code>match().select()</code>-pattern. With MatchStep in TinkerPop, a query optimizer similar to the <a href="http://www.knowledgefrominformation.com/2011/04/16/budget-match-cost-effective-subgraph-matching-on-large-networks/">budget match algorithm</a> builds and revises query plans on the fly, while a query is in progress. For very large graphs, where the developer is uncertain of the statistics of the graph (e.g. how many <code>knows</code>-edges vs. <code>worksFor</code>-edges exist in the graph), it is advantageous to use <code>match()</code>, as an optimal plan will be determined automatically.  Furthermore, some queries are much easier to express via <code>match()</code> than with single-path traversals.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Who created a project named 'lop' that was also created by someone who is 29 years old? Return the two creators."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/match-step.png" alt="match step" width="500">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>)).
          select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter, <span class="key">c</span>:marko]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the above can also be more concisely written as below which demonstrates that imperative inner-traversals can be arbitrarily defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
          select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter, <span class="key">c</span>:marko]</code></pre>
</div>
</div>
<div class="paragraph">
<p>MatchStep brings functionality similar to <a href="http://en.wikipedia.org/wiki/SPARQL">SPARQL</a> to Gremlin. Like SPARQL, MatchStep conjoins a set of patterns applied to a graph.  For example, the following traversal finds exactly those songs which Jerry Garcia has both sung and written (using the Grateful Dead graph distributed in the <code>data/</code> directory):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.loadGraphML(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">writtenBy</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">sungBy</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;CREAM PUFF WAR
==&gt;CRYPTICAL ENVELOPMENT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Among the features which differentiate <code>match()</code> from SPARQL are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>), <b>(1)</b>
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).out().jump(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>,<span class="integer">2</span>)). <b>(2)</b>
           select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).dedup().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(3)</b>
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>Patterns of arbitrary complexity</strong>: <code>match()</code> is not restricted to triple patterns or property paths.</p>
</li>
<li>
<p><strong>Recursion support</strong>: <code>match()</code> supports the branch-based steps within a pattern, including <code>jump()</code>.</p>
</li>
<li>
<p><strong>Imperative/declarative hybrid</strong>: Pre and prior to a <code>match()</code>, it is possible to leverage classic Gremlin imperative.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To extend point #3, it is possible to support going from imperative, to declarative, to imperative, ad infinitum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>)).
          select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
          out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
          match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
          select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like all other steps in Gremlin, <code>match()</code> is a function and thus, <code>match()</code> within <code>match()</code> is a natural consequence of Gremlin&#8217;s functional foundation (i.e. recursive matching).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).match(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,
                g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>),
                g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).select(<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
            select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:ripple]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Currently, <code>match()</code> does not operate within a multi-JVM <a href="#graphcomputer">GraphComputer</a> OLAP environment. Future work includes a linearization <a href="#traversalstrategy">TraversalStrategy</a> for <code>match()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="using-where-with-match">Using Where with Match</h4>
<div class="paragraph">
<p>Match is typically used in conjunction with both <code>select()</code> (demonstrated previously) and <code>where()</code> (presented here). A <code>where()</code> allows the user to further constrain the result set provided by <code>match()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
              where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, neq, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
               select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:josh]
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:peter]
==&gt;[<span class="key">a</span>:josh, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh, <span class="key">c</span>:peter]
==&gt;[<span class="key">a</span>:peter, <span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter, <span class="key">c</span>:josh]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>where()</code>-step can take either a <code>BiPredicate</code> (first example below) or a <code>Traversal</code> (second example below). Using <code>MatchWhereStrategy</code>, <code>where()</code>-clauses can be automatically folded into <code>match()</code> and thus, subject to <code>match()</code>-steps budget-match algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; traversal = g.V().match(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
            g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
              where(g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)). <b>(1)</b>
               select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}; <span class="predefined-constant">null</span> <b>(2)</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; traversal.toString()
==&gt;[TinkerGraphStep(vertex), MatchStep, WhereStep, SelectStep] <b>(3)</b>
gremlin&gt; traversal.getStrategies().apply()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; traversal.toString()
==&gt;[TinkerGraphStep(vertex), MatchStep, SelectStep] <b>(4)</b>
gremlin&gt; traversal <b>(5)</b>
==&gt;[<span class="key">a</span>:marko, <span class="key">c</span>:josh] <b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A <code>where()</code>-step with a traversal containing variable bindings declared in <code>match()</code>.</p>
</li>
<li>
<p>A useful trick to ensure that that the traversal is not iterated by Gremlin Console.</p>
</li>
<li>
<p>The string representation of the traversal prior to its strategies being applied.</p>
</li>
<li>
<p>The string representation of the traversal after the strategies have been applied (and thus, <code>where()</code> is folded into <code>match()</code>)</p>
</li>
<li>
<p>The Gremlin Console will automatically iterate anything that is an iterator or is iterable.</p>
</li>
<li>
<p>Both marko and josh are co-developers and marko knows josh.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="order-step">Order Step</h3>
<div class="paragraph">
<p>When the objects of the traversal stream need to be sorted, <code>order()</code>-step (<strong>map</strong>) can be leveraged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order()
==&gt;josh
==&gt;lop
==&gt;marko
==&gt;peter
==&gt;ripple
==&gt;vadas
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order(decr)
==&gt;vadas
==&gt;ripple
==&gt;peter
==&gt;marko
==&gt;lop
==&gt;josh
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order{a,b -&gt; a.get()[<span class="integer">1</span>] &lt;=&gt; b.get[<span class="integer">1</span>]} <span class="comment">// order by the second letter</span>
==&gt;marko
==&gt;vadas
==&gt;peter
==&gt;ripple
==&gt;lop
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>order()</code> takes a <code>Comparator</code> var args and thus, its possible to do secondary sorting. Secondary sorting is presented below along with the handy <code>Comparator.comparing()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; <span class="keyword">import</span> <span class="include">static</span> <span class="include">java.util.Comparator.*</span>
...
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order(comparing{<span class="local-variable">it</span>.get()[<span class="integer">1</span>]}) <span class="comment">// order by the second letter</span>
==&gt;marko
==&gt;vadas
==&gt;peter
==&gt;ripple
==&gt;lop
==&gt;josh
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order(comparing{<span class="local-variable">it</span>.get()[<span class="integer">1</span>]},comparing{<span class="local-variable">it</span>.get()[<span class="integer">12</span>]}) <span class="comment">// order by second letter and if a tie, the third letter</span>
==&gt;vadas
==&gt;marko
==&gt;peter
==&gt;ripple
==&gt;lop
==&gt;josh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="orderby-step">OrderBy Step</h3>
<div class="paragraph">
<p>One of the most traversed objects in a traversal is an <code>Element</code>. An element can have properties associated with it (i.e. key/value pairs). In many situations, it is desirable to sort an element traversal stream according to a comparison of their properties. The <code>orderBy()</code>-step (<strong>map</strong>) exists to support this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content"> is </span><span class="delimiter">'</span></span> + <span class="local-variable">it</span>.get()}
==&gt;marko is v[<span class="integer">1</span>]
==&gt;vadas is v[<span class="integer">2</span>]
==&gt;lop is v[<span class="integer">3</span>]
==&gt;josh is v[<span class="integer">4</span>]
==&gt;ripple is v[<span class="integer">5</span>]
==&gt;peter is v[<span class="integer">6</span>]
gremlin&gt; g.V().orderBy(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content"> is </span><span class="delimiter">'</span></span> + <span class="local-variable">it</span>.get()}
==&gt;josh is v[<span class="integer">4</span>]
==&gt;lop is v[<span class="integer">3</span>]
==&gt;marko is v[<span class="integer">1</span>]
==&gt;peter is v[<span class="integer">6</span>]
==&gt;ripple is v[<span class="integer">5</span>]
==&gt;vadas is v[<span class="integer">2</span>]
gremlin&gt; g.V().orderBy(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,decr).map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content"> is </span><span class="delimiter">'</span></span> + <span class="local-variable">it</span>.get()}
==&gt;vadas is v[<span class="integer">2</span>]
==&gt;ripple is v[<span class="integer">5</span>]
==&gt;peter is v[<span class="integer">6</span>]
==&gt;marko is v[<span class="integer">1</span>]
==&gt;lop is v[<span class="integer">3</span>]
==&gt;josh is v[<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>orderBy()</code>-step allows the user to provide an arbitrary number of comparators for primary, secondary, etc. sorting. These comparators can be lambdas or they can be pre-defined enums (e.g. <code>Order.incr</code>). It is always best to use a pre-defined enum instead of a generic lambda as the underlying vendor may be able to optimize the execution when the comparator is inspectable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="path-step">Path Step</h3>
<div class="paragraph">
<p>A traverser is transformed as it moves through a series of steps within a <code>Traversal</code>. The history of the traverser is realized by examining its path with <code>path()</code>-step (<strong>map</strong>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/path-step.png" alt="path step" width="650">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).path()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">5</span>], ripple]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">3</span>], lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If edges are required in the path, then be sure to traverser those edges explicitly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().outE().inV().outE().inV().path()
==&gt;[v[<span class="integer">1</span>], e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>], v[<span class="integer">4</span>], e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>], v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>], e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>], v[<span class="integer">4</span>], e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>], v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to provide a var args of lamdas to post-process the elements of the path in a round-robin fashion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().out().out().path{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)}
==&gt;[marko, <span class="integer">32</span>, ripple]
==&gt;[marko, <span class="integer">32</span>, lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, because of lambda post-processing, nothing prevents the lambda from triggering yet another traversal. In the traversal below, for each element of the path traversed thus far, if its a person (as determined by having an <code>age</code>-property), then get all of their creations, else if its a creation, get all the people that created it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().out().out().path{
  <span class="local-variable">it</span>.choose({<span class="local-variable">it</span>.get().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).hasNext()},
    g.of().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>),
    g.of().in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).toList()}
==&gt;[[lop], [ripple, lop], [josh]]
==&gt;[[lop], [ripple, lop], [marko, josh, peter]]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Generating path information is expensive as the history of the traverser is stored into a Java list. With numerous traversers, there are numerous lists. Moreover, in an OLAP <a href="#graphcomputer"><code>GraphComputer</code></a> environment this becomes exceedingly prohibitive as there are traversers emanating from all vertices in the graph in parallel. In OLAP there are optimizations provided for traverser populations, but when paths are calculated (and each traverser is unique due to its history), then these optimizations are no longer possible.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="path-data-structure">Path Data Structure</h4>
<div class="paragraph">
<p>The <code>Path</code> data structure is an ordered list of objects, where each object is associated to a <code>Set&lt;String&gt;</code> of labels. An example is presented below to demonstrate both the <code>Path</code> API as well as how a traversal yields labeled paths.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/path-data-structure.png" alt="path data structure" width="350">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; path = g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">d</span><span class="delimiter">'</span></span>).identity().as(<span class="string"><span class="delimiter">'</span><span class="content">e</span><span class="delimiter">'</span></span>).path().next()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">5</span>], ripple]
gremlin&gt; path.size()
==&gt;<span class="integer">4</span>
gremlin&gt; path.objects()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;ripple
gremlin&gt; path.labels()
==&gt;[a, b]
==&gt;<span class="type">[]</span>
==&gt;[c]
==&gt;[d, e]
gremlin&gt; path.a
==&gt;v[<span class="integer">1</span>]
gremlin&gt; path.b
==&gt;v[<span class="integer">1</span>]
gremlin&gt; path.c
==&gt;v[<span class="integer">5</span>]
gremlin&gt; path.d == path.e
==&gt;<span class="predefined-constant">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="profile-step">Profile Step</h3>
<div class="paragraph">
<p>The <code>profile()</code>-step (<strong>sideEffect</strong>) exists to allow developers to profile their traversals to determine statistical information like step runtime, counts, etc. The <code>profile()</code>-step can only be used if the system property <code>tinkerpop.profiling</code> is set to <code>true</code>. Thus, prior to starting the Gremlin Console, set <code>JAVA_OPTIONS</code> accordingly.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When profiling is enabled, traversals are more costly to execute. Thus, be sure to not have <code>tinkerpop.profiling</code> set to <code>true</code> in any production or query time critical application. The best way to determine if profiling is enabled is to see if an <code>IllegalArgumentException</code> is thrown when the <code>profile()</code> step is used. If there is no exception, then profiling is enabled.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="error">$</span> JAVA_OPTIONS=-Dtinkerpop.profiling=<span class="predefined-constant">true</span>
<span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
plugin <span class="key">activated</span>: tinkerpop.tinkergraph
gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V().out().out().profile()
==&gt;Traversal Metrics
                            Step       Count Traversers       <span class="predefined-type">Time</span> (ms)   % Dur
         TinkerGraphStep(vertex)           <span class="integer">6</span>          <span class="integer">6</span>           <span class="float">0.020</span>    <span class="float">1.62</span>
          VertexStep(OUT,vertex)           <span class="integer">6</span>          <span class="integer">6</span>           <span class="float">1.165</span>   <span class="float">94.10</span>
          VertexStep(OUT,vertex)           <span class="integer">2</span>          <span class="integer">2</span>           <span class="float">0.032</span>    <span class="float">2.58</span>
                     ProfileStep           <span class="integer">2</span>          <span class="integer">2</span>           <span class="float">0.004</span>    <span class="float">0.32</span>
               SideEffectCapStep           <span class="integer">1</span>          <span class="integer">1</span>           <span class="float">0.017</span>    <span class="float">1.37</span>
                           TOTAL           -          -           <span class="float">1.238</span>       -
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>profile()</code>-step generates a <code>TraversalMetrics</code> object that contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Step</code>: A step within the traversal being profiled.</p>
</li>
<li>
<p><code>Count</code>: The number of <em>represented</em> traversers that passed through the step.</p>
</li>
<li>
<p><code>Traversers</code>: The number of traversers that passed through the step.</p>
</li>
<li>
<p><code>Time (ms)</code>: The total time the step was actively executing its behavior.</p>
</li>
<li>
<p><code>% Dur</code>: The percentage of total time spent in the step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-exercise.png" alt="gremlin-exercise" width="120"></span> It is important to understand the difference between <code>Count</code> and <code>Traversers</code>. Traversers can be merged and as such, when two traversers are "the same" they may be aggregated into a single traverser. That new traverser has a <code>Traverser.bulk()</code> that is the sum of the two merged traverser bulks. On the other hand, the <code>Count</code> represents the sum of all <code>Traverser.bulk()</code> results and thus, expresses the number of "represented" (not enumerated) traversers. <code>Traversers</code> will always be less than or equal to <code>Count</code>.</p>
</div>
<div class="paragraph">
<p>If <code>-Dtinkerpop.profiling=true</code> is not set, then the following exception occurs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
plugin <span class="key">activated</span>: tinkerpop.tinkergraph
gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V().out().out().profile()
The profile()-step can only be used when profiling is enabled via <span class="string"><span class="delimiter">'</span><span class="content">gremlin.sh -p</span><span class="delimiter">'</span></span> or directly via -Dtinkerpop.profiling=<span class="predefined-constant">true</span>
Display stack trace? [yN]
gremlin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is possible to enabled profiling for a Gremlin Console session via <code>gremlin.sh -p</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="random-step">Random Step</h3>
<div class="paragraph">
<p>To randomly filter out a traverser, use <code>random()</code>-step (<strong>filter</strong>). The provided double argument biases the "coin toss."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().random(<span class="float">0.5</span>)
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().random(<span class="float">0.0</span>)
gremlin&gt; g.V().random(<span class="float">1.0</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="range-step">Range Step</h3>
<div class="paragraph">
<p>As traversers propagate through the traversal, it is possible to only allow a certain number of them to pass through with <code>range()</code>-step (<strong>filter</strong>). When the low-end of the range is not met, objects are continued to be iterated. When within the low and high range (both inclusive), traversers are emitted. Finally, when above the high range, the traversal breaks out of iteration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().range(<span class="integer">0</span>,<span class="integer">3</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().range(<span class="integer">1</span>,<span class="integer">3</span>)
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).both().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="integer">1000000</span>).range(<span class="integer">6</span>,<span class="integer">10</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retain-step">Retain Step</h3>
<div class="paragraph">
<p>The <code>retain()</code>-step (<strong>filter</strong>) can be used to filter objects from the traversal stream that don&#8217;t match the provided criteria. If <code>retain()</code> is provided a string, the retaining object is retrieved via <code>traverser.sideEffects().get(label)</code>. If <code>retain()</code> is provided a collection, then any object not contained in that collection is filtered out. Please see the related <a href="#except-step"><code>except()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).retain(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;josh
==&gt;peter
gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).retain([<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>])
==&gt;marko</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sack-step">Sack Step</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-sacks-running.png" alt="gremlin-sacks-running" width="175"></span> A traverser can contain a local data structure called a "sack". The <code>sack()</code>-step is used to read and write sacks (<strong>sideEffect</strong> or <strong>map</strong>). Each sack of each traverser is created when using <code>GraphTraversal.withSack(initialValueSupplier,splitOperator?)</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Initial value supplier</strong>: A <code>Supplier</code> providing the initial value of each traverser&#8217;s sack.</p>
</li>
<li>
<p><strong>Split operator</strong>: a <code>UnaryOperator</code> that clones the traverser&#8217;s sack when the traverser splits. If no split operator is provided, then <code>UnaryOperator.identity()</code> is assumed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two trivial examples are presented below to demonstrate the <strong>initial value supplier</strong>. In the first example below, a traverser is created at each vertex in the graph (<code>g.V()</code>), with a 1.0 sack (<code>withSack{1.0f}</code>), and then the sack value is accessed (<code>sack()</code>). In the second example, a random float supplier is used to generate sack values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().withSack{<span class="float">1.0f</span>}.sack()
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
gremlin&gt; rand = <span class="keyword">new</span> <span class="predefined-type">Random</span>()
==&gt;java.util.Random<span class="error">@</span><span class="integer">12</span>a160c2
gremlin&gt; g.V().withSack{rand.nextFloat()}.sack()
==&gt;<span class="float">0.20819736</span>
==&gt;<span class="float">0.39894062</span>
==&gt;<span class="float">0.1775086</span>
==&gt;<span class="float">0.85114276</span>
==&gt;<span class="float">0.8067685</span>
==&gt;<span class="float">0.21980786</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A more complicated initial value supplier example is presented below where the sack values are used in a running computation and then emitted at the end of the traversal. When an edge is traversed, the edge weight is multiplied by the sack value (<code>sack(mult,'weight')</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().withSack{<span class="float">1.0f</span>}.as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).outE().sack(mult,<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV().jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">2</span>)
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().withSack{<span class="float">1.0f</span>}.as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).outE().sack(mult,<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV().jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">2</span>).sack()
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">0.4</span>
gremlin&gt; g.V().withSack{<span class="float">1.0f</span>}.as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).outE().sack(mult,<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV().jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">2</span>).path{<span class="local-variable">it</span>}{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>)}
==&gt;[v[<span class="integer">1</span>], <span class="float">1.0</span>, v[<span class="integer">4</span>], <span class="float">1.0</span>, v[<span class="integer">5</span>]]   <span class="comment">// 1.0 * 1.0 * 1.0 = 1.0</span>
==&gt;[v[<span class="integer">1</span>], <span class="float">1.0</span>, v[<span class="integer">4</span>], <span class="float">0.4</span>, v[<span class="integer">3</span>]]   <span class="comment">// 1.0 * 1.0 * 0.4 = 0.4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-sacks-standing.png" alt="gremlin-sacks-standing" width="100"></span> When complex objects are used (i.e. non-primitives), then a <strong>split operator</strong> should be defined to ensure that each traverser gets a clone of its parent&#8217;s sack. The first example does not use a split operator and as such, the same map is propagated to all traversers (a global data structure). The second example, demonstrates how <code>Map.clone()</code> ensures that each traverser&#8217;s sack contains a unique, local sack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().withSack { [:] }.
           out().out().
           sack { m, v -&gt; m[v.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)] = v.value(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>); m }.sack() <span class="comment">// BAD: single map</span>
==&gt;[<span class="key">ripple</span>:java]
==&gt;[<span class="key">ripple</span>:java, <span class="key">lop</span>:java]
gremlin&gt; g.V().withSack { [:] } { m -&gt; m.clone() }.
           out().out().
           sack { m, v -&gt; m[v.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)] = v.value(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>); m }.sack() <span class="comment">// GOOD: cloned map</span>
==&gt;[<span class="key">ripple</span>:java]
==&gt;[<span class="key">lop</span>:java]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For primitives (i.e. integers, longs, floats, etc.), a split operator is not required as a primitives are encoded in the memory address and of the sack, not as a reference to an object.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="select-step">Select Step</h3>
<div class="paragraph">
<p>There are two use cases for <code>select()</code>-step (<strong>map</strong>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select labeled steps within a path (as defined by <code>as()</code> in a traversal).</p>
</li>
<li>
<p>Select objects out of a <code>Map&lt;String,Object&gt;</code> flow (i.e. a sub-map).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first use case is demonstrated via example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>) <span class="comment">// no select</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select()
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">b</span>:v[<span class="integer">4</span>], <span class="key">c</span>:v[<span class="integer">5</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">b</span>:v[<span class="integer">4</span>], <span class="key">c</span>:v[<span class="integer">3</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>])
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">b</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">b</span>:v[<span class="integer">4</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>]){<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:josh]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <span class="comment">// if the selection is one step, no map is returned</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second use case is best understood in terms of <a href="#match-step"><code>match()</code></a>-step where the result of <code>match()</code> is a <code>Map&lt;String,Object&gt;</code> of variable bindings. However, any step that emits a <code>Map&lt;String,Object&gt;</code> can be selected. A contrived example is presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V()[<span class="integer">0</span>..<span class="integer">1</span>].as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).map{[<span class="key">b</span>:<span class="integer">1</span>,<span class="key">c</span>:<span class="integer">2</span>]} <b>(1)</b>
==&gt;[<span class="key">b</span>:<span class="integer">1</span>, <span class="key">c</span>:<span class="integer">2</span>]
==&gt;[<span class="key">b</span>:<span class="integer">1</span>, <span class="key">c</span>:<span class="integer">2</span>]
gremlin&gt; g.V()[<span class="integer">0</span>..<span class="integer">1</span>].as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).map{[<span class="key">b</span>:<span class="integer">1</span>,<span class="key">c</span>:<span class="integer">2</span>]}.select() <b>(2)</b>
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">b</span>:<span class="integer">1</span>, <span class="key">c</span>:<span class="integer">2</span>]
==&gt;[<span class="key">a</span>:v[<span class="integer">2</span>], <span class="key">b</span>:<span class="integer">1</span>, <span class="key">c</span>:<span class="integer">2</span>]
gremlin&gt; g.V()[<span class="integer">0</span>..<span class="integer">1</span>].as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).map{[<span class="key">b</span>:<span class="integer">1</span>,<span class="key">c</span>:<span class="integer">2</span>]}.select([<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]) <b>(3)</b>
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>], <span class="key">c</span>:<span class="integer">2</span>]
==&gt;[<span class="key">a</span>:v[<span class="integer">2</span>], <span class="key">c</span>:<span class="integer">2</span>]
gremlin&gt; g.V()[<span class="integer">0</span>..<span class="integer">1</span>].as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).map{[<span class="key">b</span>:<span class="integer">1</span>,<span class="key">c</span>:<span class="integer">2</span>]}.select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>) <b>(4)</b>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A contrived example to create a <code>Map&lt;String,Object&gt;</code> flow as a foundation for the examples to follow.</p>
</li>
<li>
<p>Select will grab both labeled steps and <code>Map&lt;String,Object&gt;</code> entries.</p>
</li>
<li>
<p>The same <code>List&lt;String&gt;</code> selectivity can be used as demonstrated in the previous example.</p>
</li>
<li>
<p>If a single selection is used, then the object is emitted not wrapped in a map. Useful for continuing the traversal process without having to do a map projection.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="using-where-with-select">Using Where with Select</h4>
<div class="paragraph">
<p>Finally, like <a href="#match-step"><code>match()</code></a>-step, it is possible to use <code>where()</code>, as where is a filter that processes <code>Map&lt;String,Object&gt;</code> streams.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)} <b>(1)</b>
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:peter, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:peter, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:peter, <span class="key">b</span>:peter]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           select{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}.
             where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>) <b>(2)</b>
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:josh, <span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:peter, <span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:peter, <span class="key">b</span>:josh]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(). <b>(3)</b>
              where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
              where(g.of().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).
                select{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}
==&gt;[<span class="key">a</span>:marko, <span class="key">b</span>:josh]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A standard <code>select()</code> that generates a <code>Map&lt;String,Object&gt;</code> of variables bindings in the path (i.e. <code>a</code> and <code>b</code>) for the sake of a running example.</p>
</li>
<li>
<p>The <code>select{it.value('name')}</code> projects each binding vertex to their name property value and <code>where()</code> operates to ensure respective <code>a</code> and <code>b</code> strings are not the same.</p>
</li>
<li>
<p>The first <code>select()</code> projects a vertex binding set. A binding is filtered if <code>a</code> vertex equals <code>b</code> vertex. A binding is filtered if <code>a</code> doesn&#8217;t know <code>b</code>. The second and final <code>select()</code> projects the name of the vertices.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shuffle-step">Shuffle Step</h3>
<div class="paragraph">
<p>Randomizing the order of the traversers at a particular point in the traversal is possible with <code>shuffle()</code>-step (<strong>map</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>).map{<span class="local-variable">it</span>.get() * <span class="integer">2</span>}
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">6</span>
gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>).map{<span class="local-variable">it</span>.get() * <span class="integer">2</span>}.shuffle()
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">6</span>
==&gt;<span class="integer">2</span>
gremlin&gt; g.of().inject(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>).map{<span class="local-variable">it</span>.get() * <span class="integer">2</span>}.shuffle()
==&gt;<span class="integer">6</span>
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">2</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simplepath-step">SimplePath Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/simplepath-step.png" alt="simplepath step" width="400">
</div>
</div>
<div class="paragraph">
<p>When it is important that a traverser not repeat its path through the graph, <code>simplePath()</code>-step should be used (<strong>filter</strong>). The <a href="#path-data-structure">path</a> information of the traverser is analyzed and if the path has repeated objects in it, the traverser is filtered. If cyclic behavior is desired, see <a href="#cyclicpath-step"><code>cyclicPath()</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).both().both()
==&gt;v[<span class="integer">1</span>]   <span class="comment">// back to v[1]</span>
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">1</span>]   <span class="comment">// back to v[1]</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]   <span class="comment">// back to v[1]</span>
gremlin&gt; g.v(<span class="integer">1</span>).both().both().simplePath()
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">1</span>).both().both().simplePath().path()
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">3</span>], v[<span class="integer">4</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">3</span>], v[<span class="integer">6</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">4</span>], v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="store-step">Store Step</h3>
<div class="paragraph">
<p>When <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy</a> aggregation is needed, <code>store()</code>-step (<strong>sideEffect</strong>) should be used over <a href="#aggregate-step"><code>aggregate()</code></a>. The two steps differ in that <code>store()</code> does not block and only stores objects in its side-effect collection as they pass through.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).range(<span class="integer">0</span>,<span class="integer">1</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">2</span>], v[<span class="integer">3</span>], v[<span class="integer">4</span>], v[<span class="integer">5</span>], v[<span class="integer">6</span>]]
gremlin&gt; g.V().store(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).range(<span class="integer">0</span>,<span class="integer">1</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">1</span>], v[<span class="integer">2</span>], v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is interesting to note that there are three results in the <code>store()</code> side-effect even though the interval selection is for 2 objects. Realize that when the third object is on its way to the <code>range()</code> filter (i.e. <code>[0..1]</code>), it passes through <code>store()</code> and thus, stored before filtered.</p>
</div>
</div>
<div class="sect2">
<h3 id="subgraph-step">Subgraph Step</h3>
<div class="paragraph">
<p>Extracting a portion of a graph from a larger one for analysis, visualization or other purposes is a fairly common use case for graph analysts and developers. The <code>subgraph()</code>-step (<strong>sideEffect</strong>) provides a way to produce an edge-induced subgraph from virtually any traversal.  The following code shows how to produce the "knows" subgraph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; sg = TinkerGraph.open() <b>(1)</b>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.E().withSideEffect(<span class="string"><span class="delimiter">'</span><span class="content">sg</span><span class="delimiter">'</span></span>,sg).subgraph(<span class="string"><span class="delimiter">'</span><span class="content">sg</span><span class="delimiter">'</span></span>, {<span class="local-variable">it</span>.label == <span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>}) <b>(2)</b>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">3</span> <span class="key">edges</span>:<span class="integer">2</span>]
gremlin&gt; sg.E() <b>(3)</b>
==&gt;e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The empty graph to which the subgraph will be generated.</p>
</li>
<li>
<p>As this function produces "edge-induced" subgraphs, the traversal must contain edges in the path.  Those edges found in that path are evaluated by a <code>Predicate</code> function to determine if they should be copied to the subgraph in conjunction with their associated vertices.</p>
</li>
<li>
<p>The subgraph contains only "knows" edges.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A more common subgraphing use case is to get all of the graph structure surrounding a single vertex:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; sg = g.v(<span class="integer">3</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).inE().outV().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops()&lt;<span class="integer">3</span>}{<span class="predefined-constant">true</span>}.subgraph({<span class="predefined-constant">true</span>}).next()   <b>(1)</b>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">4</span> <span class="key">edges</span>:<span class="integer">4</span>]
gremlin&gt; sg.E()
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Starting at vertex <code>3</code>, traverse 3 steps away on in-edges, outputting all of that into the subgraph. Note that if now graph is provided, a <code>TinkerGraph</code> is assumed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="timelimit-step">TimeLimit Step</h3>
<div class="paragraph">
<p>In many situations, a graph traversal is not about getting an exact answer as its about getting a relative ranking. A classic example is <a href="http://en.wikipedia.org/wiki/Recommender_system">recommendation</a>. What is desired is a relative ranking of vertices, not their absolute rank. Next, it may be desirable to have the traversal execute for no more than 750 milliseconds. In such situations, <code>timeLimit()</code>-step (<strong>filter</strong>) can be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The method <code>clock(int runs, Closure code)</code> is a utility preloaded in the <a href="#gremlin-console">Gremlin Console</a> that can be used to time execution of a body of code.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/timelimit-step.png" alt="timelimit step" width="500">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).next().sort{-<span class="local-variable">it</span>.value}
==&gt;v[<span class="integer">1</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">3</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">4</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">2</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">5</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">6</span>]=<span class="integer">1136688</span>
gremlin&gt; clock(<span class="integer">1</span>){g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).next().sort{-<span class="local-variable">it</span>.value}}
==&gt;<span class="float">2735.111</span>
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).timeLimit(<span class="integer">750</span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).next().sort{-<span class="local-variable">it</span>.value}
==&gt;v[<span class="integer">1</span>]=<span class="integer">648473</span>
==&gt;v[<span class="integer">3</span>]=<span class="integer">647510</span>
==&gt;v[<span class="integer">4</span>]=<span class="integer">647499</span>
==&gt;v[<span class="integer">5</span>]=<span class="integer">268540</span>
==&gt;v[<span class="integer">6</span>]=<span class="integer">268533</span>
==&gt;v[<span class="integer">2</span>]=<span class="integer">267941</span>
gremlin&gt; clock(<span class="integer">1</span>){g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).timeLimit(<span class="integer">750</span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>,<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).next().sort{-<span class="local-variable">it</span>.value}}
==&gt;<span class="float">750.03</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In essence, the relative order is respected, even through the number traversers at each vertex is not. The primary benefit being that the calculation is guaranteed to complete at the specified time limit (in milliseconds). Finally, note that the internal clock of <code>timeLimit()</code>-step starts when the first traverser enters it. When the time limit is reached, any <code>next()</code> evaluation of the step will yield a <code>NoSuchElementException</code> and any <code>hasNext()</code> evaluation will yield <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tree-step">Tree Step</h3>
<div class="paragraph">
<p>From any one element (i.e. vertex or edge), the emanating paths from that element can be aggregated to form a <a href="http://en.wikipedia.org/wiki/Tree_(data_structure)">tree</a>. Gremlin provides <code>tree()</code>-step (<strong>sideEffect</strong>) for such this situation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tree-step.png" alt="tree step" width="450">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; tree = g.V().out().out().tree().next()
==&gt;v[<span class="integer">1</span>]={v[<span class="integer">4</span>]={v[<span class="integer">3</span>]={}, v[<span class="integer">5</span>]={}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to see how the paths of all the emanating traversers are united to form the tree.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tree-step2.png" alt="tree step2" width="500">
</div>
</div>
<div class="paragraph">
<p>The resultant tree data structure can then be manipulated (see <a href="http://www.tinkerpop.com/javadocs/current/com/tinkerpop/gremlin/process/graph/step/util/Tree.html">Tree JavaDoc</a>). For the sake of demonstration, a post-processing lambda is applied in the running example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; tree = g.V().out().out().tree{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}.next()
==&gt;marko={josh={ripple={}, lop={}}}
gremlin&gt; tree[<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>]
==&gt;josh={ripple={}, lop={}}
gremlin&gt; tree[<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>]
==&gt;ripple={}
==&gt;lop={}
gremlin&gt; tree.getObjectsAtDepth(<span class="integer">3</span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unfold-step">Unfold Step</h3>
<div class="paragraph">
<p>If the object reaching <code>unfold()</code> (<strong>flatMap</strong>) is an iterator, iterable, or map, then it is unrolled into a linear form. If not, then the object is simply emitted. Please see <a href="#fold-step"><code>fold()</code></a>-step for the inverse behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).out().fold().inject(<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>,[<span class="float">1.23</span>,<span class="float">2.34</span>])
==&gt;gremlin
==&gt;[<span class="float">1.23</span>, <span class="float">2.34</span>]
==&gt;[v[<span class="integer">3</span>], v[<span class="integer">2</span>], v[<span class="integer">4</span>]]
gremlin&gt; g.v(<span class="integer">1</span>).out().fold().inject(<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>,[<span class="float">1.23</span>,<span class="float">2.34</span>]).unfold()
==&gt;gremlin
==&gt;<span class="float">1.23</span>
==&gt;<span class="float">2.34</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>unfold()</code> does not recursively unroll iterators. Instead, <code>jump()</code> can be used to for recursive unrolling.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.of().inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]])
==&gt;<span class="integer">1</span>
==&gt;[<span class="integer">2</span>, <span class="integer">3</span>, [<span class="integer">4</span>, <span class="integer">5</span>, [<span class="integer">6</span>]]]
gremlin&gt; g.of().inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]]).unfold()
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
==&gt;[<span class="integer">4</span>, <span class="integer">5</span>, [<span class="integer">6</span>]]
gremlin&gt; g.of().inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]]).as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).unfold().jump(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.get() <span class="keyword">instanceof</span> <span class="predefined-type">List</span>}
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">5</span>
==&gt;<span class="integer">6</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="union-step">Union Step</h3>
<div class="imageblock">
<div class="content">
<img src="images/union-step.png" alt="union step" width="650">
</div>
</div>
<div class="paragraph">
<p>The <code>union()</code>-step (<strong>branch</strong>) supports the merging of the results of an arbitrary number of traversals. When a traverser reaches a <code>union()</code>-step, it is copied to each of its internal steps. The traverses emitted from <code>union()</code> are the outputs of the respective internal traversals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">4</span>).union(
            g.of().in().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>),
            g.of().out().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>))
==&gt;<span class="integer">29</span>
==&gt;java
==&gt;java
gremlin&gt; g.v(<span class="integer">4</span>).union(
            g.of().in().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>),
            g.of().out().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>)).path()
==&gt;[v[<span class="integer">4</span>], v[<span class="integer">1</span>], <span class="integer">29</span>]
==&gt;[v[<span class="integer">4</span>], v[<span class="integer">5</span>], java]
==&gt;[v[<span class="integer">4</span>], v[<span class="integer">3</span>], java]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="until-step">Until Step</h3>
<div class="paragraph">
<p>Gremlin provides <strong>while-do</strong> looping. This was demonstrated in the <a href="#jump-step">Jump Step</a> section of the documentation. However, when only using <code>jump()</code> for <strong>while-do</strong>, the representation can be confusing as there are numerous <code>jump</code> constructions. For the sake of simplicity, <code>until()</code>-step exists (<strong>branch</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).jump(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops() &gt; <span class="integer">1</span>}.out().jump(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(1)</b>
==&gt;ripple
==&gt;lop
gremlin&gt; g.v(<span class="integer">1</span>).until(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>){<span class="local-variable">it</span>.loops() &gt; <span class="integer">1</span>}.out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <b>(2)</b>
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>while-do</strong> looping using <code>jump()-step</code>.</p>
</li>
<li>
<p><strong>while-do</strong> looping using <code>until()-step</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>until()</code> expression in the example above states:
. Get the vertex with id 1 from the graph.
. Until the current traverser has loop&#8217;d two times, get the outgoing adjacent vertices of the current vertex of the traverser.
. When the traverser has loop&#8217;d two times, break out of the until-clause and then get the <code>name</code> of the current vertex of the traverser.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>until()</code>-step is not a "real" step. It is simply a marker that exist in the traversal. When the <code>UntilStrategy</code> is executed (see <a href="#traversalstrategy">TraversalStrategy</a>), the traversal is re-written by inserting <code>jump()</code>-steps accordingly. Thus, in the example above, the second traversal example using <code>until()</code> compiles to the first which uses <code>jump()</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="valuemap-step">ValueMap Step</h3>
<div class="paragraph">
<p>The <code>valueMap()</code>-step yields a Map representation of the properties of an element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko], <span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[vadas], <span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop], <span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[josh], <span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple], <span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter], <span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().valueMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[:]
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[:]
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().valueMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[:]
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[:]
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.E().valueMap()
==&gt;[<span class="key">weight</span>:<span class="float">0.5</span>]
==&gt;[<span class="key">weight</span>:<span class="float">1.0</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.4</span>]
==&gt;[<span class="key">weight</span>:<span class="float">1.0</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.4</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.2</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that the map of a vertex maintains a list of values for each key. The map of an edge or vertex-property represents a single property (not a list). The reason is that vertices in TinkerPop3 leverage <a href="#vertex-properties">vertex properties</a> which are support multiple values per key. Using the <a href="#the-crew-toy-graph">The Crew</a> toy graph, the point is made explicit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createTheCrew()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>]
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko], <span class="key">location</span>:[san diego, santa cruz, brussels, santa fe]]
==&gt;[<span class="key">name</span>:[stephen], <span class="key">location</span>:[centreville, dulles, purcellville]]
==&gt;[<span class="key">name</span>:[matthias], <span class="key">location</span>:[bremen, baltimore, oakland, seattle]]
==&gt;[<span class="key">name</span>:[daniel], <span class="key">location</span>:[spremberg, kaiserslautern, aachen]]
==&gt;[<span class="key">name</span>:[gremlin]]
==&gt;[<span class="key">name</span>:[tinkergraph]]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>)
==&gt;vp[location-&gt;san diego]
==&gt;vp[location-&gt;santa cruz]
==&gt;vp[location-&gt;brussels]
==&gt;vp[location-&gt;santa fe]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">startTime</span>:<span class="integer">1997</span>, <span class="key">endTime</span>:<span class="integer">2001</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2001</span>, <span class="key">endTime</span>:<span class="integer">2004</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2004</span>, <span class="key">endTime</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2005</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vertex-steps">Vertex Steps</h3>
<div class="imageblock">
<div class="content">
<img src="images/vertex-steps.png" alt="vertex steps" width="350">
</div>
</div>
<div class="paragraph">
<p>The vertex steps (<strong>flatMap</strong>) are fundamental to the Gremlin language and are perhaps the only "graph oriented" steps. Via these steps, its possible to "move" on the graph&#8201;&#8212;&#8201;i.e. traverse.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>out(integer, string...)</code>: Move to the outgoing adjacent vertices given the branch factor and edge labels.</p>
</li>
<li>
<p><code>in(integer, string...)</code>: Move to the incoming adjacent vertices given the branch factor and edge labels.</p>
</li>
<li>
<p><code>both(integer, string...)</code>: Move to both the incoming and outgoing adjacent vertices given the branch factor and edge labels.</p>
</li>
<li>
<p><code>outE(integer, string...)</code>: Move to the outgoing incident edges given the branch factor and edge labels.</p>
</li>
<li>
<p><code>inE(integer, string...)</code>: Move to the incoming incident edges given the branch factor and edge labels.</p>
</li>
<li>
<p><code>bothE(integer, string...)</code>: Move to both the incoming and outgoing incident edges given the branch factor and edge labels.</p>
</li>
<li>
<p><code>outV()</code>: Move to the outgoing vertex.</p>
</li>
<li>
<p><code>inV()</code>: Move to the incoming vertex.</p>
</li>
<li>
<p><code>bothV()</code>: Move to both vertices.</p>
</li>
<li>
<p><code>otherV()</code> : Move to the vertex that was not the vertex that was moved from.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">4</span>)
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.v(<span class="integer">4</span>).outE()  <span class="comment">// all outgoing edges</span>
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">4</span>).outE(<span class="integer">1</span>)  <span class="comment">// at most one outgoing edge per incoming vertex</span>
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
gremlin&gt; g.v(<span class="integer">4</span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)  <span class="comment">// all incoming knows-edges</span>
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
gremlin&gt; g.v(<span class="integer">4</span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="comment">// all incoming created-edges</span>
gremlin&gt; g.v(<span class="integer">4</span>).bothE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
gremlin&gt; g.v(<span class="integer">4</span>).bothE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>).otherV()
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">4</span>).both(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">4</span>).outE().inV() <span class="comment">// moving forward touching edges,vertices</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">4</span>).out()  <span class="comment">// moving forward only touching vertices</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.v(<span class="integer">4</span>).inE().outV()
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.v(<span class="integer">4</span>).inE().bothV()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="traversalstrategy">TraversalStrategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/traversal-strategy.png" alt="traversal-strategy" width="125"></span> A <code>TraversalStrategy</code> can analyze a <code>Traversal</code> and mutate the traversal as it deems fit. This is useful in two situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a more efficient way to express the traversal at the TinkerPop3 level.</p>
</li>
<li>
<p>There is a more efficient way to express the traversal at the graph vendor level.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A simple TraversalStrategy is the <code>IdentityRemovalStrategy</code> and it is a type-1 strategy defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IdentityRemovalStrategy</span> <span class="directive">extends</span> AbstractTraversalStrategy {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> IdentityRemovalStrategy INSTANCE = <span class="keyword">new</span> IdentityRemovalStrategy();

    <span class="directive">private</span> IdentityRemovalStrategy() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="directive">final</span> Traversal&lt;?, ?&gt; traversal, <span class="directive">final</span> TraversalEngine engine) {
        <span class="keyword">if</span> (!TraversalHelper.hasStepOfClass(IdentityStep.class, traversal))  <span class="comment">// break fast if there are no identity steps</span>
            <span class="keyword">return</span>;
        TraversalHelper.getStepsOfClass(IdentityStep.class, traversal).stream()
                .filter(step -&gt; !TraversalHelper.isLabeled(step))
                .forEach(step -&gt; TraversalHelper.removeStep(step, traversal));
    }

    <span class="directive">public</span> <span class="directive">static</span> IdentityRemovalStrategy instance() {
        <span class="keyword">return</span> INSTANCE;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy simply removes any unlabeled <code>IdentityStep</code> steps in the Traversal as <code>aStep().identity().identity().bStep()</code> is equivalent to <code>aStep().bStep()</code>. For those traversal strategies that require other strategies to execute prior or post to the strategy, then the following two methods can be defined in <code>TraversalStrategy</code> (with defaults being an empty set).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> TraversalStrategy&gt;&gt; applyPrior();
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> TraversalStrategy&gt;&gt; applyPost();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type-2 strategies are defined by graph vendors who implement TinkerPop3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above can be executed in a <code>O(|V|)</code> or <code>O(log(|V|)</code> fashion in <a href="#tinkergraph-gremlin">TinkerGraph</a> depending on whether there is or is not an index defined for "name."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">TinkerGraphStepStrategy <span class="directive">implements</span> TraversalStrategy {
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="directive">final</span> Traversal traversal, <span class="directive">final</span> TraversalEngine traversalEngine) {
        <span class="keyword">if</span> (engine.equals(TraversalEngine.COMPUTER))  <span class="comment">// TinkerGraphComputer does not use indices but linear scans of the graph</span>
            <span class="keyword">return</span>;
        <span class="directive">final</span> TinkerGraphStep tinkerGraphStep = (TinkerGraphStep) traversal.getSteps().get(<span class="integer">0</span>);
        Step currentStep = tinkerGraphStep.getNextStep();
        <span class="keyword">while</span> (<span class="predefined-constant">true</span>) {
            <span class="keyword">if</span> (currentStep == EmptyStep.instance() || TraversalHelper.isLabeled(currentStep))
                <span class="keyword">break</span>;
            <span class="keyword">if</span> (currentStep <span class="keyword">instanceof</span> HasStep) {
                tinkerGraphStep.hasContainers.add(((HasStep) currentStep).hasContainer);
                TraversalHelper.removeStep(currentStep, traversal);
            } <span class="keyword">else</span> <span class="keyword">if</span> (currentStep <span class="keyword">instanceof</span> IntervalStep) {
                tinkerGraphStep.hasContainers.add(((IntervalStep) currentStep).startContainer);
                tinkerGraphStep.hasContainers.add(((IntervalStep) currentStep).endContainer);
                TraversalHelper.removeStep(currentStep, traversal);
            } <span class="keyword">else</span> <span class="keyword">if</span> (currentStep <span class="keyword">instanceof</span> IdentityStep) {
                <span class="comment">// do nothing</span>
            } <span class="keyword">else</span> {
                <span class="keyword">break</span>;
            }
            currentStep = currentStep.getNextStep();
        }
        tinkerGraphStep.generateHolderIterator(<span class="predefined-constant">false</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The traversal is redefined by simply taking a chain of <code>has()</code>-steps and <code>interval()</code>-steps after <code>g.V()</code> (<code>TinkerGraphStep</code>) and providing them to <code>TinkerGraphStep</code>. Then its up to TinkerGraphStep to determine if an appropriate index exists. In the code below, review the <code>vertices()</code> method and note how if an index exists, for a particular <code>HasContainer</code>, then that index is first queried before the remaining <code>HasContainer</code> filters are serially applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; t = g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>); <span class="predefined-constant">null</span>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; t.toString()
==&gt;[TinkerGraphStep(vertex), HasStep([name,eq,marko])]
gremlin&gt; t.iterate(); <span class="predefined-constant">null</span>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; t.toString()
==&gt;[TinkerGraphStep([[name,eq,marko]])]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_domain_specific_languages">Domain Specific Languages</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
As of TinkerPop 3.0.0.M6, the presented domain specific language framework has not been fully flushed out. Expect changes to the API until this "caution"-note is removed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-quill.png" alt="gremlin-quill" width="200"></span> The super interface of GraphTraversal is <code>Traversal</code>. It is possible for developers to create domain specific traversals by extending Traversal. For example, a <code>SocialTraversal</code> example is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SocialTraversal</span>&lt;S, E&gt; <span class="directive">extends</span> Traversal&lt;S, E&gt; {

    <span class="directive">public</span> <span class="keyword">default</span> SocialTraversal&lt;S, Vertex&gt; people() {
        <span class="keyword">return</span> (SocialTraversal) <span class="local-variable">this</span>.addStep(<span class="keyword">new</span> StartStep&lt;&gt;(<span class="local-variable">this</span>, <span class="local-variable">this</span>.sideEffects().getGraph().V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>)));
    }

    <span class="directive">public</span> <span class="keyword">default</span> SocialTraversal&lt;S, Vertex&gt; people(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> (SocialTraversal) <span class="local-variable">this</span>.addStep(<span class="keyword">new</span> StartStep&lt;&gt;(<span class="local-variable">this</span>, <span class="local-variable">this</span>.sideEffects().getGraph().V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name)));
    }

    <span class="directive">public</span> <span class="keyword">default</span> SocialTraversal&lt;S, Vertex&gt; knows() {
        <span class="directive">final</span> FlatMapStep&lt;Vertex, Vertex&gt; flatMapStep = <span class="keyword">new</span> FlatMapStep&lt;&gt;(<span class="local-variable">this</span>);
        flatMapStep.setFunction(v -&gt; v.get().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> (SocialTraversal) <span class="local-variable">this</span>.addStep(flatMapStep);
    }

    <span class="directive">public</span> <span class="keyword">default</span> SocialTraversal&lt;S, Vertex&gt; created() {
        <span class="directive">final</span> FlatMapStep&lt;Vertex, Vertex&gt; flatMapStep = <span class="keyword">new</span> FlatMapStep&lt;&gt;(<span class="local-variable">this</span>);
        flatMapStep.setFunction(v -&gt; v.get().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> (SocialTraversal) <span class="local-variable">this</span>.addStep(flatMapStep);
    }

    <span class="directive">public</span> <span class="keyword">default</span> SocialTraversal&lt;S, <span class="predefined-type">String</span>&gt; name() {
        MapStep&lt;Vertex, <span class="predefined-type">String</span>&gt; mapStep = <span class="keyword">new</span> MapStep&lt;&gt;(<span class="local-variable">this</span>);
        mapStep.setFunction(v -&gt; v.get().&lt;<span class="predefined-type">String</span>&gt;value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> (SocialTraversal) <span class="local-variable">this</span>.addStep(mapStep);
    }

    <span class="directive">public</span> <span class="directive">static</span> &lt;S&gt; SocialTraversal&lt;S, S&gt; of(<span class="directive">final</span> Graph graph) {
        <span class="directive">final</span> SocialTraversal traversal = <span class="keyword">new</span> DefaultSocialTraversal(graph);
        <span class="keyword">return</span> traversal;
    }

    <span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultSocialTraversal</span> <span class="directive">extends</span> DefaultTraversal <span class="directive">implements</span> SocialTraversal {
        <span class="directive">static</span> {
            <span class="directive">final</span> DefaultTraversalStrategies traversalStrategies = <span class="keyword">new</span> DefaultTraversalStrategies();
            traversalStrategies.addStrategy(TraverserSourceStrategy.instance());
            TraversalStrategies.GlobalCache.registerStrategies(DefaultSocialTraversal.class, traversalStrategies);
        }

        <span class="directive">public</span> DefaultSocialTraversal(<span class="directive">final</span> Graph graph) {
            <span class="local-variable">super</span>(graph);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This traversal definition can now be used as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">g.of(SocialTraversal.class).people(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).knows().name()</code></pre>
</div>
</div>
<div class="paragraph">
<p>By extending <code>Traversal</code>, users can create a DSL that is respective of the semantics of their data. Instead of querying in terms of vertices/edges/properties, they can query in terms of, for example, people, their friends, and their names.</p>
</div>
</div>
</div>
<h1 id="graphcomputer" class="sect0">The GraphComputer</h1>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/graphcomputer-puffers.png" alt="graphcomputer-puffers" width="350"></span> TinkerPop3 provides two primary means of interacting with a graph: <a href="http://en.wikipedia.org/wiki/Online_transaction_processing">online transaction processing</a> (OLTP) and <a href="http://en.wikipedia.org/wiki/Online_analytical_processing">online analytical processing</a> (OLAP). OTLP-based graph systems allow the user to query the graph in real-time. However, typically, real-time performance is only possible when a local traversal is enacted. A local traversal is one that starts at a particular vertex (or small set of vertices) and touches a small set of connected vertices (by any arbitrary path of arbitrary length). In short, OLTP queries interact with a limited set of data and respond on the order of milliseconds or seconds. On the other hand, with OLAP graph processing, the entire graph is processed and thus, every vertex and edge is analyzed (some times more than once for iterative, recursive algorithms). Due to the amount of data being processed, the results are typically not returned in real-time and for massive graphs (i.e. graphs represented across a cluster of machines), results can take on the order of minutes or hours.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OLTP</strong>: real-time, limited data accessed, random data access, sequential processing, querying</p>
</li>
<li>
<p><strong>OLAP</strong>: long running, entire data set accessed, sequential data access, parallel processing, batch processing</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/oltp-vs-olap.png" alt="oltp vs olap" width="600">
</div>
</div>
<div class="paragraph">
<p>The image above demonstrates the difference between Gremlin OLTP and Gremlin OLAP. With Gremlin OLTP, the graph is walked by moving from vertex-to-vertex via incident edges. With Gremlin OLAP, all vertices are provided a <code>VertexProgram</code>. The programs send messages to one another with the topological structure of the graph acting as the communication network (though random message passing possible). In many respects, the messages passed are like the OLTP traversers moving from vertex-to-vertex. However, all messages are moving independent of one another, in parallel. Once a vertex program is finished computing, TinkerPop3&#8217;s OLAP engine supports any number <a href="http://en.wikipedia.org/wiki/MapReduce"><code>MapReduce</code></a> jobs over the resultant graph.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>GraphComputer</code> was designed from the start to be used within a multi-JVM, distributed environment&#8201;&#8212;&#8201;in other words, a multi-machine compute cluster. As such, all the computing objects must be able to be migrated between JVMs. The pattern promoted is to store state information in a <code>Configuration</code> object to later be regenerated by a loading process. It is important to realize that <code>VertexProgram</code>, <code>MapReduce</code>, and numerous particular instances rely heavily on the state of the computing classes (not the structure, but the processes) to be stored in a <code>Configuration</code>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="vertexprogram">VertexProgram</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/bsp-diagram.png" alt="bsp-diagram" width="400"></span> GraphComputer takes a <code>VertexProgram</code>. A VertexProgram can be thought of as a piece of code that is executed at each vertex in logically parallel manner until some termination condition is met (e.g. a number of iterations have occurred, no more data is changing in the graph, etc.). A submitted VertexProgram is copied to all the workers in the graph. A worker is not an explicit concept in the API, but is assumed of all GraphComputer implementations. At minimum each vertex is a worker (though this would be inefficient due to the fact that each vertex would maintain a VertexProgram). In practice, the workers partition the vertex set and and are responsible for the execution of the VertexProgram over all the vertices within their sphere of influence. The workers orchestrate the execution of the <code>VertexProgram.execute()</code> method on all their vertices in an <a href="http://en.wikipedia.org/wiki/Bulk_synchronous_parallel">bulk synchronous parallel</a> (BSP) fashion. The vertices are able to communicate with one another via messages. There are two kinds of messages in Gremlin OLAP: <code>MessageScope.Local</code> and <code>MessageScope.Global</code>. A local message is a message to an adjacent vertex. A global message is a message to any arbitrary vertex in the graph. Once the VertexProgram has completed its execution, any number of <code>MapReduce</code> jobs are evaluated. MapReduce jobs are provided by the user via <code>GraphComputer.mapReduce()</code> or by the VertexProgram via <code>VertexProgram.getMapReducers()</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/graphcomputer.png" alt="graphcomputer" width="500">
</div>
</div>
<div class="paragraph">
<p>The example below demonstrates how to submit a VertexProgram to a graph&#8217;s GraphComputer. <code>GraphComputer.submit()</code> yields a <code>Future&lt;ComputerResult&gt;</code>. The <code>ComputerResult</code> has the resultant computed graph which can be a full copy of the original graph (see <a href="#hadoop-gremlin">Hadoop-Gremlin</a>) or a view over the original graph (see <a href="#tinkergraph">TinkerGraph</a>). The ComputerResult also provides access to computational side-effects called <code>Memory</code> (which includes, for example, runtime, number of iterations, results of MapReduce jobs, and VertexProgram-specific memory manipulations).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; result = g.compute().program(PageRankVertexProgram.build().create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; result.graph().V().map{[<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>), <span class="local-variable">it</span>.get().value(PageRankVertexProgram.PAGE_RANK)]}
==&gt;[marko, <span class="float">0.15000000000000002</span>]
==&gt;[vadas, <span class="float">0.19250000000000003</span>]
==&gt;[lop, <span class="float">0.4018125</span>]
==&gt;[josh, <span class="float">0.19250000000000003</span>]
==&gt;[ripple, <span class="float">0.23181250000000003</span>]
==&gt;[peter, <span class="float">0.15000000000000002</span>]
gremlin&gt; result.memory().runtime
==&gt;<span class="integer">35</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This model of "vertex-centric graph computing" was made popular by Google&#8217;s <a href="http://googleresearch.blogspot.com/2009/06/large-scale-graph-computing-at-google.html">Pregel</a> graph engine. In the open source world, this model is found in OLAP graph computing systems such as <a href="https://giraph.apache.org/">Giraph</a>, <a href="https://hama.apache.org/">Hama</a>, and <a href="http://faunus.thinkaurelius.com">Faunus</a>. TinkerPop3 extends the popularized model with integrated post-processing <a href="#mapreduce">MapReduce</a> jobs over the vertex set.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
As of TinkerPop3 3.0.0.M6, message combiners are not supported. The primary reason is that TinkerPop wants to provide a model of message combining that does not require all messages to a particular vertex to be combined. This allows for more complex message passing scenarios to exist, where multi-typed messages are possible. However, at this time, no general solution has been developed.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapreduce">MapReduce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The BSP model proposed by Pregel stores the results of the computation in a distributed manner as properties on the elements in the graph. In many situations, it is necessary to aggregate those resultant properties into a single result set (i.e. a statistic). For instance, assume a VertexProgram that computes a nominal cluster for each vertex (i.e. <a href="http://en.wikipedia.org/wiki/Community_structure">a graph clustering algorithm</a>). At the end of the computation, each vertex will have a property denoting the cluster it was assigned to. TinkerPop3 provides the ability to answer global questions about the clusters. For instance, in order to answer the following questions, <code>MapReduce</code> jobs are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How many vertices are in each cluster? (<strong>presented below</strong>)</p>
</li>
<li>
<p>How many unique clusters are there? (<strong>presented below</strong>)</p>
</li>
<li>
<p>What is the average age of each vertex in each cluster?</p>
</li>
<li>
<p>What is the degree distribution of the vertices in each cluster?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A compressed representation of the <code>MapReduce</code> API in TinkerPop3 is provided below. The key idea is that the <code>map</code>-stage processes all vertices to emit key/value pairs. Those values are aggregated on their respective key for the <code>reduce</code>-stage to do its processing to ultimately yield more key/value pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MapReduce</span>&lt;MK, MV, RK, RV, R&gt; {
  <span class="directive">public</span> <span class="type">void</span> map(<span class="directive">final</span> Vertex vertex, <span class="directive">final</span> MapEmitter&lt;MK, MV&gt; emitter);
  <span class="directive">public</span> <span class="type">void</span> reduce(<span class="directive">final</span> MK key, <span class="directive">final</span> <span class="predefined-type">Iterator</span>&lt;MV&gt; values, <span class="directive">final</span> ReduceEmitter&lt;RK, RV&gt; emitter);
  <span class="comment">// there are more methods</span>
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mapreduce.png" alt="mapreduce" width="650">
</div>
</div>
<div class="paragraph">
<p>The <code>MapReduce</code> extension to GraphComputer is made explicit when examining the <a href="#peerpressurevertexprogram"><code>PeerPressureVertexProgram</code></a> and corresponding <code>ClusterPopulationMapReduce</code>. In the code below, the GraphComputer result returns the computed on <code>Graph</code> as well as the <code>Memory</code> of the computation (<code>ComputerResult</code>). The memory maintain the results of any MapReduce jobs. The cluster population MapReduce result states that there are 5 vertices in cluster 1 and 1 vertex in cluster 6. This can be verified (in a serial manner) by looking at the <code>PeerPressureVertexProgram.CLUSTER</code> property of the resultant graph. In essence, the serial process of the final Gremlin traversal is done in a parallel MapReduce fashion using <code>ClusterPopulationMapReduce</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; result = g.compute().program(PeerPressureVertexProgram.build().create()).mapReduce(<span class="keyword">new</span> ClusterPopulationMapReduce()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">2</span>]]
gremlin&gt; result.memory().get(<span class="string"><span class="delimiter">'</span><span class="content">clusterPopulation</span><span class="delimiter">'</span></span>)
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span>
gremlin&gt; result.graph().V().values(PeerPressureVertexProgram.CLUSTER).groupCount().next()
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are numerous statistics desired, then its possible to register as many MapReduce jobs as needed. For instance, the <code>ClusterCountMapReduce</code> determines how many unique clusters were created by the peer pressure algorithm. Below both <code>ClusterCountMapReduce</code> and <code>ClusterPopulationMapReduce</code> are computed over the resultant graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; result = g.compute().program(PeerPressureVertexProgram.build().create()).
 mapReduce(<span class="keyword">new</span> ClusterPopulationMapReduce()).
 mapReduce(<span class="keyword">new</span> ClusterCountMapReduce()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">3</span>]]
gremlin&gt; result.memory().clusterPopulation
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span>
gremlin&gt; result.memory().clusterCount
==&gt;<span class="integer">2</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The MapReduce model of TinkerPop3 does not support MapReduce chaining. Thus, the order in which the MapReduce jobs are executed is irrelevant. This is made apparent when realizing that the <code>map()</code>-stage takes a <code>Vertex</code> as its input and the <code>reduce()</code>-stage yields key/value pairs. Thus, the results of reduce can not feed back into map.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_collection_of_vertexprograms">A Collection of VertexPrograms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TinkerPop3 provides a collection of VertexPrograms that implement common algorithms. This section discusses the various implementations.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The vertex programs presented are what are provided as of TinkerPop 3.0.0.M6. Over time, with future releases, more algorithms will be added.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="lambdavertexprogram">LambdaVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/lambda-vertex-program.png" alt="lambda-vertex-program" width="200"></span> <code>LambdaVertexProgram</code> is the most generic of all vertex programs as it requires the user to define, by way of lambdas, the meaning of <code>setup</code>, <code>execute</code>, and <code>terminate</code>. This vertex program is convenient for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating "one line" vertex programs</p>
</li>
<li>
<p>Submitting a "one off" vertex program without having to build a class and distribute jars</p>
</li>
<li>
<p>Testing for vendors of <code>GraphComputer</code> implementations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; result = g.compute().program(LambdaVertexProgram.build().
                      execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">a.singleProperty('counter', c.isInitialIteration() ? 0 : ++a.value('counter'))</span><span class="delimiter">&quot;</span></span>).
                      terminate(<span class="string"><span class="delimiter">'</span><span class="content">a.iteration &gt; 9</span><span class="delimiter">'</span></span>).
                      elementComputeKeys(<span class="string"><span class="delimiter">'</span><span class="content">counter</span><span class="delimiter">'</span></span>).create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; result.graph().V().values(<span class="string"><span class="delimiter">'</span><span class="content">counter</span><span class="delimiter">'</span></span>)
==&gt;<span class="integer">10</span>
==&gt;<span class="integer">10</span>
==&gt;<span class="integer">10</span>
==&gt;<span class="integer">10</span>
==&gt;<span class="integer">10</span>
==&gt;<span class="integer">10</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If a single string is provided to the LambdaVertexProgram&#8217;s builder methods, then it is assumed to be a Gremlin-Groovy script. It is possible to use other Gremlin <code>ScriptEngine</code> implementations (e.g. Gremlin-Scala, Gremlin-JavaScript, etc.) by ensuring 1.) the script engine is registered in the <code>META-INF/services</code> of the application and 2.) it is declared as such <code>build().execute('gremlin-scala','a.singleProperty')</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same example is presented below in Java8 using native lambda syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">ComputerResult results = g.compute().program(LambdaVertexProgram.build().
                        execute((vertex, messenger, memory) -&gt; vertex.&lt;<span class="predefined-type">Integer</span>&gt;singleProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>, memory.isInitialIteration() ? <span class="integer">0</span> : vertex.&lt;<span class="predefined-type">Integer</span>&gt;value(<span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>) + <span class="integer">1</span>)).
                        terminate(memory -&gt; memory.getIteration() &gt; <span class="integer">9</span>).
                        elementComputeKeys(<span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>).create()).submit().get();
results.graph().V().values(<span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>).forEach(<span class="predefined-type">System</span>.out::println);
<span class="comment">// 10</span>
<span class="comment">// 10</span>
<span class="comment">// 10</span>
<span class="comment">// 10</span>
<span class="comment">// 10</span>
<span class="comment">// 10</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Java8 lambdas are not serializable unless they are static classes. As such, for the last example to execute on a multi-machine GraphComputer a <code>Class</code> can be provided denoting the static lambda classes: <code>build().execute(MyCounterTriConsumer.class)</code>. It is important that that class be on the class path of all machines in the GraphComputer cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, there also exists <code>LambdaMapReduce</code> to compliment <code>LambdaVertexProgram</code>. In essence, the <code>map</code>, <code>combine</code>, <code>reduce</code>, etc. methods of <a href="#mapreduce">MapReduce</a> can be described by lambdas. An example is provided below in Gremlin-Groovy that expands on the example previous that simply sums up all the counters on the vertices and stores them into a graph computer memory called <code>counter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; result = g.compute().
                      program(LambdaVertexProgram.build().
                        execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">a.singleProperty('counter', c.isInitialIteration() ? 0 : ++a.value('counter'))</span><span class="delimiter">&quot;</span></span>).
                        terminate(<span class="string"><span class="delimiter">'</span><span class="content">a.iteration &gt; 9</span><span class="delimiter">'</span></span>).
                        elementComputeKeys(<span class="string"><span class="delimiter">'</span><span class="content">counter</span><span class="delimiter">'</span></span>).create()).
                      mapReduce(LambdaMapReduce.build().
                        map(<span class="string"><span class="delimiter">&quot;</span><span class="content">b.emit(a.value('counter'))</span><span class="delimiter">&quot;</span></span>).
                        reduce(<span class="string"><span class="delimiter">&quot;</span><span class="content">c.emit(a,b.sum())</span><span class="delimiter">&quot;</span></span>).
                        memory(<span class="string"><span class="delimiter">'</span><span class="content">a.next().value1</span><span class="delimiter">'</span></span>).
                        memoryKey(<span class="string"><span class="delimiter">'</span><span class="content">sum</span><span class="delimiter">'</span></span>).create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">1</span>]]
gremlin&gt; result.memory().sum
==&gt;<span class="integer">60</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In the last example, the <code>map()</code> emits a single value with no key. <code>MapEmitter.emit(value)</code> is a default method that assumes the key is the <code>MapReduce.NullObject</code> singleton. This method is useful when all values need to be aggregated to a single key&#8201;&#8212;&#8201;e.g., when a global sum is needed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The examples presented are simple. For more complex uses within Gremlin Console, it may be important to either develop a <code>VertexProgram</code> class or make use of Groovy <a href="http://groovy.codehaus.org/Strings+and+GString">multi-line strings</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pagerankvertexprogram">PageRankVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-pagerank.png" alt="gremlin-pagerank" width="400"></span> <a href="http://en.wikipedia.org/wiki/PageRank">PageRank</a> is perhaps the most popular OLAP-oriented graph algorithm. This <a href="http://en.wikipedia.org/wiki/Centrality">eigenvector centrality</a> variant was developed by Brin and Page of Google. PageRank defines a centrality value for all vertices in the graph, where centrality is defined recursively where a vertex is central if it is connected to central vertices. PageRank is an iterative algorithm that converges to a <a href="http://en.wikipedia.org/wiki/Ergodicity">steady state distribution</a>. If the pageRank values are normalized to 1.0, then the pageRank value of a vertex is the probability that a random walker will be seen that that vertex in the graph at any arbitrary moment in time. In order to help developers understand the methods of a <code>VertexProgram</code>, the PageRankVertexProgram code is analyzed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PageRankVertexProgram</span> <span class="directive">implements</span> VertexProgram&lt;<span class="predefined-type">Double</span>&gt; { <b>(1)</b>

    <span class="directive">private</span> MessageScope.Local&lt;<span class="predefined-type">Double</span>&gt; incidentMessageScope = MessageScope.Local.of(<span class="keyword">new</span> OutETraversalSupplier()); <b>(2)</b>
    <span class="directive">private</span> MessageScope.Local&lt;<span class="predefined-type">Double</span>&gt; countMessageScope = MessageScope.Local.of(<span class="keyword">new</span> MessageScope.Local.ReverseTraversalSupplier(<span class="local-variable">this</span>.incidentMessageScope));

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PAGE_RANK = Graph.Key.hide(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.pageRank</span><span class="delimiter">&quot;</span></span>); <b>(3)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> EDGE_COUNT = Graph.Key.hide(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.edgeCount</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> VERTEX_COUNT = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.vertexCount</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ALPHA = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.alpha</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TOTAL_ITERATIONS = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.totalIterations</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> INCIDENT_TRAVERSAL_SUPPLIER = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.incidentTraversalSupplier</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">private</span> LambdaHolder&lt;Supplier&lt;Traversal&lt;Vertex, Edge&gt;&gt;&gt; traversalSupplier;
    <span class="directive">private</span> <span class="type">double</span> vertexCountAsDouble = <span class="float">1.0d</span>;
    <span class="directive">private</span> <span class="type">double</span> alpha = <span class="float">0.85d</span>;
    <span class="directive">private</span> <span class="type">int</span> totalIterations = <span class="integer">30</span>;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; COMPUTE_KEYS = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;(<span class="predefined-type">Arrays</span>.asList(PAGE_RANK, EDGE_COUNT));

    <span class="directive">private</span> PageRankVertexProgram() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> loadState(<span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) { <b>(4)</b>
        <span class="local-variable">this</span>.traversalSupplier = LambdaHolder.loadState(configuration, INCIDENT_TRAVERSAL_SUPPLIER);
        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.traversalSupplier) {
            VertexProgramHelper.verifyReversibility(<span class="local-variable">this</span>.traversalSupplier.get().get());
            <span class="local-variable">this</span>.incidentMessageScope = MessageScope.Local.of(<span class="local-variable">this</span>.traversalSupplier.get());
        }
        <span class="local-variable">this</span>.vertexCountAsDouble = configuration.getDouble(VERTEX_COUNT, <span class="float">1.0d</span>);
        <span class="local-variable">this</span>.alpha = configuration.getDouble(ALPHA, <span class="float">0.85d</span>);
        <span class="local-variable">this</span>.totalIterations = configuration.getInt(TOTAL_ITERATIONS, <span class="integer">30</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> storeState(<span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) {
        configuration.setProperty(VERTEX_PROGRAM, PageRankVertexProgram.class.getName());
        configuration.setProperty(VERTEX_COUNT, <span class="local-variable">this</span>.vertexCountAsDouble);
        configuration.setProperty(ALPHA, <span class="local-variable">this</span>.alpha);
        configuration.setProperty(TOTAL_ITERATIONS, <span class="local-variable">this</span>.totalIterations);
        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.traversalSupplier) {
            <span class="local-variable">this</span>.traversalSupplier.storeState(configuration);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getElementComputeKeys() { <b>(5)</b>
        <span class="keyword">return</span> COMPUTE_KEYS;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Optional&lt;MessageCombiner&lt;<span class="predefined-type">Double</span>&gt;&gt; getMessageCombiner() {
        <span class="keyword">return</span> (Optional) PageRankMessageCombiner.instance();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;MessageScope&gt; getMessageScopes(<span class="directive">final</span> <span class="type">int</span> iteration) {
        <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;MessageScope&gt; set = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();
        set.add(<span class="integer">0</span> == iteration ? <span class="local-variable">this</span>.countMessageScope : <span class="local-variable">this</span>.incidentMessageScope);
        <span class="keyword">return</span> set;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setup(<span class="directive">final</span> Memory memory) {

    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> execute(<span class="directive">final</span> Vertex vertex, Messenger&lt;<span class="predefined-type">Double</span>&gt; messenger, <span class="directive">final</span> Memory memory) { <b>(6)</b>
        <span class="keyword">if</span> (memory.isInitialIteration()) { <b>(7)</b>
            messenger.sendMessage(<span class="local-variable">this</span>.countMessageScope, <span class="float">1.0d</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="integer">1</span> == memory.getIteration()) { <b>(8)</b>
            <span class="type">double</span> initialPageRank = <span class="float">1.0d</span> / <span class="local-variable">this</span>.vertexCountAsDouble;
            <span class="type">double</span> edgeCount = StreamFactory.stream(messenger.receiveMessages(<span class="local-variable">this</span>.countMessageScope)).reduce(<span class="float">0.0d</span>, (a, b) -&gt; a + b);
            vertex.singleProperty(PAGE_RANK, initialPageRank);
            vertex.singleProperty(EDGE_COUNT, edgeCount);
            messenger.sendMessage(<span class="local-variable">this</span>.incidentMessageScope, initialPageRank / edgeCount);
        } <span class="keyword">else</span> { <b>(9)</b>
            <span class="type">double</span> newPageRank = StreamFactory.stream(messenger.receiveMessages(<span class="local-variable">this</span>.incidentMessageScope)).reduce(<span class="float">0.0d</span>, (a, b) -&gt; a + b);
            newPageRank = (<span class="local-variable">this</span>.alpha * newPageRank) + ((<span class="float">1.0d</span> - <span class="local-variable">this</span>.alpha) / <span class="local-variable">this</span>.vertexCountAsDouble);
            vertex.singleProperty(PAGE_RANK, newPageRank);
            messenger.sendMessage(<span class="local-variable">this</span>.incidentMessageScope, newPageRank / vertex.&lt;<span class="predefined-type">Double</span>&gt;value(EDGE_COUNT));
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> terminate(<span class="directive">final</span> Memory memory) { <b>(10)</b>
        <span class="keyword">return</span> memory.getIteration() &gt;= <span class="local-variable">this</span>.totalIterations;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> StringFactory.vertexProgramString(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">alpha=</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.alpha + <span class="string"><span class="delimiter">&quot;</span><span class="content">,iterations=</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.totalIterations);
    }

    ...

    public <span class="directive">static</span> <span class="type">class</span> <span class="class">OutETraversalSupplier</span> <span class="directive">implements</span> Supplier&lt;CountTraversal&lt;Vertex, Edge&gt;&gt; {
        <span class="directive">public</span> CountTraversal&lt;Vertex, Edge&gt; get() {
            <span class="keyword">return</span> GraphTraversal.&lt;Vertex&gt;of().outE();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>PageRankVertexProgram</code> implements <code>VertexProgram&lt;Double&gt;</code> because the messages it sends are Java doubles.</p>
</li>
<li>
<p>The default path of energy propagation is via outgoing edges from the current vertex.</p>
</li>
<li>
<p>The resulting PageRank values for the vertices are stored as a hidden property.</p>
</li>
<li>
<p>A vertex program is constructed using an Apache <code>Configuration</code> to ensure easy dissemination across a cluster of JVMs.</p>
</li>
<li>
<p>A vertex program must define the "compute keys" that are the properties being operated on during the computation.</p>
</li>
<li>
<p>The "while"-loop of the vertex program.</p>
</li>
<li>
<p>In order to determine how to distribute the energy to neighbors, a "1"-count is used to determine how many incident vertices exist for the <code>MessageScope</code>.</p>
</li>
<li>
<p>Initially, each vertex is provided an equal amount of energy represented as a double.</p>
</li>
<li>
<p>Energy is aggregated, computed on according to the PageRank algorithm, and then disseminated according to the defined <code>MessageScope.Local</code>.</p>
</li>
<li>
<p>The computation is terminated after a pre-defined number of iterations.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="peerpressurevertexprogram">PeerPressureVertexProgram</h3>
<div class="paragraph">
<p>The <code>PeerPressureVertexProgram</code> is a clustering algorithm that assigns a nominal value to each vertex in the graph. The nominal value represents the vertex&#8217;s cluster. If two vertices have the same nominal value, then they are in the same cluster. The algorithm proceeds in the following manner.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every vertex assigns itself to a unique cluster ID (initially, its vertex ID).</p>
</li>
<li>
<p>Every vertex determines its per neighbor vote strength as 1.0d / incident edges count.</p>
</li>
<li>
<p>Every vertex sends its cluster ID and vote strength to its adjacent vertices as a <code>Pair&lt;Serializable,Double&gt;</code></p>
</li>
<li>
<p>Every vertex generates a vote energy distribution of received cluster IDs and changes its current cluster ID to the most frequent cluster ID.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If there is a tie, then the cluster with the lowest <code>toString()</code> comparison is selected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Steps 3 and 4 repeat until either a max number of iterations has occurred or no vertex has adjusted its cluster anymore.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="traversalvertexprogram">TraversalVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/traversal-vertex-program.png" alt="traversal-vertex-program" width="250"></span> The <code>TraversalVertexProgram</code> is a "special" VertexProgram in that it can be executed via <code>GraphTraversal.submit()</code> and the submit <code>:&gt;</code> command in <a href="#gremlin-console">Gremlin Console</a>. In Gremlin, it is possible to have the same traversal executed using either the standard OTLP-engine or the <code>GraphComputer</code> OLAP-engine. The difference being where the traversal is submitted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This model of graph traversal in a BSP system was first implemented by the <a href="http://faunus.thinkaurelius.com">Faunus</a> graph analytics engine and originally described in <a href="http://markorodriguez.com/2011/04/19/local-and-distributed-traversal-engines/">Local and Distributed Traversal Engines</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V().both().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount().next() <span class="comment">// OLTP</span>
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span>
gremlin&gt; g.V().both().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount().submit(g.compute()).next() <span class="comment">// OLAP</span>
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the OLAP example above, a <code>TraversalVertexProgram</code> is (logically) sent to each vertex in the graph. Each instance evaluation requires (logically) 5 BSP iterations and each iteration is interpreted as such:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>g.V()</code>: Put a traverser on each vertex in the graph.</p>
</li>
<li>
<p><code>both()</code>: Propagate each traverser to the vertices <code>both</code>-adjacent to its current vertex.</p>
</li>
<li>
<p><code>has('age')</code>: If the vertex does not have an <code>age</code> property, kill the traversers at that vertex.</p>
</li>
<li>
<p><code>values('age')</code>: Have all the traversers reference the integer age of their current vertex.</p>
</li>
<li>
<p><code>groupCount()</code>: Count how many times a particular age has been seen.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While 5 iterations were presented, in fact, <code>TraversalVertexProgram</code> will execute the traversal in only 3 iterations. The reason being is that <code>has('age').values('age').groupCount()</code> can all be executed in a single iteration as any message sent would simply be to the current executing vertex. Thus, a simple optimization exists in Gremlin OLAP called "reflexive message passing" which simulates non-message-passing BSP iterations within a single BSP iteration.</p>
</div>
<div class="paragraph">
<p>When the computation is complete a <a href="#mapreduce">MapReduce</a> job executes which aggregates all the <code>groupCount()</code> sideEffect Map (i.e. "<code>HashMap</code>") objects on each vertex into a single local representation (thus, turning the distributed Map representation into a local Map representation).</p>
</div>
<div class="paragraph">
<p>The same OLAP traversal can be executed using the standard <code>g.compute()</code> model, though at the expense of verbosity. <code>TraversalVertexProgram</code> provides a fluent <code>Builder</code> for constructing a <code>TraversalVertexProgram</code>. The specified <code>traversal()</code> can be either a <code>Supplier&lt;Traversal&gt;</code> object, a <code>Supplier&lt;Traversal&gt;</code> class, or a <a href="http://en.wikipedia.org/wiki/Scripting_for_the_Java_Platform">JSR-223</a> script that will generate (i.e. supply) a <code>Traversal</code>. If <code>traversal()</code> is supplied a single string, it is assumed that "gremlin-groovy" is the <code>ScriptEngine</code> to use. If two strings are supplied, then the first string denotes the <code>ScriptEngine</code> to evaluate the second string script with in order to generate (i.e. supply) the <code>Traversal</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; result = g.compute().program(TraversalVertexProgram.build().traversal(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph.open().V().both().has('age').values('age').groupCount('a')</span><span class="delimiter">&quot;</span></span>).create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">3</span>]]
gremlin&gt; result.memory().a
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span>
gremlin&gt; result.memory().iteration
==&gt;<span class="integer">5</span>
gremlin&gt; result.memory().runtime
==&gt;<span class="integer">7</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="distributed-gremlin-gotchas">Distributed Gremlin Gotchas</h4>
<div class="paragraph">
<p>Gremlin OLTP is not identical to Gremlin OLAP.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
There are two primary theoretical differences between Gremlin OLTP and Gremlin OLAP. First, Gremlin OLTP (via <code>Traversal</code>) leverages a <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> execution engine. Depth-first execution has a limited memory footprint due to <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy evaluation</a>. On the other hand, Gremlin OLAP (via <code>TraversalVertexProgram</code>) leverages a <a href="http://en.wikipedia.org/wiki/Breadth-first_search">breadth-first</a> execution engine which maintains a larger memory footprint, but a better time complexity due to vertex-local traversers being able to be merged. The second difference is that Gremlin OLTP is executed in a serial fashion, while Gremlin OLAP is executed in a parallel fashion. These two fundamental differences lead to the behaviors enumerated below.
</td>
</tr>
</table>
</div>
<div class="imageblock" style="float: right">
<div class="content">
<img src="images/gremlin-without-a-cause.png" alt="gremlin without a cause" width="200">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Traversal sideEffects are represented as a distributed data structure across the graph&#8217;s vertex set. It is not possible to get a global view of a sideEffect until it is aggregated via a <a href="#mapreduce">MapReduce</a> job. In some situations, the local vertex representation of the sideEffect is sufficient to ensure the intended semantics of the traversal are respected. However, this is not generally true so be wary of traversals that require global views of a sideEffect.</p>
</li>
<li>
<p>When evaluating traversals that rely on path information (i.e. the history of the traversal), practical computational limits can easily be reached due the <a href="http://en.wikipedia.org/wiki/Combinatorial_explosion">combinatoric explosion</a> of data. With path computing enabled, every traverser is unique and thus, must be enumerated as opposed to being counted/merged. The difference being a collection of paths vs. a single 64-bit long at a single vertex. For more information on this concept, please see <a href="http://thinkaurelius.com/2012/11/11/faunus-provides-big-graph-data-analytics/">Faunus Provides Big Graph Data</a>.</p>
</li>
<li>
<p>When traversals of the form <code>x.as('a').y.someSideEffectStep('a').z</code> are evaluated, the <code>a</code> sideEffect is stored in the path information of the traverser and thus, such traversals turn on path calculations when executed on a GraphComputer.</p>
</li>
<li>
<p>Steps that are concerned with the global ordering of traversers do not have a meaningful representation in OLAP. For example, what does <a href="#order-step"><code>order()</code></a>-step mean when all traversers are being processed in parallel? Even if the traversers were aggregated and ordered, then at the next step they would return to being executed in parallel and thus, in an unpredictable order. Other steps of this nature include <a href="#orderby-step"><code>orderby()</code></a> and <a href="#shuffle-step"><code>shuffle()</code></a>. When these steps are executed at the end of a traversal (i.e the final step), the <code>TraverserMapReduce</code> job ensures the resultant serial representation is ordered accordingly.</p>
</li>
<li>
<p>Steps that are concerned with providing a global aggregate to the next step of computation do not have a correlate in OLAP. For example, <a href="#fold-step"><code>fold()</code></a>-step can only fold up the objects at each executing vertex. Next, even if a global fold was possible, where would it go? Which vertex would be the host of the data structure? The <code>fold()</code>-step only makes sense as an end-step whereby a MapReduce job can generate the proper global-to-local data reduction.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<h1 id="gremlin-applications" class="sect0">Gremlin Applications</h1>
<div class="sect1">
<h2 id="gremlin-console">Gremlin Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-console.png" alt="gremlin-console" width="325"></span> The Gremlin Console is an interactive terminal or <a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> that can be used to traverse graphs and interact with the data that they contain.  It represents the most common method for performing ad-hoc graph analysis, small to medium sized data loading projects and other exploratory functions.  The Gremlin Console is highly extensible, featuring a rich plugin system that allows new tools, commands, <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSLs</a>, etc. to be exposed to users.</p>
</div>
<div class="paragraph">
<p>To start the Gremlin Console, run <code>gremlin.sh</code> or <code>gremlin.bat</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin loaded: tinkerpop.server
plugin loaded: tinkerpop.utilities
plugin loaded: tinkerpop.tinkergraph
gremlin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the above plugins are not loaded then they will need to be enabled or else certain examples will not work. If using the standard Gremlin Console distribution, then the plugins should be enabled by default.  See below for more information on the <code>:plugin use</code> command to manually enable plugins. These plugins, with the exception of <code>tinkerpop.tinkergraph</code>, cannot be removed from the Console as they are a part of the <code>gremlin-console.jar</code> itself.  These plugins can only be deactivated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Gremlin Console is loaded and ready for commands. Recall that the console hosts the Gremlin-Groovy language.  Please review <a href="http://groovy.codehaus.org/">Groovy</a> for help on Groovy-related constructs. In short, Groovy is a superset of Java. What works in Java, works in Groovy. However, Groovy provides many shorthands to make it easier to interact with the Java API.  Moreoever, Gremlin provides many neat shorthands to make it easier to express paths through a property graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; i = <span class="string"><span class="delimiter">'</span><span class="content">goodbye</span><span class="delimiter">'</span></span>
==&gt;goodbye
gremlin&gt; j = <span class="string"><span class="delimiter">'</span><span class="content">self</span><span class="delimiter">'</span></span>
==&gt;self
gremlin&gt; i + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + j
==&gt;goodbye self
gremlin&gt; <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>i<span class="inline-delimiter">}</span></span><span class="content"> </span><span class="inline"><span class="inline-delimiter">${</span>j<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
==&gt;goodbye self</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "toy" graph provides a way to get started with Gremlin quickly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g.V()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_console_commands">Console Commands</h3>
<div class="paragraph">
<p>In addition to the standard commands of the <a href="http://groovy.codehaus.org/Groovy+Shell">Groovy Shell</a>, Gremlin adds some other useful operations.  The following table outlines the most commonly used commands:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:13%;">
<col style="width:66%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-center valign-top">Alias</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:help</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays list of commands and descriptions.  When followed by a command name, it will display more specific help on that particular item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:exit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ends the Console session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">import</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import a class into the Console session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:clear</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sometimes the Console can get into a state where the command buffer no longer understands input (e.g. a misplaced <code>(</code> or <code>}</code>).  Use this command to clear that buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:load</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load a file or URL into the command buffer for execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:install</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imports a maven library and its dependencies into the Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:uninstall</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a maven library and its dependencies. A restart of the console is required for removal to fully take effect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:plugin</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:pin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin management functions to list, activate and deactivate available plugins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:remote</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:rem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a "remote" context where Gremlin or results of Gremlin will be processed via usage of <code>:submit</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:submit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Submit Gremlin to the currently active context defined by <code>:remote</code>.</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_dependencies_and_plugin_usage">Dependencies and Plugin Usage</h3>
<div class="paragraph">
<p>The Gremlin Console can dynamically load external code libraries and make them available to the user.  Furthermore, those dependencies may contain Gremlin plugins which can expand the language, provide useful functions, etc.  These important console features are managed by the <code>:install</code> and <code>:plugin</code> commands.</p>
</div>
<div class="paragraph">
<p>The following Gremlin Console session demonstrates the basics of these features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :plugin list  <b>(1)</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.sugar
==&gt;tinkerpop.tinkergraph[active]
gremlin&gt; :plugin use tinkerpop.sugar  <b>(2)</b>
==&gt;tinkerpop.sugar activated
gremlin&gt; :install com.tinkerpop neo4j-gremlin <span class="float">3.0</span><span class="float">.0</span>.M6  <b>(3)</b>
==&gt;<span class="key">loaded</span>: [com.tinkerpop, neo4j-gremlin, <span class="float">3.0</span><span class="float">.0</span>.M6]
gremlin&gt; :plugin list <b>(4)</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.sugar
==&gt;tinkerpop.tinkergraph[active]
==&gt;tinkerpop.neo4j
gremlin&gt; :plugin use tinkerpop.neo4j <b>(5)</b>
==&gt;tinkerpop.neo4j activated
gremlin&gt; :plugin list <b>(6)</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.sugar[active]
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.neo4j[active]
==&gt;tinkerpop.tinkergraph[active]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Show a list of "available" plugins.  The list of "available" plugins is determined by the classes available on the Console classpath.  Plugins need to be "active" for their features to be available.</p>
</li>
<li>
<p>To make a plugin "active" execute the <code>:plugin use</code> command and specify the name of the plugin to enable.</p>
</li>
<li>
<p>Sometimes there are external dependencies that would be useful within the Console.  To bring those in, execute <code>:install</code> and specify the Maven coordinates for the dependency.</p>
</li>
<li>
<p>Note that there is a "tinkerpop.neo4j" plugin available, but it is not yet "active".</p>
</li>
<li>
<p>Again, to use the "tinkerpop.neo4j" plugin, it must be made "active" with <code>:plugin use</code>.</p>
</li>
<li>
<p>Now when the plugin list is displayed, the "tinkerpop.neo4j" plugin is displayed as "active".</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Plugins must be compatible with the version of the Gremlin Console (or Gremlin Server) being used.  Attempts to use incompatible versions cannot be guaranteed to work.  Moreover, be prepared for dependency conflicts in third-party plugins, that may only be resolved via manual jar removal from the <code>ext/{plugin}</code> directory.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is possible to manage plugin activation and deactivation by manually editing the <code>ext/plugins.txt</code> file which contains the class names of the "active" plugins.  It is also possible to clear dependencies added by <code>:install</code> by deleting them from the <code>ext</code> directory.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-server">Gremlin Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-server.png" alt="gremlin-server" width="400"></span> Gremlin Server provides a way to remotely execute Gremlin scripts against one or more <code>Graph</code> instances hosted within it.  The benefits of using Gremlin Server include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allows any Gremlin Structure-enabled graph to exist as a standalone server, which in turn enables the ability for multiple clients to communicate with the same graph database.</p>
</li>
<li>
<p>Enables execution of ad-hoc queries through remotely submitted Gremlin scripts.</p>
</li>
<li>
<p>Allows for the hosting of Gremlin-based DSLs (Domain Specific Language) that expand the Gremlin language to match the language of the application domain, which will help support common graph use cases such as searching, ranking, and recommendation.</p>
</li>
<li>
<p>Provides a method for Non-JVM languages (e.g. Python, .NET, etc.) to communicate with the TinkerPop stack.</p>
</li>
<li>
<p>Exposes numerous methods for extension and customization to include serialization options, remote commands, etc.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gremlin Server is the replacement for <a href="http://rexster.tinkerpop.com">Rexster</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, communication with Gremlin Server occurs over <a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> and exposes a custom subprotocol for interacting with the server.</p>
</div>
<div class="sect2">
<h3 id="connecting-via-console">Connecting via Console</h3>
<div class="paragraph">
<p>The most direct way to get started with Gremlin Server is to issue it some remote Gremlin scripts from the Gremlin Console.  To do that, first start Gremlin Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ bin/gremlin-server.sh conf/gremlin-server-classic.yaml
[INFO] GremlinServer -
         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----

[INFO] GremlinServer - Configuring Gremlin Server from conf/gremlin-server-classic.yaml
[INFO] MetricManager - Configured Metrics Slf4jReporter configured with interval=180000ms and loggerName=com.tinkerpop.gremlin.server.Settings$Slf4jReporterMetrics
[INFO] GremlinServer$WebSocketServerInitializer - Configured application/vnd.gremlin-v1.0+kryo with com.tinkerpop.gremlin.driver.ser.KryoMessageSerializerV1d0
[INFO] GremlinServer$WebSocketServerInitializer - Configured application/vnd.gremlin-v1.0+kryo-stringd with com.tinkerpop.gremlin.driver.ser.KryoMessageSerializerV1d0
[INFO] Graphs - Graph [g] was successfully configured via [config/tinkergraph-empty.properties].
[INFO] GremlinExecutor - Getting dependencies for [[org.apache.commons, commons-math3, 3.2]]
[INFO] GremlinExecutor - Initialized gremlin-groovy ScriptEngine with scripts/generate-classic.groovy
[INFO] GremlinServer$WebSocketServerInitializer - Initialized GremlinExecutor and configured ScriptEngines.
[INFO] GremlinServer$WebSocketServerInitializer - Initialized Gremlin thread pool.  Threads in pool named with pattern gremlin-*
[INFO] GremlinServer - Gremlin Server configured with worker thread pool of 1 and boss thread pool of 1
[INFO] GremlinServer - Channel started at port 8182.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin Server is configured by the provided <a href="http://www.yaml.org/">YAML</a> file <code>conf/gremlin-server-classic.yaml</code>.  That file tells Gremlin Server many things such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host and port to serve on</p>
</li>
<li>
<p>Thread pool sizes</p>
</li>
<li>
<p>Where to report metrics gathered by the server</p>
</li>
<li>
<p>The serializers to make available</p>
</li>
<li>
<p>The Gremlin <code>ScriptEngine</code> instances to expose and external dependencies to inject into them</p>
</li>
<li>
<p><code>Graph</code> instances to expose</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log messages that printed above show a number of things, but most importantly, there is a <code>Graph</code> instance named <code>g</code> that is exposed in Gremlin Server.  This graph is an in-memory TinkerGraph and was empty at the start of the server.  An initialization script at <code>scripts/generate-classic.groovy</code> was executed during startup.  It&#8217;s contents are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy"><span class="comment">// Generates the classic graph into an &quot;empty&quot; TinkerGraph</span>
TinkerFactory.generateClassic(g)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script loads the "classic" graph into the empty TinkerGraph instance, preparing it for use.  With Gremlin Server running it is now possible to issue some scripts to it for processing.  Start Gremlin Console as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The console has the notion of a "remote", which represents a place a script will be sent from the console to be evaluated elsewhere in some other context (e.g. Gremlin Server, Hadoop, etc.).  To create a remote in the console, do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml
==&gt;Connected - localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:remote</code> command shown above displays the current status of the remote connection.  This command can also be used to configure a new connection and change other related settings.  To actually send a script to the server a different command is required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; :&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
gremlin&gt; :&gt; g.E().label().groupCount()
==&gt;{created=<span class="integer">4</span>, knows=<span class="integer">2</span>}
gremlin&gt; result
==&gt;result{object={created=<span class="integer">4</span>, knows=<span class="integer">2</span>} <span class="type">class</span>=<span class="class">java</span>.lang.String}
gremlin&gt; :remote close
==&gt;Removed - gremlin server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:&gt;</code> command, which is a shorthand for <code>:submit</code>, sends the script to the server to execute there.  Results are wrapped in an <code>Result</code> object which is a just a holder for each individual result.  The <code>class</code> shows the data type for the containing value.  Note that the last script sent was supposed to return a <code>Map</code>, but its <code>class</code> is <code>java.lang.String</code>.  By default, the connection is configured to only return text results.  In other words, Gremlin Server is using <code>toString</code> to serialize all results back to the console.  This enables virtually any object on the server to be returned to the console, but it doesn&#8217;t allow the opportunity to work with this data in any way in the console itself.  A different configuration of the <code>:remote</code> is required to get the results back as "objects":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote-objects.yaml <b>(1)</b>
==&gt;connected - localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; :remote list <b>(2)</b>
==&gt;<span class="integer">0</span> - Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]
==&gt;*<span class="integer">1</span> - Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]
gremlin&gt; :&gt; g.E().label().groupCount() <b>(3)</b>
==&gt;[<span class="key">created</span>:<span class="integer">4</span>, <span class="key">knows</span>:<span class="integer">2</span>]
gremlin&gt; m = result[<span class="integer">0</span>].object <b>(4)</b>
==&gt;created=<span class="integer">4</span>
==&gt;knows=<span class="integer">2</span>
gremlin&gt; m.sort{<span class="local-variable">it</span>.value}
==&gt;knows=<span class="integer">2</span>
==&gt;created=<span class="integer">4</span>
gremlin&gt; script = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
                  matthias = g.addVertex('name','matthias')
                  matthias.addEdge('co-creator',g.V().has('name','marko').next())
                  </span><span class="delimiter">&quot;&quot;&quot;</span></span>
gremlin&gt; :&gt; <span class="annotation">@script</span>   <b>(5)</b>
==&gt;e[<span class="integer">14</span>][<span class="integer">12</span>-co-creator-&gt;<span class="integer">1</span>]
gremlin&gt; :&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">matthias</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">co-creator</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
gremlin&gt; :remote close
==&gt;Removed - gremlin server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This configuration file specifies that results should be deserialized back into an <code>Object</code> in the Console with the caveat being that the server and console both know how to serialize and deserialize the result to be returned.</p>
</li>
<li>
<p>There are now two configured remote connections.  The one marked by an asterisk is the one that was just created and denotes the current one that <code>:sumbit</code> will react to.</p>
</li>
<li>
<p>When the script is executed again, the <code>class</code> is no longer shown to be a <code>java.lang.String</code>.  It is instead a <code>java.util.HashMap</code>.</p>
</li>
<li>
<p>The last result of a remote script is always stored in the reserved variable <code>result</code>, which allows access to the <code>Result</code> and by virtue of that, the <code>Map</code> itself.</p>
</li>
<li>
<p>If the submission requires multiple-lines to express, then a multi-line string can be created. The <code>:&gt;</code> command realizes that the user is referencing a variable via <code>@</code> and submits the string script.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In Groovy, <code>""" text """</code> is a convenient way to create a multi-line string and works well in concert with <code>:&gt; @variable</code>. Note that this model of submitting a string variable works for all <code>:&gt;</code> based plugins, not just Gremlin Server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_via_java">Connecting via Java</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>gremlin-driver<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-java.png" alt="gremlin-java" width="175"></span> TinkerPop3 comes equipped with a reference client for Java-based applications.  It is referred to as Gremlin Driver, which enables applications to send requests to Gremlin Server and get back results.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Gremlin Driver is currently under heavy development.  The API and configuration options are subject to drastic and breaking change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gremlin code is sent to the server from a <code>Client</code> instance.  A <code>Client</code> is created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Cluster cluster = Cluster.open();  <b>(1)</b>
Client client = cluster.connect(); <b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Opens a reference to <code>localhost</code> - note that there are many configuration options available in defining a <code>Cluster</code> object.</p>
</li>
<li>
<p>Creates a <code>Client</code> given the configuration options of the <code>Cluster</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once a <code>Client</code> instance is ready, it is possible to issue some Gremlin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="predefined-type">ResultSet</span> results = client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>);  <b>(1)</b>
results.stream().map(i -&gt; i.get(<span class="predefined-type">Integer</span>.class) * <span class="integer">2</span>);       <b>(2)</b>

CompletableFuture&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Result</span>&gt;&gt; results = client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>).all();  <b>(3)</b>

CompletableFuture&lt;<span class="predefined-type">ResultSet</span>&gt; future = client.submitAsync(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>); <b>(4)</b>

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;()
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,<span class="integer">4</span>)
client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,x]</span><span class="delimiter">&quot;</span></span>, params); <b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Submits a script that simply returns a <code>List</code> of integers.  This method blocks until the request is written to the server and a <code>ResultSet</code> is constructed.</p>
</li>
<li>
<p>Even though the <code>ResultSet</code> is constructed, it does not mean that the server has sent back the results (or even evaluated the script potentially).  The <code>ResultSet</code> is just a holder that is awaiting the results from the server.  In this case, they are streamed from the server as they arrive.</p>
</li>
<li>
<p>Submit a script, get a <code>ResultSet</code>, then return a <code>CompletableFuture</code> that will be called when all results have been returned.</p>
</li>
<li>
<p>Submit a script asynchronously without waiting for the request to be written to the server.</p>
</li>
<li>
<p>Parameterized request are considered the most efficient way to send Gremlin to the server as they can be cached, which will boost performance and reduce resources required on the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_via_rest">Connecting via REST</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-rexster.png" alt="gremlin-rexster" width="225"></span> While the default behavior for Gremlin Server is to provide a WebSockets-based connection, it can also be configured to support <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>.  The REST endpoint provides for a communication protocol familiar to most developers, with a wide support of programming languages, tools and libraries for accessing it.  As a result, REST provides a fast way to get started with Gremlin Server.   It also may represent an easier upgrade path from <a href="http://rexster.tinkerpop.com/">Rexster</a> as the API for the endpoint is very similar to Rexster&#8217;s <a href="https://github.com/tinkerpop/rexster/wiki/Gremlin-Extension">Gremlin Extension</a>.</p>
</div>
<div class="paragraph">
<p>Gremlin Server provides for a single REST endpoint - a Gremlin evaluator - which allows the submission of a Gremlin script as a request.  For each request, it returns a response containing the serialized results of that script.  To enable this endpoint, Gremlin Server needs to be configured with the <code>HttpChannelizer</code>, which replaces the default <code>WebSocketChannelizer</code>, in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="yaml language-yaml"><span class="key">channelizer</span>: <span class="string"><span class="content">com.tinkerpop.gremlin.server.channel.HttpChannelizer</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting is already configured in the <code>gremlin-server-rest-classic.yaml</code> file that is packaged with the Gremlin Server distribution.  To utilize it, start Gremlin Server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">bin/gremlin-server.sh conf/gremlin-server-rest-classic.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the server has started, issue a request.  Here&#8217;s an example with <a href="http://curl.haxx.se/">cURL</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ curl &quot;http://localhost:8182?gremlin=100-1&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:<span class="integer">99</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">0581cdba-b152-45c4-80fa-3d36a6eecf1c</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">200</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example showed a <code>GET</code> operation, but the preferred method for this endpoint is <code>POST</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-1\&quot;}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:<span class="integer">99</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ef2fe16c-441d-4e13-9ddb-3c7b5dfb10ba</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">200</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also preferred that Gremlin scripts be parameterized when possible via <code>bindings</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-x\&quot;, \&quot;bindings\&quot;:{\&quot;x\&quot;:1}}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>bindings</code> argument is a <code>Map</code> of variables where the keys become available as variables in the Gremlin script.  Note that parameterization of requests is critical to performance, as repeated script compilation can be avoided on each request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is possible to pass bindings via <code>GET</code> based requests.  All query string arguments besides the "gremlin" key containing the script to execute will be treated as bindings.  The caveat is that these arguments will always be treated as <code>String</code> values.  To ensure that data types are preserved or to pass complex objects such as lists or maps, use <code>POST</code> which will at least support the allowed JSON data types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, as Gremlin Server can host multiple <code>ScriptEngine</code> instances (e.g. <code>gremlin-groovy</code>, <code>nashorn</code>), it is possible to define the language to utilize to process the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-x\&quot;, \&quot;language\&quot;:\&quot;gremlin-groovy\&quot;, \&quot;bindings\&quot;:{\&quot;x\&quot;:1}}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default this value is set to <code>gremlin-groovy</code>.  If using a <code>GET</code> operation, this value can be set as a query string argument with by setting the <code>language</code> key.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Consider the size of the result of a submitted script being returned from the REST endpoint.  A script that iterates thousands of results will serialize each of those in memory into a single JSON result set.  It is quite possible that such a script will generate <code>OutOfMemoryError</code> exceptions on the server.  Consider the default WebSockets configuration, which supports streaming, if that type of use case is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuring">Configuring</h3>
<div class="paragraph">
<p>As mentioned earlier, Gremlin Server is configured though a YAML file.  By default, Gremlin Server will look for a file called <code>config/gremlin-server.yaml</code> to configure itself on startup.  To override this default, supply the file to use to <code>bin/gremlin-server.sh</code> as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">bin/gremlin-server.sh conf/gremlin-server-min.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gremlin-server.sh</code> file also serves a second purpose.  It can be used to "install" dependencies to the Gremlin Server path.  For example, to be able to configure and use other <code>Graph</code> implementations, the dependencies must be made available to Gremlin Server.  To do this, use the <code>-i</code> switch and supply the Maven coordinates for the dependency to "install".  For example, to use Neo4j in Gremlin Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">bin/gremlin-server.sh -i com.tinkerpop neo4j-gremlin 3.0.0.M6</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will "grab" the appropriate dependencies and copy them to the <code>ext</code> directory of Gremlin Server, which will then allow them to be "used" the next time the server is started.  To uninstall dependencies, simply delete them from the <code>ext</code> directory.</p>
</div>
<div class="paragraph">
<p>The following table describes the various configuration options that Gremlin Server expects:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:66%;">
<col style="width:13%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelizer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the <code>Channelizer</code> implementation to use.  A <code>Channelizer</code> is a "channel initializer" which Gremlin Server uses to define the type of processing pipeline to use.  By allowing different <code>Channelizer</code> implementations, Gremlin Server can support different communication protocols (e.g. Websockets, Java NIO, etc.).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WebSocketChannelizer,HttpChannelizer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">graphs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>Graph</code> configuration files where the key of the <code>Map</code> becomes the name to which the <code>Graph</code> will be bound and the value is the file name of a <code>Graph</code> configuration file.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlinPool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of "Gremlin" threads available to execute actual scripts in a <code>ScriptEngine</code>. This pool represents the workers available to handle blocking operations in Gremlin Server.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the host to bind the server to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.consoleReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on console reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.consoleReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to console.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on CSV reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.fileName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file to write metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to file.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.addressingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>MULTICAST</code> or <code>UNICAST</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on Ganglia reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Ganglia host to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics for Ganglia.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Ganglia port to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8649</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on Graphite reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Graphite host to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics for Graphite.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Graphite port to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2003</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a "prefix" to append to metrics keys reported to Graphite.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.jmxReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on JMX reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.slf4jReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on SLF4j reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.slf4jReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to SLF4j.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plugins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of plugins that should be activated on server startup in the available script engines. It assumes that the plugins are in Gremlin Server&#8217;s classpath.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to bind the server to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8182</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code> of <code>Map</code> settings, where each <code>Map</code> represents a <code>OpProcessor</code> implementation to use along with its configuration.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors[X].className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full class name of the <code>OpProcessor</code> implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors[X].config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> containing <code>OpProcessor</code> specific configurations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultIterationBatchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the size in which the result of a request is "batched" back to the client.  In other words, if set to <code>1</code>, then a result that had ten items in it would get each result sent back individually.  If set to <code>2</code> the same ten results would come back in five batches of two each.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>ScriptEngine</code> implementations to expose through Gremlin Server, where the key is the name given by the <code>ScriptEngine</code> implementation.  The key must match the name exactly for the <code>ScriptEngine</code> to be constructed.  The value paired with this key is itself a <code>Map</code> of configuration for that <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.imports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of classes/packages to make available to the <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.staticImports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of "static" imports to make available to the <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of script files to execute on <code>ScriptEngine</code> initialization. Modifications to <code>Graph</code> instance references will be stored globally in Gremlin Server, therefore it is possible to use initialization scripts to add Graph Strategies or create entirely new <code>Graph</code> instances all together.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of configuration settings for the <code>ScriptEngine</code>.  These settings are dependent on the <code>ScriptEngine</code> implementation being used.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEvaluationTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds before a script evaluation times out. The notion of "script evaluation" refers to the time it takes for the <code>ScriptEngine</code> to do its work and <strong>not</strong> any additional time it takes for the result of the evaluation to be iterated and serialized.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">30000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code> of <code>Map</code> settings, where each <code>Map</code> represents a <code>MessageSerializer</code> implementation to use along with its configuration.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers[X].className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full class name of the <code>MessageSerializer</code> implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers[X].config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> containing <code>MessageSerializer</code> specific configurations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializedResponseTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds before a response serialization times out.  The notion of "response serialization" refers to the time it takes for Gremlin Server to iterate an entire result after the script is evaluated in the <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">30000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if SSL is turned on or not.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadPoolBoss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads available to Gremlin Server for accepting connections. Should always be set to <code>1</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadPoolWorker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads available to Gremlin Server for processing non-blocking reads and writes.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_tuning">Tuning</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-handdrawn.png" alt="gremlin-handdrawn" width="120"></span> Tuning Gremlin Server for a particular environment may require some simple trial-and-error, but the following represent some basic guidelines that might be useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A "good" setting for <code>threadPoolWorker</code> is <code>2*number of cores</code>.  If a smaller setting can be used there while still achieving performance needs, then choose the smaller setting.  If a larger setting is needed, then consider a server with more cores.</p>
</li>
<li>
<p>The "right" size of the <code>gremlinPool</code> setting is somewhat dependent on the type of scripts that will be processed by Gremlin Server.  As requests arrive to Gremlin Server they are decoded and queued to be processed by threads in this pool.  When this pool is exhausted of threads, Gremlin Server will continue to accept incoming requests, but the queue will continue to grow.  If left to grow too large, the server will begin to slow.  When tuning around this setting, consider whether the bulk of the scripts being processed will be "fast" or "slow", where "fast" generally means being measured in the low hundreds of milliseconds and "slow" means anything longer than that.</p>
<div class="ulist">
<ul>
<li>
<p>If the bulk of the scripts being processed are expected to be "fast", then a good starting point for this setting is <code>2*threadPoolWorker</code>.</p>
</li>
<li>
<p>If the bulk of the scripts being processed are expected to be "slow", then a good starting point for this setting is <code>4*threadPoolWorker</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Scripts that are "slow" can really hurt Gremlin Server if they are not properly accounted for.  <code>ScriptEngine</code> evaluations are blocking operations that aren&#8217;t easily interrupted, so once a "slow" script is being evaluated in the context of a <code>ScriptEngine</code> it must finish its work.  Lots of "slow" scripts will eventually consume the <code>gremlinPool</code> preventing other scripts from getting processed from the queue.</p>
<div class="ulist">
<ul>
<li>
<p>To limit the impact of this problem consider properly setting the <code>scriptEvaluationTimeout</code> and the <code>serializedResponseTimeout</code> to something "sane".</p>
</li>
<li>
<p>Test the traversals being sent to Gremlin Server and determine the maximum time they take to evaluate and iterate over results, then set these configurations accordingly.</p>
</li>
<li>
<p>Note that <code>scriptEvaluationTimeout</code> does not interrupt the evaluation on timeout.  It merely allows Gremlin Server to "ignore" the result of that evaluation, which means the thread in the <code>gremlinPool</code> will still be consumed after the timeout.</p>
</li>
<li>
<p>The more powerful setting is the <code>serializedResponseTimeout</code>, which will actually kill the result iteration process and prevent additional processing.  In most situations, the iteration and serialization process is the more costly step in this process as an errant script that retuns a million or more results could send Gremlin Server into a long streaming cycle.  Script evaluation on the other hand is usually very fast, occurring on the order of milliseconds, but that is entirely dependent on the contents of the script itself.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_developing_a_driver">Developing a Driver</h3>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-server-protocol.png" alt="gremlin server protocol" width="325">
</div>
</div>
<div class="paragraph">
<p>One of the roles for Gremlin Server is to provide a bridge from TinkerPop to non-JVM languages (e.g. Go, Python, etc.).  Developers can build language bindings (or driver) that provide a way to submit Gremlin scripts to Gremlin Server and get back results.  Given the exstensible nature of Gremlin Server, it is difficult to provide an authoritative guide to developing a driver.  It is however possible to describe the core communication protocal using the standard out-of-the-box configuration which should provide enough information to develop a driver for a specific language.</p>
</div>
<div class="imageblock" style="float: right">
<div class="content">
<img src="images/gremlin-server-flow.png" alt="gremlin server flow" width="300">
</div>
</div>
<div class="paragraph">
<p>Gremlin Server is distributed with a configuration that utilizes <a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> with a custom sub-protocol.  Under this configuration, Gremlin Server accepts requests containing a Gremlin script, evaluates that script and then strems back the results.  The notion of "streaming" is depicted in the diagram to the right.</p>
</div>
<div class="paragraph">
<p>The diagram shows an incoming request to process the Gremlin script of <code>g.V</code>.  Gremlin Server evaluates that script getting an <code>Iterator</code> of vertices as a result.  Gremlin Server recognizes that the <code>Iterator</code> and steps through each <code>Vertex</code> within it.  The vertices are batched together given the <code>resultIterationBatchSize</code> configuration.  In this case, that value must be <code>2</code> given that each "response" contains two vertices.  Each response is serialized given the requested serializer type (JSON is likely best for non-JVM languages) and written back to the requesting client immediately.  Gremlin Server does not wait for the entire result to be iterated, before sending back a response.  It will send the responses as they are realized.</p>
</div>
<div class="paragraph">
<p>This approach allows for the processing of large result sets without having to serialize the entire result into memory for the response.  It places a bit of a burden on the developer of the driver however, because it becomes necessary to provide a way to reconstruct the entire result on the client side from all of the individual responses that Gremlin Server returns for a single request.  Again, this description of Gremlin Server&#8217;s "flow" is related to the out-of-the-box configuration.  It is quite possible to construct other flows, that might be more amenable to a particular language or style of processing.</p>
</div>
<div class="paragraph">
<p>To formulate a request to Gremlin Server, a <code>RequestMessage</code> needs to be constructed.  The <code>RequestMessage</code> is a generalized representation of a request that carries a set of "standard" values in addition to optional ones that are dependent on the operation being performed.  A <code>RequestMessage</code> has these fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://en.wikipedia.org/wiki/Globally_unique_identifier">UUID</a> representing the unique identification for the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">op</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the "operation" to execute based on the available <code>OpProcessor</code> configured in the Gremlin Server.  To evaluate a script, use <code>eval</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the <code>OpProcessor</code> to utilize. The default <code>OpProcessor</code> for evaluating scripts is unamed and therefore script evaluation purposes, this value can be an empty string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of arbitrary parameters to pass to Gremlin Server.  The requirements for the contents of this <code>Map</code> are dependent on the <code>op</code> selected.</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This message can be serialized in any fashion that is supported by Gremlin Server.  New serialization methods can be plugged in by implementing a <code>ServiceLoader</code> enabled <code>MessageSerializer</code>, however Gremlin Server provides for JSON serialization by default which will be good enough for purposes of most developers building drivers. A <code>RequestMessage</code> to evaluate a script with variable bindings looks like this in JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{ <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1d6d02bd-8e56-421d-9438-3bd6d0079ff1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">op</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eval</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processor</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">gremlin</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">g.v(x).out</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">bindings</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},
          <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin-groovy</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above JSON represents the "body" of the request to send to Gremlin Server. When sending this "body" over websockets Gremlin Server can accept a packet frame using a "text" (1) or a "binary" (2) opcode. Using "text" is a bit more limited in that Gremlin Server will always process the body of that request as JSON.  Generally speaking "text" is just for testing purposes.</p>
</div>
<div class="paragraph">
<p>The preferred method for sending requests to Gremlin Server is to use the "binary" opcode.  In this case, a "header" will need be sent in addition to to the "body".  The "header" basically consists of a "mime type" so that Gremlin Server knows how to deserialize the <code>RequestMessage</code>. So, the actual byte array sent to Gremlin Server would be formatted as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-server-request.png" alt="gremlin server request">
</div>
</div>
<div class="paragraph">
<p>The first byte represents the length of the "mime type" string value that follows.  Given the default configuration of Gremlin Server, this value should be set to <code>application/json</code>.  The "payload" represents the JSON message above encoded as bytes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gremlin Server will only accept masked packets as it pertains to websocket packet header construction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When Gremlin Server receives that request, it will decode it given the "mime type", pass it to the requested <code>OpProcessor</code> which will execute the <code>op</code> defined in the message.  In this case, it will evaluate the script <code>g.v(x).out</code> using the <code>bindings</code> supplied in the <code>args</code> and stream back the results in a series of <code>ResponseMessages</code>.  A <code>ResponseMessage</code> looks like this:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the <code>RequestMessage</code> that generated this <code>ResponseMessage</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>status</code> contains a <code>Map</code> of three keys: <code>code</code> which refers to a <code>ResultCode</code> that is somewhat analogous to an <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status code</a>, <code>attributes</code> that represent a <code>Map</code> of protocol-level information, and <code>message</code> which is just a human-readable <code>String</code> usually associated with errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>result</code> contains a <code>Map</code> of two keys: <code>data</code> which refers to the actual data returned from the server (the type of data is determined by the operation requested) and <code>meta</code> which is a <code>Map</code> of meta-data related to the response.</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>In this case the <code>ResponseMessage</code> returned to the client would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{<span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hiddens</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vadas</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:<span class="integer">27</span>}}],
           <span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
 <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1d6d02bd-8e56-421d-9438-3bd6d0079ff1</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">200</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin Server is capable of streaming results such that additional responses will arrive over the WebSocket until the iteration of the result on the server is complete.  Each successful incremental message will have a <code>ResultCode</code> of 200. The response stream is always marked as "complete" by a terminating message.  The "terminator" will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{<span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">null</span>,
           <span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
 <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1d6d02bd-8e56-421d-9438-3bd6d0079ff1</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">299</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>299</code> code signifies stream termination which means that all processing for the request <code>1d6d02bd-8e56-421d-9438-3bd6d0079ff1</code> is complete.  Please see the <a href="http://www.tinkerpop.com/javadocs/current/com/tinkerpop/gremlin/driver/message/ResultCode.html">javadoc</a> for more information on the various <code>code</code> values that are available.</p>
</div>
<div class="sect3">
<h4 id="_opprocessors_arguments">OpProcessors Arguments</h4>
<div class="paragraph">
<p>The following sections define a non-exhaustive list of available operations and arguments for embedded <code>OpProcessors</code> (i.e. ones packaged with Gremlin Server).</p>
</div>
<div class="sect4">
<h5 id="_common">Common</h5>
<div class="paragraph">
<p>All <code>OpProcessor</code> instances support these arguments.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:15%;">
<col style="width:15%;">
<col style="width:69%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the result is an iterator this value defines the number of iterations each <code>ResponseMessage</code> should contain - overrides the <code>resultIterationBatchSize</code> server setting.</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect4">
<h5 id="_standard_opprocessor">Standard OpProcessor</h5>
<div class="paragraph">
<p>The "standard" <code>OpProcessor</code> handles requests for the primary function of Gremlin Server - executing Gremlin. Requests made to this <code>OpProcessor</code> are "sessionless" in the sense that a request must encapsulate the entirety of a transaction.  There is no state maintained between requests.  A transaction is started when the script is first evaluated and is committed when the script completes (or rolled back if an error occurred).</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processor</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>As this is the default <code>OpProcessor</code> this value can be set to an empty string</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">op</p></td>
<td class="tableblock halign-left valign-top"><div><table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluate a Gremlin script provided as a <code>String</code></p></td>
</tr>
</tbody>
</table>
</div></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p><em><code>eval</code> operation arguments</em></p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:15%;">
<col style="width:15%;">
<col style="width:69%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> The Gremlin script to evaluate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bindings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of key/value pairs to apply as variables in the context of the Gremlin script</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The flavor used (e.g. <code>gremlin-groovy</code>)</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect4">
<h5 id="_session_opprocessor">Session OpProcessor</h5>
<div class="paragraph">
<p>The "session" <code>OpProcessor</code> handles requests for the primary function of Gremlin Server - executing Gremlin. It is like the "standard" <code>OpProcessor</code>, but instead maintains state between sessions and leaves all transaction management up to the calling client.  It is important that clients that open sessions, commit or roll them back, however Gremlin Server will try to clean up such things when a session is killed that has been abandoned.  It is important to consider that a session can only be maintained with a single machine.  In the event that multiple Gremlin Server are deployed, session state is not shared among them.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processor</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This value should be set to <code>session</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">op</p></td>
<td class="tableblock halign-left valign-top"><div><table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:23%;">
<col style="width:76%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluate a Gremlin script</p></td>
</tr>
</tbody>
</table>
</div></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p><em><code>eval</code> operation arguments</em></p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> The Gremlin script to evaluate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> The session identifier for the current session - typically this value should be a UUID (the session will be created if it doesn&#8217;t exist)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bindings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of key/value pairs to apply as variables in the context of the Gremlin script</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The flavor used (e.g. <code>gremlin-groovy</code>)</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-plugins">Gremlin Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="images/gremlin-plugin.png" alt="gremlin-plugin" width="125"></span></p>
</div>
<div class="paragraph">
<p>Plugins provide a way to expand the features of Gremlin Console and Gremlin Server. The first step to developing a plugin is to implement the <code>GremlinPlugin</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">com.tinkerpop.gremlin.groovy.plugin</span>;

<span class="keyword">import</span> <span class="include">java.util.Optional</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="comment">/**
 * Those wanting to extend Gremlin can implement this interface to provide custom imports and extension
 * methods to the language itself.  Gremlin uses ServiceLoader to install plugins.  It is necessary for
 * projects to include a com.tinkerpop.gremlin.groovy.plugin.GremlinPlugin file in META-INF/services of their
 * packaged project which includes the full class names of the implementations of this interface to install.
 *
 * @author Stephen Mallette (http://stephen.genoprime.com)
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">GremlinPlugin</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ENVIRONMENT = <span class="string"><span class="delimiter">&quot;</span><span class="content">GremlinPlugin.env</span><span class="delimiter">&quot;</span></span>;

    <span class="comment">/**
     * The name of the plugin.  This name should be unique (use a namespaced approach) as naming clashes will
     * prevent proper plugin operations. Plugins developed by TinkerPop will be prefixed with &quot;tinkerpop.&quot;
     * For example, TinkerPop's implementation of Giraph would be named &quot;tinkerpop.giraph&quot;.  If Facebook were
     * to do their own implementation the implementation might be called &quot;facebook.giraph&quot;.
     */</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName();

    <span class="comment">/**
     * Implementers will typically execute imports of classes within their project that they want available in the
     * console or they may use meta programming to introduce new extensions to the Gremlin.
     *
     * @throws IllegalEnvironmentException if there are missing environment properties required by the plugin as
     * provided from {@link PluginAcceptor#environment()}.
     * @throws PluginInitializationException if there is a failure in the plugin iniitalization process
     */</span>
    <span class="directive">public</span> <span class="type">void</span> pluginTo(<span class="directive">final</span> PluginAcceptor pluginAcceptor) <span class="directive">throws</span> IllegalEnvironmentException, PluginInitializationException;

    <span class="comment">/**
     * Some plugins may require a restart of the plugin host for the classloader to pick up the features.  This is
     * typically true of plugins that rely on {@code Class.forName()} to dynamically instantiate classes from the
     * root classloader (e.g. JDBC drivers that instantiate via @{code DriverManager}).
     */</span>
    <span class="directive">public</span> <span class="keyword">default</span> <span class="type">boolean</span> requireRestart() {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="comment">/**
     * Dependency managers in a plugin host will derive dependency information from the pom.xml.  If the scope for
     * dependencies in the pom.xml are {@code provided} then such dependencies will not be pulled in.  These provided
     * dependencies should be specified here so that the plugin host can grab them too.
     */</span>
    <span class="directive">public</span> <span class="keyword">default</span> Optional&lt;<span class="predefined-type">Set</span>&lt;Artifact&gt;&gt; additionalDependencies() {
        <span class="keyword">return</span> Optional.empty();
    }

    <span class="comment">/**
     * Allows a plugin to utilize features of the {@code :remote} and {@code :submit} commands of the Gremlin Console.
     * This method does not need to be implemented if the plugin is not meant for the Console for some reason or
     * if it does not intend to take advantage of those commands.
     */</span>
    <span class="directive">public</span> <span class="keyword">default</span> Optional&lt;RemoteAcceptor&gt; remoteAcceptor() {
        <span class="keyword">return</span> Optional.empty();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most simple plugin and the one most commonly implemented will likely be one that just provides a list of classes to import to the Gremlin Console.  This type of plugin is the easiest way for implementers of the TinkerPop Structure and Process APIs to make their implementations available to users.  The Neo4j implementation currently maintained by TinkerPop has just such a plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">com.tinkerpop.gremlin.neo4j.groovy.plugin</span>;

<span class="keyword">import</span> <span class="include">com.tinkerpop.gremlin.groovy.plugin.GremlinPlugin</span>;
<span class="keyword">import</span> <span class="include">com.tinkerpop.gremlin.groovy.plugin.IllegalEnvironmentException</span>;
<span class="keyword">import</span> <span class="include">com.tinkerpop.gremlin.groovy.plugin.PluginAcceptor</span>;
<span class="keyword">import</span> <span class="include">com.tinkerpop.gremlin.groovy.plugin.PluginInitializationException</span>;
<span class="keyword">import</span> <span class="include">com.tinkerpop.gremlin.neo4j.structure.Neo4jGraph</span>;

<span class="keyword">import</span> <span class="include">java.util.HashSet</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="comment">/**
 * @author Stephen Mallette (http://stephen.genoprime.com)
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jGremlinPlugin</span> <span class="directive">implements</span> GremlinPlugin {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> IMPORT = <span class="string"><span class="delimiter">&quot;</span><span class="content">import </span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DOT_STAR = <span class="string"><span class="delimiter">&quot;</span><span class="content">.*</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; IMPORTS = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;<span class="predefined-type">String</span>&gt;() {{
        add(IMPORT + Neo4jGraph.class.getPackage().getName() + DOT_STAR);
    }};

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop.neo4j</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> pluginTo(<span class="directive">final</span> PluginAcceptor pluginAcceptor) <span class="directive">throws</span> PluginInitializationException, IllegalEnvironmentException {
        pluginAcceptor.addImports(IMPORTS);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the plugin provides a unique name for the plugin which follows a namespaced pattern as <em>namespace</em>.<em>plugin-name</em> (e.g. "tinkerpop.hadoop" - "tinkerpop" is the reserved namespace for TinkerPop maintained plugins). To make Neo4j classes available to the Console, the <code>PluginAcceptor</code> is given a <code>Set</code> of imports to provide to the plugin host.  The <code>PluginAcceptor</code> essentially behaves as an abstraction to the "host" that is handling the <code>GremlinPlugin</code>.  <code>GremlinPlugin</code> implementations maybe hosted by the Console as well as the <code>ScriptEngine</code> in Gremlin Server.  Obviously, registering new commands and other operations that are specific to the Groovy Shell don&#8217;t make sense there.  Write the code for the plugin defensively by checking the <code>GremlinPlugin.env</code> key in the <code>PluginAcceptor.environment()</code> to understand which environment the plugin is being used in.</p>
</div>
<div class="paragraph">
<p>There is one other step to follow to ensure that the <code>GremlinPlugin</code> is visible to its hosts.  <code>GremlinPlugin</code> implementations are loaded via <a href="http://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">ServiceLoader</a> and therefore need a resource file added to the jar file where the plugin exists.  Add a file called <code>com.tinkerpop.gremlin.groovy.plugin.GremlinPlugin</code> to <code>META-INF.services</code>.  In the case of the Neo4j plugin above, that file will have this line in it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">com.tinkerpop.gremlin.neo4j.groovy.plugin.Neo4jGremlinPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the plugin is packaged, there are two ways to test it out:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the jar and its dependencies to the Gremlin Console path and start it.</p>
</li>
<li>
<p>Start Gremlin Console and try the <code>:install</code> command.  For the case of the Neo4j plugin, it would look like this: <code>:install com.tinkerpop neo4j-gremlin 3.0.0.M6</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In either case, once one of these two approaches is taken, the jars and their dependencies are available to the Console.  The next step is to "activate" the plugin by doing <code>:plugin use neo4j</code>, where "neo4j" refers to the name of the plugin to activate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When <code>:install</code> is used logging dependencies related to <a href="http://www.slf4j.org/">SLF4J</a> are filtered out so as not to introduce multiple logger bindings (which generates warning messages to the logs).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A plugin can do much more than just import classes.  One can expand the Gremlin language with new functions or steps, provide useful commands to make repetitive or complex tasks easier to execute, or do helpful integrations with other systems.  The secret to doing so lies in the <code>PluginAcceptor</code>.  As mentioned earlier, the <code>PluginAcceptor</code> provides access to the host of the plugin.  It provides several important methods for doing so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>addBinding</code> - These two function allow the plugin to inject whatever context it wants to the host.  For example, doing <code>addBinding('x',1)</code> would place a variable of <code>x</code> with a value of 1 into the console at the time of the plugin load.</p>
</li>
<li>
<p><code>eval</code> - Evaluates a script in the context of the host at the time of plugin startup.  For example, doing <code>eval("sum={x,y-&gt;x+y}")</code> would create a <code>sum</code> function that would be available to the user of the Console after the load of the plugin.</p>
</li>
<li>
<p><code>environment</code> - Provides context from the host environment.  For the console, the environment will return a <code>Map</code> containing a reference to the <code>IO</code> stream and the <code>Groovysh</code> instance.  These classes represent very low-level access to the underpinnings of the console.  Access to <code>Groovysh</code> allows for advanced features such as registering new commands (e.g. like the <code>:plugin</code> or <code>:remote</code> commands).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Plugins can also tie into the <code>:remote</code> and <code>:submit</code> commands.  Recall that a <code>:remote</code> represents a different context within which Gremlin is executed, when issued with <code>:submit</code>.  It is encouraged to use this integration point when possible, as opposed to registering new commands that can otherwise follow the <code>:remote</code> and <code>:submit</code> pattern.  To expose this integration point as part of a plugin, implement the <code>RemoteAcceptor</code> interface:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Be good to the users of plugins and prevent dependency conflicts. Maintaining a conflict free plugin is most easily done by using the <a href="http://maven.apache.org/enforcer/maven-enforcer-plugin/">Maven Enforcer Plugin</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Consider binding the plugin&#8217;s minor version to the TinkerPop minor version so that it&#8217;s easy for users to figure out plugin compatibility.  Otherwise, clearly document a compatibility matrix for the plugin somewhere that users can find it.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">com.tinkerpop.gremlin.groovy.plugin</span>;

<span class="keyword">import</span> <span class="include">org.codehaus.groovy.tools.shell.Groovysh</span>;

<span class="keyword">import</span> <span class="include">java.io.Closeable</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="comment">/**
 * @author Stephen Mallette (http://stephen.genoprime.com)
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">RemoteAcceptor</span> <span class="directive">extends</span> <span class="predefined-type">Closeable</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> RESULT = <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>;

    <span class="comment">/**
     * Gets called when :remote is used in conjunction with the &quot;connect&quot; option.  It is up to the implementation
     * to decide how additional arguments on the line should be treated after &quot;connect&quot;.
     *
     * @return an object to display as output to the user
     * @throws com.tinkerpop.gremlin.groovy.plugin.RemoteException if there is a problem with connecting
     */</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> connect(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; args) <span class="directive">throws</span> <span class="exception">RemoteException</span>;

    <span class="comment">/**
     * Gets called when :remote is used in conjunction with the &quot;config&quot; option.  It is up to the implementation
     * to decide how additional arguments on the line should be treated after &quot;config&quot;.
     *
     * @return an object to display as output to the user
     * @throws com.tinkerpop.gremlin.groovy.plugin.RemoteException if there is a problem with configuration
     */</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> configure(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; args) <span class="directive">throws</span> <span class="exception">RemoteException</span>;

    <span class="comment">/**
     * Gets called when :submit is executed.  It is up to the implementation to decide how additional arguments on
     * the line should be treated after &quot;submit&quot;.
     *
     * @return an object to display as output to the user
     * @throws com.tinkerpop.gremlin.groovy.plugin.RemoteException if there is a problem with submission
     */</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> submit(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; args) <span class="directive">throws</span> <span class="exception">RemoteException</span>;

    <span class="comment">/**
     * Retrieve a script as defined in the shell context.  This allows for multi-line scripts to be submitted.
     */</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> getScript(<span class="directive">final</span> <span class="predefined-type">String</span> submittedScript, <span class="directive">final</span> Groovysh shell) {
        <span class="keyword">return</span> submittedScript.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">@</span><span class="delimiter">&quot;</span></span>) ? shell.getInterp().getContext().getProperty(submittedScript.substring(<span class="integer">1</span>)).toString() : submittedScript;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RemoteAcceptor</code> implementation ties to a <code>GremlinPlugin</code> and will only be executed when in use with the Gremlin Console plugin host.  Simply instantiate and return a <code>RemoteAcceptor</code> in the <code>GremlinPlugin.remoteAcceptor()</code> method of the plugin implementation.  Generally speaking, each call to <code>remoteAcceptor()</code> should produce a new instance of a <code>RemoteAcceptor</code>.  It will likely be necessary that you provide context from the <code>GremlinPlugin</code> to the <code>RemoteAcceptor</code> plugin.  For example, the <code>RemoteAcceptor</code> implementation might require an instance of <code>Groovysh</code> to provide a way to dynamically evaluate a script provided to it so that it can process the results in a different way.</p>
</div>
<div class="sect2">
<h3 id="gephi-plugin">Gephi Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gephi-logo.png" alt="gephi-logo" width="200"></span> <a href="http://gephi.github.io/">Gephi</a> is an interactive visualization, exploration, and analysis platform for graphs. The <a href="https://marketplace.gephi.org/plugin/graph-streaming/">Graph Streaming</a> plugin for Gephi provides an <a href="https://wiki.gephi.org/index.php/Graph_Streaming">API</a> that can be leveraged to stream graphs and visualize traversals interactively through the Gremlin Gephi Plugin.</p>
</div>
<div class="paragraph">
<p>The following instructions assume that Gephi has been download and installed.  It further assumes that the Graph Streaming plugin has been installed (<code>Tools &gt; Plugins</code>). The following instructions explain how to visualize a <code>Graph</code> and <code>Traversal</code>.</p>
</div>
<div class="paragraph">
<p>In Gephi, create a new project with <code>File &gt; New Project</code>.  In the lower left view, click the "Streaming" tab, open the Master drop down, and right click <code>Master Server &gt; Start</code> which starts the Graph Streaming server in Gephi and by default accepts requests at <code>http://localhost:8080/workspace0</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gephi-start-server.png" alt="gephi start server" width="800">
</div>
</div>
<div class="paragraph">
<p>Start the <a href="#gremlin-console">Gremlin Console</a> and activate the Gephi plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :plugin use tinkerpop.gephi
==&gt;tinkerpop.gephi activated
gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; :remote connect tinkerpop.gephi
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace0 with stepDelay:1000, startRGBColor:[0.0, 1.0, 0.5], colorToFade:g, colorFadeRate:0.7</span>
gremlin&gt; :&gt; g
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Gremlin session activates the Gephi plugin, creates the classic <code>TinkerGraph</code>, uses the <code>:remote</code> command to setup a connection to the Graph Streaming server in Gephi (with default parameters that will be explained below), and then uses <code>:submit</code> which sends the vertices and edges of the graph to the Gephi Streaming Server. The resulting graph appears in Gephi as displayed in the left image below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gephi-graph-submit.png" alt="gephi graph submit" width="800">
</div>
</div>
<div class="paragraph">
<p>Now that the graph is visualized in Gephi, it is possible to <a href="https://gephi.github.io/users/tutorial-layouts/">apply a layout algorithm</a>, change the size and/or color of vertices and edges, and display labels/properties of interest.  Further information can be found in Gephi&#8217;s tutorial on <a href="https://gephi.github.io/users/tutorial-visualization/">Visualization</a>.  After applying the Fruchterman Reingold layout, increasing the node size, decreasing the edge scale, and displaying the id, name, and weight attributes the graph looks as displayed in the right image above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;s recommended to choose a continuously running layout algorithm like Fruchterman Reingold or Force Atlas, because every update to color the visited vertices causes their positions to be reset, so these layouts will constantly adjust to account for these changes and make visualization of the traversals.  This also explains why the graph seems to rotate each store step in the screenshots below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Consider the following traversal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">g.v(<span class="integer">2</span>).in().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).
      has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt,<span class="integer">30</span>).outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
      has(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>,gt,<span class="float">0.5f</span>).inV()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To visualize it insert the appropriately named <code>store('n')</code> steps where <code>n</code> is an integer, and the vertices will be highlighted in ascending store step order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g.v(<span class="integer">2</span>).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt,<span class="integer">30</span>).
               outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>,gt,<span class="float">0.5f</span>).inV().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
gremlin&gt; traversal = g.v(<span class="integer">2</span>).store(<span class="string"><span class="delimiter">'</span><span class="content">1</span><span class="delimiter">'</span></span>).
                           in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).store(<span class="string"><span class="delimiter">'</span><span class="content">2</span><span class="delimiter">'</span></span>).
                           out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt,<span class="integer">30</span>).store(<span class="string"><span class="delimiter">'</span><span class="content">3</span><span class="delimiter">'</span></span>).
                           outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>,gt,<span class="float">0.5f</span>).inV().store(<span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">5</span>]]
gremlin&gt; traversal.sideEffects().get(<span class="string"><span class="delimiter">'</span><span class="content">1</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">2</span>]
gremlin&gt; traversal.sideEffects().get(<span class="string"><span class="delimiter">'</span><span class="content">2</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; traversal.sideEffects().get(<span class="string"><span class="delimiter">'</span><span class="content">3</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">4</span>]
gremlin&gt; traversal.sideEffects().get(<span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">5</span>]
gremlin&gt;
gremlin&gt; :&gt; traversal
Visualizing vertices at <span class="key">step</span>: <span class="integer">1</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">2</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">3</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">4</span>... visited: <span class="integer">1</span>
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>:&gt; traversal</code> is called, it iterates through the sideEffects of the traversal accessing the vertices stored at each corresponding step. It then updates the vertices' color with <code>startRGBColor</code>, which in this case is a lime-green blue: [0.0,1.0,0.5]. After the first step visualization, it sleeps for the configured <code>stepDelay</code> in milliseconds. On the second step, it decays the configured <code>colorToFade</code> of all the previously visited vertices in prior steps, by multiplying the current <code>colorToFade</code> value for each vertex with the <code>colorFadeRate</code>.  To avoid color decay on prior steps, then provide a <code>colorFadeRate</code> value of <code>1.0</code>.  The screenshots below show how the visualization evolves over the 4 steps:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gephi-traversal.png" alt="gephi traversal" width="1200">
</div>
</div>
<div class="paragraph">
<p>Once a traversal visualization has executed, clear the colors in Gephi by selecting the grey square icon under the magnifying glass icon on the lower left tool bar next to the graph canvas.  Run another traversal against the same graph and it will update the appropriate vertices.  To get a sense of how the visualization configuration parameters affect the output, see the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :remote config startRGBColor [<span class="float">0.0</span>,<span class="float">0.3</span>,<span class="float">1.0</span>]
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace0 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:g, colorFadeRate:0.7</span>
gremlin&gt; :remote config colorToFade b
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace0 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:b, colorFadeRate:0.7</span>
gremlin&gt; :remote config colorFadeRate <span class="float">0.5</span>
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace0 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:b, colorFadeRate:0.5</span>
gremlin&gt; :&gt; traversal
Visualizing vertices at <span class="key">step</span>: <span class="integer">1</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">2</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">3</span>... visited: <span class="integer">1</span>
Visualizing vertices at <span class="key">step</span>: <span class="integer">4</span>... visited: <span class="integer">1</span>
gremlin&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gephi-traversal-config.png" alt="gephi traversal config" width="400">
</div>
</div>
<div class="paragraph">
<p>The visualization configuration above starts with a blue color now (most recently visited), fading the blue color (so that dark green remains on oldest visited), and fading the blue color more quickly so that the gradient from dark green to blue across steps has higher contrast. Here is a more detailed description of Gephi plugin configuration parameters, in the order accepted on the <code>:remote connect gephi</code> command, or modified via the <code>:remote config</code> command:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:66%;">
<col style="width:13%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workspace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the workspace that your Graph Streaming server is started for.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">workspace0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host URL where the Graph Streaming server is configured for.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the URL that the Graph Streaming server is listening on.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stepDelay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to pause between step visualizations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startRGBColor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A size 3 float array of RGB color values which define the starting color to update most recently visited nodes with.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">[0.0,1.0,0.5]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">colorToFade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A single char from the set <code>{r,g,b,R,G,B}</code> determining which color to fade for vertices visited in prior steps</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">g</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">colorFadeRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A float value in the range <code>(0.0,1.0]</code> which is multiplied against the current <code>colorToFade</code> value for prior vertices; a <code>1.0</code> value effectively turns off the color fading of prior step visited vertices</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.7</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="server-plugin">Server Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-server.png" alt="gremlin-server" width="200"></span> <a href="#gremlin-server">Gremlin Server</a> remotely executes Gremlin scripts that are submitted to it.  The Server Plugin provides a way to submit scripts to Gremlin Server for remote processing.  Read more about the plugin and how it works in the Gremlin Server section on <a href="#connecting-via-console">Connecting via Console</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Server Plugin is enabled in the Gremlin Console by default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sugar-plugin">Sugar Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-sugar.png" alt="gremlin-sugar" width="120"></span> In previous versions of Gremlin-Groovy, there were numerous <a href="http://en.wikipedia.org/wiki/Syntactic_sugar">syntactic sugars</a> that users could rely on to make their traversals more succinct. Unfortunately, many of these conventions made use of <a href="http://docs.oracle.com/javase/tutorial/reflect/">Java reflection</a> and thus, were not performant. In TinkerPop3, these conveniences have been removed in support of the standard Gremlin-Groovy syntax being both inline with Gremlin-Java8 syntax as well as always being the most performant representation. However, for those users that would like to use the previous syntactic sugars (as well as new ones), there is <code>SugarGremlinPlugin</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is important that the sugar plugin is loaded in a Gremlin Console session prior to any manipulations of the respective TinkerPop3 objects as Groovy will cache unavailable methods and properties.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :plugin use tinkerpop.sugar
==&gt;tinkerpop.sugar activated
gremlin&gt; g.v(<span class="integer">1</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)  <span class="comment">// conventional</span>
==&gt;marko
gremlin&gt; g.v(<span class="integer">1</span>).name  <span class="comment">// sugar</span>
==&gt;marko
gremlin&gt; g.V().map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}  <span class="comment">// conventional</span>
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V.map{<span class="local-variable">it</span>.name}  <span class="comment">// sugar</span>
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples above are generalized below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Missing element fields: if a vertex or edge&#8217;s instance field is selected and that field does not exist, then it is assumed the user means <code>values('fieldName')</code>.</p>
</li>
<li>
<p>Missing traverser method: if a traverser method is called and that method doesn&#8217;t exist, then it is assumed that the method is on the wrapped object of the traverser.</p>
</li>
<li>
<p>Missing traverser field: if a traverser field is called and that field doesn&#8217;t exist, then it is assumed that the field is on the wrapped object of the traverser.</p>
</li>
<li>
<p>Missing traversal field: if a traversal field is called and that field doesn&#8217;t exist, then it is assumed either a step() or defaults to <code>values('step')</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="utilities-plugin">Utilities Plugin</h3>
<div class="paragraph">
<p>The Utilities Plugin provides various functions, helper methods and imports of external classes that are useful in the console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Utilities Plugin is enabled in the Gremlin Console by default.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="clock">Clock</h4>
<div class="paragraph">
<p>The <code>clock</code> function provides a simple way to time how long it takes to execute a traversal (or any other code within the closure passed to it). By default, the <code>clock</code> function will execute the contents of the closure one hundred times and calculate the average time taken per execution.  <code>clock</code> can take an optional integer parameter to override number of times to execute the closure contents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :plugin use tinkerpop.utilities
==&gt;tinkerpop.utilities activated
gremlin&gt; g = TinkerFactory.createClassic()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; clock{g.V().both().both().both().iterate()}
==&gt;<span class="float">0.6182899999999999</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().both().both().both().iterate()}
==&gt;<span class="float">0.23745999999999978</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="benchmarking-and-profiling">Benchmarking and Profiling</h4>
<div class="paragraph">
<p>The <a href="https://code.google.com/p/gperfutils/">GPerfUtils</a> library provides a number of performance utilities for Groovy.  Specifically, these tools cover benchmarking and profiling.</p>
</div>
<div class="paragraph">
<p>Benchmarking allows execution time comparisons of different pieces of code. While such a feature is generally useful, in the context of Gremlin, benchmarking can help compare traversal performance times to determine the optimal approach.  Profiling helps determine the parts of a program which are taking the most execution time, yielding low-level insight into the code being examined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :plugin use tinkerpop.sugar <span class="comment">// activate sugar plugin for use in benchmark</span>
==&gt;tinkerpop.sugar activated
gremlin&gt; benchmark{
gremlin&gt;   <span class="string"><span class="delimiter">'</span><span class="content">sugar</span><span class="delimiter">'</span></span> {g.v(<span class="integer">1</span>).name.next()}
gremlin&gt;   <span class="string"><span class="delimiter">'</span><span class="content">nosugar</span><span class="delimiter">'</span></span> {g.v(<span class="integer">1</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).next()}}.prettyPrint()
Environment
===========
* <span class="key">Groovy</span>: <span class="float">2.3</span><span class="float">.6</span>
* <span class="key">JVM</span>: Java HotSpot(TM) <span class="integer">64</span>-Bit Server VM (<span class="float">25.5</span>-b02, Oracle Corporation)
    * <span class="key">JRE</span>: <span class="float">1.8</span><span class="float">.0</span>_05
    * Total <span class="key">Memory</span>: <span class="integer">161</span> MB
    * Maximum <span class="key">Memory</span>: <span class="float">1774.5</span> MB
* <span class="key">OS</span>: Linux (<span class="float">3.13</span><span class="float">.0</span>-<span class="integer">32</span>-generic, amd64)

Options
=======
* Warm <span class="key">Up</span>: Auto (- <span class="integer">60</span> sec)
* CPU <span class="predefined-type">Time</span> <span class="key">Measurement</span>: On

         user  system   cpu  real

sugar    <span class="integer">4135</span>       <span class="integer">0</span>  <span class="integer">4135</span>  <span class="integer">4143</span>
nosugar  <span class="integer">1223</span>       <span class="integer">0</span>  <span class="integer">1223</span>  <span class="integer">1226</span>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; profile { g.V().iterate() }.prettyPrint()
<span class="key">Flat</span>:

 %    cumulative   self            self     total    self    total   self    total
time   seconds    seconds  calls  ms/call  ms/call  min ms  min ms  max ms  max ms  name
<span class="float">61.8</span>        <span class="float">0.02</span>     <span class="float">0.02</span>      <span class="integer">1</span>    <span class="float">22.60</span>    <span class="float">22.60</span>   <span class="float">22.60</span>   <span class="float">22.60</span>   <span class="float">22.60</span>   <span class="float">22.60</span>  com.tinkerpop.gremlin.tinkergraph.process.graph.TinkerGraphTraversal.iterate
<span class="float">23.5</span>        <span class="float">0.03</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">8.62</span>     <span class="float">8.62</span>    <span class="float">8.62</span>    <span class="float">8.62</span>    <span class="float">8.62</span>    <span class="float">8.62</span>  com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph.V
<span class="float">13.4</span>        <span class="float">0.03</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">4.93</span>    <span class="float">36.57</span>    <span class="float">4.93</span>   <span class="float">36.57</span>    <span class="float">4.93</span>   <span class="float">36.57</span>  groovysh_evaluate<span class="error">$</span>_run_closure1.doCall
 <span class="float">1.0</span>        <span class="float">0.03</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">0.38</span>     <span class="float">0.40</span>    <span class="float">0.38</span>    <span class="float">0.40</span>    <span class="float">0.38</span>    <span class="float">0.40</span>  com.tinkerpop.gremlin.groovy.loaders.GremlinLoader.isStep
 <span class="float">0.0</span>        <span class="float">0.03</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">0.01</span>     <span class="float">0.01</span>    <span class="float">0.01</span>    <span class="float">0.01</span>    <span class="float">0.01</span>    <span class="float">0.01</span>  java.util.HashSet.contains

Call <span class="key">graph</span>:

index  % time  self  children  calls  name
               <span class="float">0.00</span>      <span class="float">0.03</span>    <span class="integer">1</span>/<span class="integer">1</span>      &lt;spontaneous&gt;
[<span class="integer">1</span>]     <span class="float">100.0</span>  <span class="float">0.00</span>      <span class="float">0.03</span>      <span class="integer">1</span>  groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
               <span class="float">0.02</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      com.tinkerpop.gremlin.tinkergraph.process.graph.TinkerGraphTraversal.iterate [<span class="integer">2</span>]
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph.V [<span class="integer">3</span>]
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      com.tinkerpop.gremlin.groovy.loaders.GremlinLoader.isStep [<span class="integer">4</span>]
--------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.02</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
[<span class="integer">2</span>]      <span class="float">61.8</span>  <span class="float">0.02</span>      <span class="float">0.00</span>      <span class="integer">1</span>  com.tinkerpop.gremlin.tinkergraph.process.graph.TinkerGraphTraversal.iterate [<span class="integer">2</span>]
--------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
[<span class="integer">3</span>]      <span class="float">23.5</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  com.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph.V [<span class="integer">3</span>]
--------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
[<span class="integer">4</span>]       <span class="float">1.1</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  com.tinkerpop.gremlin.groovy.loaders.GremlinLoader.isStep [<span class="integer">4</span>]
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      java.util.HashSet.contains [<span class="integer">5</span>]
--------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      com.tinkerpop.gremlin.groovy.loaders.GremlinLoader.isStep [<span class="integer">4</span>]
[<span class="integer">5</span>]       <span class="float">0.0</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  java.util.HashSet.contains [<span class="integer">5</span>]
--------------------------------------------------------------------------------------------------------------------------
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="describe-graph">Describe Graph</h4>
<div class="paragraph">
<p>A good implementation of the Gremlin APIs will validate their features against the <a href="#validating-with-gremlin-test">Gremlin test suite</a>.  To learn more about a specific implementation&#8217;s compliance with the test suite, use the <code>describeGraph</code> function.  The following shows the output for <code>HadoopGraph</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; describeGraph(HadoopGraph)
==&gt;
IMPLEMENTATION - com.tinkerpop.gremlin.hadoop.structure.HadoopGraph
TINKERPOP TEST SUITE
- Compliant with (<span class="integer">4</span> of <span class="integer">8</span> suites)
&gt; com.tinkerpop.gremlin.process.ProcessStandardSuite
&gt; com.tinkerpop.gremlin.process.ProcessComputerSuite
&gt; com.tinkerpop.gremlin.process.GroovyProcessStandardSuite
&gt; com.tinkerpop.gremlin.process.GroovyProcessComputerSuite
- Opts out of <span class="integer">12</span> individual tests
&gt; com.tinkerpop.gremlin.process.graph.step.map.MatchTest<span class="error">$</span>StandardTest<span class="error">#</span>g_V_matchXa_hasXname_GarciaX__a_0writtenBy_b__a_0sungBy_bX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
...
&gt; com.tinkerpop.gremlin.process.graph.step.map.MatchTest<span class="error">$</span>JavaMatchTest<span class="error">#</span>g_V_matchXa_inXsungByX_b__a_inXsungByX_c__b_outXwrittenByX_d__c_outXwrittenByX_e__d_hasXname_George_HarisonX__e_hasXname_Bob_MarleyXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>

- NOTE -
The describeGraph() function shows information about a Graph implementation.
It uses information found <span class="keyword">in</span> Java Annotations on the implementation itself to
determine <span class="local-variable">this</span> output and does not assess the actual code of the test cases of
the implementation itself.  Compliant implementations will faithfully and
honestly supply these Annotations to provide the most accurate depiction of
their support.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="implementations" class="sect0">Implementations</h1>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-racecar.png" alt="gremlin racecar" width="325">
</div>
</div>
<div class="sect1">
<h2 id="vendor-requirements">Vendor Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/tinkerpop-enabled.png" alt="tinkerpop-enabled" width="140"></span> At the core of TinkerPop3 is a Java8 API. The implementation of this core API and its validation via the <code>gremlin-test</code> suite is all that is required of a vendor wishing to provide a TinkerPop3-enabled graph engine. Once a vendor has a valid implementation, then all the applications provided by TinkerPop (e.g. Gremlin Console, Gremlin Server, etc.) and 3rd-party developers (e.g. Gremlin-Scala, Gremlin-JS, etc.) will integrate properly with their graph engine. Finally, please feel free to use the logo on the left to promote your TinkerPop3 implementation.</p>
</div>
<div class="sect2">
<h3 id="_implementing_gremlin_core">Implementing Gremlin-Core</h3>
<div class="paragraph">
<p>The classes that a vendor should focus on implemented are itemized below. Please feel free to study the TinkerGraph (in-memory OLTP and OLAP in <code>tinkergraph-gremlin</code>), Neo4jGraph (OTLP w/ transactions in <code>neo4j-gremlin</code>) and/or HadoopGraph (OLAP in <code>hadoop-gremlin</code>) implementations for ideas and patterns.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Online Transactional Processing Graph Systems (<strong>OLTP</strong>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Structure API: <code>Graph</code>, <code>Element</code>, <code>Vertex</code>, <code>Edge</code>, <code>Property</code> and <code>Transaction</code> (if transactions are supported).</p>
</li>
<li>
<p>Process API: a single <code>Step</code> that states how to yield vertices or edges from a <code>Graph</code> (i.e. <code>Graph.V()</code> and <code>Graph.E()</code>).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Online Analytics Processing Graph Systems (<strong>OLAP</strong>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Everything required of OTLP is required of OLAP (but not vice versa).</p>
</li>
<li>
<p>GraphComputer API: <code>GraphComputer</code>, <code>Messenger</code>, <code>Memory</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A collection of implementation notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Be sure your <code>Graph</code> implementation is named as <code>XXXGraph</code> (e.g. TinkerGraph, Neo4jGraph, HadoopGraph, etc.).</p>
</li>
<li>
<p>Use <code>StringHelper</code> to ensuring that the <code>toString()</code> representation of classes are consistent with other implementations.</p>
</li>
<li>
<p>Ensure that your implementation&#8217;s <code>Features</code> (Graph, Vertex, etc.) are correct so that test cases handle particulars accordingly.</p>
</li>
<li>
<p>Use the numerous static method helper classes such as <code>ElementHelper</code>, <code>GraphComputerHelper</code>, <code>VertexProgramHelper</code>, etc.</p>
</li>
<li>
<p>There are a number of default methods on the provided interfaces that are semantically correct. However, if they are not efficient for the implementation, override them.</p>
</li>
<li>
<p>Implement the <code>structure/</code> package interfaces first and then, if desired, interfaces in the <code>process/</code> package interfaces.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="oltp-implementations">OLTP Implementations</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/pipes-character-1.png" alt="pipes-character-1" width="110"></span> The most important interfaces to implement is the <code>structure/</code> package interfaces. These include interfaces like Graph, Vertex, Edge, Property, Transaction, etc. The only required <code>process/</code> interface to implement is a <code>GraphStep</code> extension. A <code>GraphStep</code> provides the means by which vertices and edges are retrieved from the graph and is required by <code>Graph.V()</code>, <code>Graph.E()</code>, <code>Graph.v()</code>, and <code>Graph.e()</code>. A bare-bones functional implementation will look as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyGraphStep</span>&lt;E <span class="directive">extends</span> <span class="predefined-type">Element</span>&gt; <span class="directive">extends</span> GraphStep&lt;E&gt; {

    <span class="directive">private</span> <span class="directive">final</span> MyGraph graph;

    <span class="directive">public</span> MyGraphStep(<span class="directive">final</span> Traversal traversal, <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;E&gt; returnClass, <span class="directive">final</span> MyGraph graph) {
        <span class="local-variable">super</span>(traversal, returnClass);
        <span class="local-variable">this</span>.graph = graph;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> generateTraverserIterator(<span class="directive">final</span> <span class="type">boolean</span> trackPaths) {
        <span class="local-variable">this</span>.start = Vertex.class.isAssignableFrom(<span class="local-variable">this</span>.returnClass) ? <span class="keyword">new</span> MyGraphVertexIterator(<span class="local-variable">this</span>.graph) : <span class="keyword">new</span> MyGraphEdgeIterator(<span class="local-variable">this</span>.graph);
        <span class="local-variable">super</span>.generateTraverserIterator(trackPaths);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the two references to <code>MyGraphVertexIterator</code> and <code>MyGraphEdgeIterator</code> in the code above. There are no explicit methods in Gremlin for iterating vertices out of the graph so private iterators should be developed which yield respective <code>Iterator&lt;Vertex&gt;</code> and <code>Iterator&lt;Edge&gt;</code> iterators. Once <code>MyGraphStep</code> has been created, it is tied into <code>MyGraph</code> via the <code>V()</code> and <code>E()</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyGraph</span> <span class="directive">implements</span> Graph {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> GraphTraversal&lt;Vertex, Vertex&gt; V() {
        <span class="directive">final</span> GraphTraversal&lt;Vertex, Vertex&gt; traversal = <span class="keyword">new</span> DefaultGraphTraversal&lt;&gt;(<span class="local-variable">this</span>);
        <span class="keyword">return</span> traversal.addStep(<span class="keyword">new</span> MyGraphStep&lt;&gt;(traversal, Vertex.class, <span class="local-variable">this</span>));
    }

     <span class="annotation">@Override</span>
     <span class="directive">public</span> GraphTraversal&lt;Vertex, Vertex&gt; E() {
        <span class="directive">final</span> GraphTraversal&lt;Vertex, Vertex&gt; traversal = <span class="keyword">new</span> DefaultGraphTraversal&lt;&gt;(<span class="local-variable">this</span>);
        <span class="keyword">return</span> traversal.addStep(<span class="keyword">new</span> MyGraphStep&lt;&gt;(traversal, Edge.class, <span class="local-variable">this</span>));
     }
     ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The methods <code>Graph.v()</code> and <code>Graph.e()</code> are default methods in Graph and can be overridden as desired if a more optimal retrieval is possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The MyGraph implementation of V() and E() are linear scans. In many situations, indices can be leveraged in situations such as <code>g.V().has('name','dan')</code>. In order to "fold" the has()-step into MyGraphStep, a <a href="#traversalstrategy"><code>TraversalStrategy</code></a> is required. Please review TinkerGraph&#8217;s <code>TinkerGraphStepStrategy</code> and <code>TinkerGraphStep</code> for the fundamentals.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, note that <code>Element</code> objects can be "traversed off of." That is, it is possible to <code>v.outE()</code> and <code>e.inV()</code>, etc. The method that implemented is <code>Vertex.start()</code> and a <code>MyVertex</code> implementation is demonstrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> GraphTraversal&lt;Vertex, Vertex&gt; start() {
    <span class="directive">final</span> GraphTraversal&lt;Vertex, Vertex&gt; traversal = <span class="keyword">new</span> DefaultGraphTraversal&lt;Vertex, Vertex&gt;(<span class="local-variable">this</span>.graph);
    <span class="keyword">return</span> traversal.addStep(<span class="keyword">new</span> StartStep&lt;&gt;(traversal, <span class="local-variable">this</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyVertex.start()</code> is required by <code>ElementTraversal&lt;A&gt;</code> interface and a default implementation is defined in <code>VertexTraversal&lt;Vertex&gt;</code>. As such, the above <code>start()</code> declaration is not required, though ultimately extensions to the method will be desired especially when OLAP concepts are taken into account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="keyword">default</span> GraphTraversal&lt;A, A&gt; start() {
    <span class="directive">final</span> GraphTraversal&lt;A, A&gt; traversal = GraphTraversal.of();
    <span class="keyword">return</span> traversal.addStep(<span class="keyword">new</span> StartStep&lt;&gt;(traversal, <span class="local-variable">this</span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="olap-implementations">OLAP Implementations</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/furnace-character-1.png" alt="furnace-character-1" width="110"></span> Implementing the OLAP interfaces may be a bit more complicated. Note that before OLAP interfaces are implemented, it is necessary for the OLTP interfaces to be, at minimally, implemented as specified in <a href="#oltp-implementations">OLTP Implementations</a>. A summary of each required interface implementation is presented below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>GraphComputer</code>: A fluent builder for specifying an isolation level, a VertexProgram, and any number of MapReduce jobs to be submitted.</p>
</li>
<li>
<p><code>Memory</code>: A global blackboard for ANDing, ORing, INCRing, and SETing values for specified keys.</p>
</li>
<li>
<p><code>Messenger</code>: The system that collects and distributes messages being propagated by vertices executing the VertexProgram application.</p>
</li>
<li>
<p><code>MapReduce.MapEmitter</code>: The system that collects key/value pairs being emitted by the MapReduce applications map-phase.</p>
</li>
<li>
<p><code>MapReduce.ReduceEmitter</code>: The system that collects key/value pairs being emitted by the MapReduce applications combine- and reduce-phases.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The interfaces VertexProgram and MapReduce in the <code>process/computer/</code> package are not required by the vendor to implement. Instead, these are interfaces to be implemented by application developers writing VertexPrograms and MapReduce jobs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerPop3 provides two OLAP implementations: <a href="#tinkergraph-gremlin">TinkerGraphComputer</a> and <a href="#hadoop-gremlin">HadoopGraphComputer</a>. It is a good idea to study these implementations to understand the nuances of the implementation requirements.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_implementing_graphcomputer">Implementing GraphComputer</h5>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/furnace-character-3.png" alt="furnace-character-3" width="150"></span> The most complex method in GraphComputer is the <code>submit()</code>-method. The method must do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure the the GraphComputer has not already been executed.</p>
</li>
<li>
<p>Ensure that at least there is a VertexProgram or 1 MapReduce job.</p>
</li>
<li>
<p>If there is a VertexProgram, validate that it can execute on the GraphComputer given the respectively defined features.</p>
</li>
<li>
<p>Create the Memory to be used for the computation.</p>
</li>
<li>
<p>Execute the VertexProgram.setup() method once and only once.</p>
</li>
<li>
<p>Execute the VertexProgram.execute() method for each vertex.</p>
</li>
<li>
<p>Execute the VertexProgram.terminate() method once and if true, repeat VertexProgram.execute().</p>
</li>
<li>
<p>When VertexProgram.terminate() returns true, move to MapReduce job execution.</p>
</li>
<li>
<p>MapReduce jobs are not required to be executed in any specified order.</p>
</li>
<li>
<p>For each Vertex, execute MapReduce.map(). Then (if defined) execute MapReduce.combine() and MapReduce.reduce().</p>
</li>
<li>
<p>Update Memory with runtime information.</p>
</li>
<li>
<p>Construct a new <code>ComputerResult</code> containing the compute Graph and Memory.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_memory">Implementing Memory</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-brain.png" alt="gremlin-brain" width="175"></span> The Memory object is initially defined by <code>VertexProgram.setup()</code>. The memory data is available in the first round of the <code>VertexProgram.execute()</code> method. Each Vertex, when executing the VertexProgram, can update the Memory in its round. However, the update is not seen by the other vertices until the next round. At the end of the first round, all the updates are aggregated and the new memory data is available on the second round. This process repeats until the VertexProgram terminates.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_messenger">Implementing Messenger</h5>
<div class="paragraph">
<p>The Messenger object is similar to the Memory object in that a vertex can read and write to the Messenger. However, the data it reads are the messages sent to the vertex in the previous step and the data it writes are the messages that will be readable by the receiving vertices in the subsequent round.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_mapreduce_emitters">Implementing MapReduce Emitters</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/hadoop-logo-notext.png" alt="hadoop-logo-notext" width="150"></span> The MapReduce framework in TinkerPop3 is similar to the model popularized by <a href="http://apache.hadoop.org">Hadoop</a>. The primary difference is that all Mappers process the vertices of the graph, not an arbitrary key/value pair. A Gremlin OLAP vendor needs to provide implementations for to particular classes: <code>MapReduce.MapEmitter</code> and <code>MapReduce.ReduceEmitter</code>. TinkerGraph&#8217;s implementation is provided below which demonstrates the simplicity of the algorithm (especially when the data is all within the same JVM).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="type">class</span> <span class="class">TinkerMapEmitter</span>&lt;K, V&gt; <span class="directive">implements</span> MapReduce.MapEmitter&lt;K, V&gt; {

    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;K, <span class="predefined-type">Queue</span>&lt;V&gt;&gt; reduceMap = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;&gt;();
    <span class="directive">public</span> <span class="predefined-type">Queue</span>&lt;Pair&lt;K, V&gt;&gt; mapQueue = <span class="keyword">new</span> <span class="predefined-type">ConcurrentLinkedQueue</span>&lt;&gt;();
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">boolean</span> doReduce;

    <span class="directive">public</span> TinkerMapEmitter(<span class="directive">final</span> <span class="type">boolean</span> doReduce) {  <b>(1)</b>
        <span class="local-variable">this</span>.doReduce = doReduce;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> emit(K key, V value) {
        <span class="keyword">if</span> (<span class="local-variable">this</span>.doReduce)
            MapHelper.concurrentIncr(<span class="local-variable">this</span>.reduceMap, key, value); <b>(2)</b>
        <span class="keyword">else</span>
            <span class="local-variable">this</span>.mapQueue.add(<span class="keyword">new</span> Pair&lt;&gt;(key, value)); <b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the MapReduce job has a reduce, then use one data structure (<code>reduceMap</code>), else use another (<code>mapList</code>). The difference being that a reduction requires a grouping by key and therefore, the <code>Map&lt;K,Queue&lt;V&gt;&gt;</code> definition. If no reduction/grouping is required, then a simple <code>Queue&lt;Pair&lt;K,V&gt;&gt;</code> can be leveraged.</p>
</li>
<li>
<p>If reduce is to follow, then increment the Map with a new value for the key. <code>MapHelper</code> is a TinkerPop3 class with static methods for adding data to a Map.</p>
</li>
<li>
<p>If no reduce is to follow, then simply append a Pair to the queue.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="type">class</span> <span class="class">TinkerReduceEmitter</span>&lt;OK, OV&gt; <span class="directive">implements</span> MapReduce.ReduceEmitter&lt;OK, OV&gt; {

    <span class="directive">public</span> <span class="predefined-type">Queue</span>&lt;Pair&lt;OK, OV&gt;&gt; resultList = <span class="keyword">new</span> <span class="predefined-type">ConcurrentLinkedQueue</span>&lt;&gt;();

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> emit(<span class="directive">final</span> OK key, <span class="directive">final</span> OV value) {
        <span class="local-variable">this</span>.resultList.add(<span class="keyword">new</span> Pair&lt;&gt;(key, value));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>MapReduce.reduce()</code> is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">void</span> reduce(<span class="directive">final</span> MK key, <span class="directive">final</span> <span class="predefined-type">Iterator</span>&lt;MV&gt; values, <span class="directive">final</span> ReduceEmitter&lt;RK, RV&gt; emitter) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, for the TinkerGraph implementation, iterate through the entrySet of the <code>reduceMap</code> and call the <code>reduce()</code> method on each entry. The <code>reduce()</code> method can emit key/value pairs which are simply aggregated into a <code>Queue&lt;Pair&lt;OK,OV&gt;&gt;</code> in an analogous fashion to <code>TinkerMapEmitter</code> when no reduce is to follow. These two emitters are tied together in <code>TinkerGraphComputer.submit()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">...
for (<span class="directive">final</span> MapReduce mapReduce : <span class="local-variable">this</span>.mapReduces) {
    <span class="keyword">if</span> (mapReduce.doStage(MapReduce.Stage.MAP)) {
        <span class="directive">final</span> TinkerMapEmitter&lt;?, ?&gt; mapEmitter = <span class="keyword">new</span> TinkerMapEmitter&lt;&gt;(mapReduce.doStage(MapReduce.Stage.REDUCE));
        TinkerHelper.getVertices(<span class="local-variable">this</span>.graph).parallelStream().forEach(vertex -&gt; mapReduce.map(vertex, mapEmitter));
        <span class="comment">// no need to run combiners as this is single machine</span>
        <span class="keyword">if</span> (mapReduce.doStage(MapReduce.Stage.REDUCE)) {
            <span class="directive">final</span> TinkerReduceEmitter&lt;?, ?&gt; reduceEmitter = <span class="keyword">new</span> TinkerReduceEmitter&lt;&gt;();
            mapEmitter.reduceMap.entrySet().parallelStream().forEach(entry -&gt; mapReduce.reduce(entry.getKey(), entry.getValue().iterator(), reduceEmitter));
            mapReduce.addSideEffectToMemory(<span class="local-variable">this</span>.memory, reduceEmitter.resultList.iterator()); <b>(1)</b>
        } <span class="keyword">else</span> {
            mapReduce.addSideEffectToMemory(<span class="local-variable">this</span>.memory, mapEmitter.mapQueue.iterator()); <b>(2)</b>
        }
    }
}
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note that the final results of the reducer are provided to the Memory as specified by the application developer&#8217;s <code>MapReduce.addSideEffectToMemory()</code> implementation.</p>
</li>
<li>
<p>If there is no reduce stage, the the map-stage results are inserted into Memory as specified by the application developer&#8217;s <code>MapReduce.addSideEffectToMemory()</code> implementation.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-with-gremlin-test">Validating with Gremlin-Test</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>gremlin-test<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The operational semantics of any OLTP or OLAP implementation are validated by <code>gremlin-test</code>. Please provide the following test cases with your implementation, where <code>XXX</code> below denotes the name of your graph implementation (e.g. TinkerGraph, Neo4jGraph, HadoopGraph, etc.).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is as important to look at "ignored" tests as it is to look at ones that fail.  The <code>gremlin-test</code> suite utilizes the <code>Feature</code> implementation exposed by the <code>Graph</code> to determine which tests to execute.  If a test utilizes features that are not supported by the graph, it will ignore them.  While that may be fine, implementers should validate that the ignored tests are appropriately bypassed and that there are no mistakes in their feature definitions.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="comment">// Structure API tests</span>
<span class="annotation">@RunWith</span>(StructureStandardSuite.class)
<span class="annotation">@StructureStandardSuite</span>.GraphProviderClass(provider = XXXGraphProvider.class, graph = XXXGraph.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">XXXStructureStandardTest</span> {}

<span class="annotation">@RunWith</span>(StructurePerformanceSuite.class)
<span class="annotation">@StructurePerformanceSuite</span>.GraphProviderClass(provider = XXXGraphProvider.class, graph = XXXGraph.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">XXXStructurePerformanceTest</span> {}

<span class="comment">// Process API tests</span>
<span class="annotation">@RunWith</span>(ProcessComputerSuite.class)
<span class="annotation">@ProcessComputerSuite</span>.GraphProviderClass(provider = XXXGraphProvider.class, graph = XXXGraph.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">XXXProcessComputerTest</span> {}

<span class="annotation">@RunWith</span>(ProcessStandardSuite.class)
<span class="annotation">@ProcessStandardSuite</span>.GraphProviderClass(provider = XXXGraphProvider.class, graph = XXXGraph.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">XXXProcessStandardTest</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only test-class that requires any code investment is the <code>XXXGraphProvider.class</code>. Neo4j&#8217;s implementation is provided below for reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jGraphProvider</span> <span class="directive">extends</span> AbstractGraphProvider {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; getBaseConfiguration(<span class="directive">final</span> <span class="predefined-type">String</span> graphName) {
        <span class="comment">// this is what is passed into XXX.open()</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;() {{
            put(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.graph</span><span class="delimiter">&quot;</span></span>, Neo4jGraph.class.getName());
            put(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.neo4j.directory</span><span class="delimiter">&quot;</span></span>, getWorkingDirectory() + <span class="predefined-type">File</span>.separator + graphName);
        }};
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> clear(<span class="directive">final</span> Graph g, <span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != g) {
            <span class="keyword">if</span> (g.features().graph().supportsTransactions())
                g.tx().rollback();
            g.close();
        }
        <span class="keyword">if</span> (configuration.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.neo4j.directory</span><span class="delimiter">&quot;</span></span>)) {
            <span class="comment">// this is a non-in-memory configuration so blow away the directory</span>
            <span class="directive">final</span> <span class="predefined-type">File</span> graphDirectory = <span class="keyword">new</span> <span class="predefined-type">File</span>(configuration.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.neo4j.directory</span><span class="delimiter">&quot;</span></span>));
            deleteDirectory(graphDirectory);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, specify the test suites that will be supported by the <code>Graph</code> implementation using the <code>@Graph.OptIn</code> annotation.  See the <code>TinkerGraph</code> implementation below as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_STRUCTURE_STANDARD)
<span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_STRUCTURE_PERFORMANCE)
<span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_PROCESS_STANDARD)
<span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_PROCESS_COMPUTER)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TinkerGraph</span> <span class="directive">implements</span> Graph {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only include annotations for the suites the implementation will support.  Note that implementing the suite, but not specifying the appropriate annotation will prevent the suite from running (an obvious error message will appear in this case when running the mis-configured suite).</p>
</div>
<div class="paragraph">
<p>There are times when there may be a specific test in the suite that the implementation cannot support (despite the features it implements) or should not otherwise be executed.  It is possible for implementers to "opt-out" of a test by using the <code>@Graph.OptOut</code> annotation.  The following is an example of this annotation usage as taken from <code>HadoopGraph</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_PROCESS_STANDARD)
<span class="annotation">@Graph</span>.OptIn(Graph.OptIn.SUITE_PROCESS_COMPUTER)
<span class="annotation">@Graph</span>.OptOut(
        test = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.process.graph.step.map.MatchTest$JavaMatchTest</span><span class="delimiter">&quot;</span></span>,
        method = <span class="string"><span class="delimiter">&quot;</span><span class="content">g_V_matchXa_hasXname_GarciaX__a_inXwrittenByX_b__a_inXsungByX_bX</span><span class="delimiter">&quot;</span></span>,
        reason = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Graph</span>.OptOut(
        test = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.process.graph.step.map.MatchTest$JavaMatchTest</span><span class="delimiter">&quot;</span></span>,
        method = <span class="string"><span class="delimiter">&quot;</span><span class="content">g_V_matchXa_inXsungByX_b__a_inXsungByX_c__b_outXwrittenByX_d__c_outXwrittenByX_e__d_hasXname_George_HarisonX__e_hasXname_Bob_MarleyXX</span><span class="delimiter">&quot;</span></span>,
        reason = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Graph</span>.OptOut(
        test = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.process.computer.GroovyGraphComputerTest$ComputerTest</span><span class="delimiter">&quot;</span></span>,
        method = <span class="string"><span class="delimiter">&quot;</span><span class="content">shouldNotAllowBadMemoryKeys</span><span class="delimiter">&quot;</span></span>,
        reason = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Graph</span>.OptOut(
        test = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.tinkerpop.gremlin.process.computer.GroovyGraphComputerTest$ComputerTest</span><span class="delimiter">&quot;</span></span>,
        method = <span class="string"><span class="delimiter">&quot;</span><span class="content">shouldRequireRegisteringMemoryKeys</span><span class="delimiter">&quot;</span></span>,
        reason = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HadoopGraph</span> <span class="directive">implements</span> Graph {</code></pre>
</div>
</div>
<div class="paragraph">
<p>These annotations help provide users a level of transparency into test suite compliance (via the <a href="#describe-graph">describeGraph()</a> utility function). It also allows implementers to have a lot of flexibility in terms of how they wish to support TinkerPop.  For example, maybe there is a single test case that prevents an implementer from claiming support of a <code>Feature</code>.  The implementer could choose to either not support the <code>Feature</code> or support it but "opt-out" of the test with a "reason" as to why so that users understand the limitation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessibility_via_gremlinplugin">Accessibility via GremlinPlugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/gremlin-plugin.png" alt="gremlin-plugin" width="100"></span> The applications distributed with TinkerPop3 do not distribute with any vendor implementations besides TinkerGraph. If your implementation is stored in a Maven repository (e.g. Maven Central Repository), then it is best to provide a <code>GremlinPlugin</code> implementation so the respective jars can be downloaded according and when required by the user. Neo4j&#8217;s GremlinPlugin is provided below for reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jGremlinPlugin</span> <span class="directive">implements</span> GremlinPlugin {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> IMPORT = <span class="string"><span class="delimiter">&quot;</span><span class="content">import </span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DOT_STAR = <span class="string"><span class="delimiter">&quot;</span><span class="content">.*</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; IMPORTS = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;<span class="predefined-type">String</span>&gt;() {{
        add(IMPORT + Neo4jGraph.class.getPackage().getName() + DOT_STAR);
    }};

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> pluginTo(<span class="directive">final</span> PluginAcceptor pluginAcceptor) {
        pluginAcceptor.addImports(IMPORTS);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above plugin implementations, users can now download respective binaries for Gremlin Console, Gremlin Server, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
No such <span class="key">property</span>: Neo4jGraph <span class="keyword">for</span> <span class="type">class</span>: <span class="class">groovysh_evaluate</span>
Display stack trace? [yN]
gremlin&gt; :install com.tinkerpop neo4j-gremlin <span class="float">3.0</span><span class="float">.0</span>.M6
==&gt;<span class="key">loaded</span>: [com.tinkerpop, neo4j-gremlin, <span class="error"></span>]
gremlin&gt; :plugin use tinkerpop.neo4j
==&gt;tinkerpop.neo4j activated
gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_in_depth_implementations">In-Depth Implementations</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/gremlin-painting.png" alt="gremlin-painting" width="200"></span> The vendor implementation details presented thus far are minimum requirements necessary to yield a valid TinkerPop3 implementation. However, there are other areas that a vendor can tweak to provide an implementation more optimized for their underlying graph engine. Typical areas of focus include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traversal Strategies: A <a href="#traversalstrategy">TraversalStrategy</a> can be used to alter a traversal prior to its execution. A typical example is converting a pattern of <code>g.V().has('name','marko')</code> into a global index lookup for all vertices with name "marko". In this way, a <code>O(|V|)</code> lookup becomes an <code>O(log(|V|))</code>. Please review <code>TinkerGraphStepStrategy</code> for ideas.</p>
</li>
<li>
<p>Step Implementations: Every <a href="#graph-traversal-steps">step</a> is ultimately referenced by the <code>GraphTraversal</code> interface. It is possible to extend <code>GraphTraversal</code> to use a vendor-specific step implementation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tinkergraph-gremlin">TinkerGraph-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>tinkergraph-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/tinkerpop-character.png" alt="tinkerpop-character" width="100"></span> TinkerGraph is a single machine, in-memory, non-transactional graph engine that provides both OLTP and OLAP functionality. It is deployed with TinkerPop3 and serves as the reference implementation for other vendors to study in order to understand the semantics of the various methods of the TinkerPop3 API. Constructing a simple graph in Java8 is presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Graph g = TinkerGraph.open();
Vertex marko = g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>,<span class="integer">29</span>);
Vertex lop = g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,lop,<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>,<span class="float">0.6d</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above graph creates two vertices named "marko" and "lop" and connects them via a created-edge with a weight=0.6 property. Next, the graph can be queried as such.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">g.V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).out(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>g.V().has("name","marko")</code> part of the query can be executed in two ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A linear scan of all vertices filtering out those vertices that don&#8217;t have the name "marko"</p>
</li>
<li>
<p>A <code>O(log(|V|))</code> index lookup for all vertices with the name "marko"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the initial graph construction in the first code block, no index was defined and thus, a linear scan is executed. However, if the graph was constructed as such, then an index lookup would be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Graph g = TinkerGraph.open();
g.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,Vertex.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The runtimes for a vertex lookup by property is provided below for both no-index and indexed version of TinkerGraph over the Grateful Dead graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.loadGraphML(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()}
==&gt;<span class="float">0.11787599999999974</span>  <b>(1)</b>
gremlin&gt; g = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g.createIndex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,Vertex.class)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.loadGraphML(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()}
==&gt;<span class="float">0.03508100000000018</span> <b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Average runtime of 1000 vertex lookups when no <code>name</code>-index is defined.</p>
</li>
<li>
<p>Average runtime of 1000 vertex lookups when a <code>name</code>-index is defined.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Each graph vendor will have different mechanism by which indices and schemas are defined. TinkerPop3 does not require any conformance in this area. In TinkerGraph, the only definitions are around indices. With other vendors, property value types, indices, edge labels, etc. may be required to be defined <em>a priori</em> to adding data to the graph.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TinkerGraph is distributed with Gremlin Server and is therefore automatically available to it for configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="neo4j-gremlin">Neo4j-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>neo4j-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/neotechnology-logo.png" alt="neotechnology-logo" width="150"></span> <a href="http://neotechnology.com">Neo Technology</a> are the developers of the OLTP-based <a href="http://neo4j.org">Neo4j graph database</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Unless under a commercial agreement with Neo Technology, Neo4j is licensed as <a href="http://en.wikipedia.org/wiki/Affero_General_Public_License">AGPL</a>. Thus, <code>gremlin-neo4j</code> (source and binaries) are licensed as such due to their dependency on the Neo4j library. Note that neither the <a href="#gremlin-console">Gremlin Console</a> nor <a href="#gremlin-server">Gremlin Server</a> distribute with the Neo4j binaries. To access the Neo4j binaries, use the <code>:install</code> command to download binaries from <a href="http://search.maven.org/">Maven Central Repository</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; :install com.tinkerpop neo4j-gremlin <span class="float">3.0</span><span class="float">.0</span>.M6
==&gt;<span class="key">loaded</span>: [com.tinkerpop, neo4j-gremlin, <span class="float">3.0</span><span class="float">.0</span>.M6]
gremlin&gt; :plugin use tinkerpop.neo4j
==&gt;tinkerpop.neo4j activated
gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For those leveraging Neo4j High Availability, configure <code>Neo4jGraph</code> for "HA mode" by setting the <code>gremlin.neo4j.ha</code> flag to <code>true</code> in the <code>Configuration</code> object passed to <code>Neo4jGraph.open()</code>.  Note that when the flag is set (by default it is <code>false</code>), the <code>Neo4jGraph</code> instance expects HA configuration settings to be present.  As with embedded Neo4j, HA configuration keys should be prefixed with <code>gremlin.neo4j.conf</code>.  Please consult Neo4j documentation for more information on <a href="http://docs.neo4j.org/chunked/stable/ha.html">High Availability</a> configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>Neo4jGraph</code> supports both meta- and multi-properties (see <a href="#_vertex_properties">vertex properties</a>). However, these are implemented by making use of "hidden" Neo4j nodes. For example, when a vertex has multiple "name" properties, each property is a new node (multi-properties) which can have properties attached to it (meta-properties). As such, the underlying representation may become difficult to query directly using another graph language such as Cypher. The default setting is to disable multi- and meta-properties. However, if this feature is desired, then it can be activated via <code>gremlin.neo4j.metaProperties</code> and <code>gremlin.neo4j.multiProperties</code> configurations being set to <code>true</code>. Once the configuration is set, it can not be changed for the lifetime of the graph.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To host Neo4j in Gremlin Server, the dependencies must first be "installed" or otherwise copied to the Gremlin Server path.  The automated method for doing this would be to execute <code>bin/gremlin-server.sh -i com.tinkerpop neo4j-gremlin 3.0.0.M6</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_indices">Indices</h3>
<div class="paragraph">
<p>Neo4j 2.x supports two types of indices: <a href="http://docs.neo4j.org/chunked/stable/query-schema-index.html">schema indices</a> and <a href="http://docs.neo4j.org/chunked/stable/auto-indexing.html">automatic indices</a>. Automatic indices have been around since Neo4j 1.x and automatically index an element based on a pre-defined property keys. Schema indices are new to Neo4j 2.x and leverage vertex labels to partition the index space. TinkerPop3 does not provide method interfaces for defining schemas/indices for the underlying graph system. Thus, in order to create indices, the Neo4j API is leveraged.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>Neo4jGraph</code> will attempt to discern which indices to use when executing a traversal of the form <code>g.V().has()</code>. The general order of checking is: schema indices, automatic indices, label grouping linear-scan iteration, full linear-scan iteration.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_using_schema_indices">Using Schema Indices</h4>
<div class="paragraph">
<p>The Gremlin-Console session below demonstrates schema indices. For more information, please refer to the Neo4j documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manipulating schema indices with <a href="http://docs.neo4j.org/chunked/stable/query-schema-index.html">Cypher</a>.</p>
</li>
<li>
<p>Manipulating schema indices with the Neo4j <a href="http://docs.neo4j.org/chunked/stable/tutorials-java-embedded-new-index.html">Java API</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g.tx().open() <span class="comment">// direct Neo4j access requires explicit transaction creation</span>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; <span class="keyword">import</span> <span class="include">org.neo4j.graphdb.*</span>
...
gremlin&gt; g.getBaseGraph().schema().indexFor(DynamicLabel.label(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).on(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).create()
==&gt;IndexDefinition[<span class="key">label</span>:name, <span class="key">on</span>:person]
gremlin&gt; g.tx().commit()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">dog</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">puppy</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V().has(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below demonstrates the runtime benefits of indices and demonstrates how if there is no defined schema index (only vertex labels), a linear scan of the vertex-label partition is still faster than a linear scan of all vertices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g.tx().open()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; <span class="keyword">import</span> <span class="include">org.neo4j.graphdb.*</span>
...
gremlin&gt; g.getBaseGraph().schema().indexFor(DynamicLabel.label(<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>)).on(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).create() <b>(1)</b>
==&gt;IndexDefinition[<span class="key">label</span>:artist, <span class="key">on</span>:name]
gremlin&gt; g.tx().commit()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.loadGraphML(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(label,<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()}  <b>(2)</b>
==&gt;<span class="float">0.0585639999999997</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()} <b>(3)</b>
==&gt;<span class="float">0.6039889999999992</span>
gremlin&gt; g.getBaseGraph().schema().getIndexes(DynamicLabel.label(<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>)).iterator().next().drop() <b>(4)</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.tx().commit()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(label,<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()} <b>(5)</b>
==&gt;<span class="float">0.26470499999999936</span>
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).next()} <b>(6)</b>
==&gt;<span class="float">0.6293959999999993</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a schema index for all artist vertices on their name property.</p>
</li>
<li>
<p>Find all artists whose name is Garcia which uses the pre-defined schema index.</p>
</li>
<li>
<p>Find all vertices whose name is Garcia which requires a linear scan of all the data in the graph.</p>
</li>
<li>
<p>Drop the created index schema.</p>
</li>
<li>
<p>Find all artists whose name is Garcia which does a linear scan of the artist vertex-label partition.</p>
</li>
<li>
<p>Find all vertices whose name is Garcia which requires a linear scan of all the data in the graph.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_automatic_indices">Using Automatic Indices</h4>
<div class="paragraph">
<p>The Gremlin-Console session below demonstates automatic indices. For more information, please refer to the Neo4j documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manipulating automatic indices with the Neo4j <a href="http://docs.neo4j.org/chunked/stable/auto-indexing.html">Java API</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g.getBaseGraph().index().getNodeAutoIndexer().startAutoIndexingProperty(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.getBaseGraph().index().getNodeAutoIndexer().setEnabled(<span class="predefined-constant">true</span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">dog</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">puppy</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V().has(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The preferred method for dealing with automatic indices in Neo4j is via <code>Neo4jGraph.open()</code> configuration as opposed to runtime updating as demonstrated above. This is because with runtime updating, index information is not propagated across Neo4j connections.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cypher">Cypher</h3>
<div class="imageblock">
<div class="content">
<img src="images/gremlin-loves-cypher.png" alt="gremlin loves cypher" width="400">
</div>
</div>
<div class="paragraph">
<p>NeoTechnology are the creators of the graph pattern-match query language <a href="http://www.neo4j.org/learn/cypher">Cypher</a>. It is possible to leverage Cypher from within Gremlin by using the <code>Neo4jGraph.cypher()</code> graph traversal method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="groovy language-groovy">gremlin&gt; g = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g.loadKryo(<span class="string"><span class="delimiter">'</span><span class="content">data/tinkerpop-classic.gio</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g.cypher(<span class="string"><span class="delimiter">'</span><span class="content">MATCH (a {name:&quot;marko&quot;}) RETURN a</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:v[<span class="integer">0</span>]]
gremlin&gt; g.cypher(<span class="string"><span class="delimiter">'</span><span class="content">MATCH (a {name:&quot;marko&quot;}) RETURN a</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh
gremlin&gt; g.cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n{name:'marko'})-[:knows]-&gt;(m) RETURN m</span><span class="delimiter">&quot;</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).id().fold().
             cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m)-[:created]-&gt;(n) WHERE id(m) in {start} RETURN n</span><span class="delimiter">&quot;</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">n</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
==&gt;ripple</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, like <a href="#match-step"><code>match()</code></a> in Gremlin, it is possible to do a declarative pattern match and then move back into imperative Gremlin.  The last query presented above shows that the <code>cypher</code> step can be used at the start of a traversal or in the middle.  When used in the middle of a traversal, the result from the previous step becomes bound to an argument named <code>start</code>, which can then be used in the Cypher query as an argument.  In the example above, the vertex identifiers from the Cypher query that starts the traversal are collected with <code>fold</code> and which in turn produces a single Cypher query using those identifiers.  Without <code>fold</code>, the second Cypher query would have executed once for each identifier in the traversal and the Cypher would have had to have changed to something like: <code>MATCH (m)-[:created]-&gt;(n) WHERE id(m) = {start} RETURN n</code> (where the <code>IN</code> is replaced by <code>=</code>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
For those developers using <a href="#gremlin-server">Gremlin Server</a> against Neo4j, it is possible to do Cypher queries by simply placing the Cypher string in <code>g.cypher(...)</code> before submission to the server.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hadoop-gremlin">Hadoop-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>com.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>hadoop-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.0.0.M6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/hadoop-logo-notext.png" alt="hadoop-logo-notext" width="100"></span> <a href="http://hadoop.apache.org/">Hadoop</a> is a distributed computing framework that is used to process data represented across a multi-machine compute cluster. When the data in the Hadoop cluster represents a TinkerPop3 graph, then Hadoop-Gremlin can be used to process the graph using TinkerPop3&#8217;s OLTP and OLAP models of graph computing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This section assumes that the user has a Hadoop 1.x cluster functioning. For more information on getting started with Hadoop, please see the <a href="http://hadoop.apache.org/docs/r1.2.1/single_node_setup.html">Single Node Setup</a> tutorial. Moreover, if using <code>GiraphGraphComputer</code> it is advisable that the reader also familiarize their self with Giraph as well via the <a href="http://giraph.apache.org/quick_start.html">Getting Started</a> page.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_installing_hadoop_gremlin">Installing Hadoop-Gremlin</h3>
<div class="paragraph">
<p>To the <code>.bash_profile</code> file, add the following environmental variable (of course, be sure the directories are respective of the local machine locations). The <code>HADOOP_GREMLIN_LIBS</code> is the location of all the Hadoop-Gremlin jars. It is possible to place developer jars into this directory for loading into the Hadoop job&#8217;s classpath. Or, better yet, note that <code>HADOOP_GREMLIN_LIBS</code> can be a colon-separated (<code>:</code>) list of locations and thus will load all jars into the cluster at all provided locations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="shell language-shell">export HADOOP_GREMLIN_LIBS=/usr/local/gremlin-console/ext/hadoop-gremlin/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using <a href="#gremlin-console">Gremlin Console</a>, it is important to install the Hadoop-Gremlin plugin. Note that Hadoop-Gremlin requires a Gremlin Console restart after installing,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; :install com.tinkerpop hadoop-gremlin 3.0.0.M6
==&gt;loaded: [com.tinkerpop, hadoop-gremlin, 3.0.0.M6] - restart the console to use [tinkerpop.hadoop]
gremlin&gt; :q
$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; :plugin use tinkerpop.hadoop
==&gt;tinkerpop.hadoop activated
gremlin&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties_files">Properties Files</h3>
<div class="paragraph">
<p><code>HadoopGraph</code> makes heavy use of properties files which ultimately get turned into Apache Configurations and Hadoop configurations. The properties file presented below is located at &#8216;conf/hadoop-kryo.properties&#8217;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">gremlin.graph=com.tinkerpop.gremlin.hadoop.structure.HadoopGraph
gremlin.hadoop.inputLocation=tinkerpop-classic-vertices.gio
gremlin.hadoop.graphInputFormat=com.tinkerpop.gremlin.hadoop.structure.io.kryo.KryoInputFormat
gremlin.hadoop.outputLocation=output
gremlin.hadoop.graphOutputFormat=com.tinkerpop.gremlin.hadoop.structure.io.kryo.KryoOutputFormat
gremlin.hadoop.memoryOutputFormat=org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat
gremlin.vertexProgram=com.tinkerpop.gremlin.process.computer.traversal.TraversalVertexProgram
gremlin.traversalVertexProgram.traversalSupplier.type=CLASS
gremlin.traversalVertexProgram.traversalSupplier.object=com.tinkerpop.gremlin.hadoop.process.computer.example.TraversalSupplier1
gremlin.hadoop.jarsInDistributedCache=true
gremlin.hadoop.deriveMemory=false
giraph.minWorkers=2
giraph.maxWorkers=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>A review of the properties above are presented in the table below.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:16%;">
<col style="width:83%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class of the graph to construct using GraphFactory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.inputLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the input file(s) for Hadoop-Gremlin to read the graph from.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphInputFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format that the graph input file(s) are represented in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.outputLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location to write the computed HadoopGraph to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphOutputFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format that the output file(s) should be represented in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.memoryOutputFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format of any resultant GraphComputer Memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.vertexProgram</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>VertexProgram</code> to distribute to all vertices in the <code>HadoopGraph</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.traversalVertexProgram.traversalSupplier.object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For TraversalVertexProgram, the location of the Gremlin traversal to use (if not using Gremlin Console).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.traversalVertexProgram.traversalSupplier.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the traversal supplier is a CLASS, SCRIPT, or OBJECT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.jarsInDistributedCache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to upload the Hadoop-Gremlin jars to Hadoop&#8217;s distributed cache (necessary if jars are not on machines' classpaths).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.deriveMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not <code>Memory</code> is yielded (requires an extra MapReduce job if true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">giraph.minWorkers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum number of parallel workers to execute the vertices of the graph (<code>GiraphGraphComputer</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">giraph.maxWorkers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of parallel workers to execute the vertices of the graph (<code>GiraphGraphComputer</code>).</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Along with the properties above, the numerous <a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml">Hadoop specific properties</a> can be added as needed to tune and parameterize the executed Hadoop-Gremlin job on the respective Hadoop cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_oltp_hadoop_gremlin">OLTP Hadoop-Gremlin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/hadoop-pipes.png" alt="hadoop-pipes" width="180"></span> It is possible to execute OLTP operations over a <code>HadoopGraph</code>. However, realize that the underlying HDFS files are typically not random access and thus, to retrieve a vertex, a linear scan is required. OLTP operations are useful for peeking at the graph prior to executing a long running OLAP job&#8201;&#8212;&#8201;e.g. <code>g.V().valueMap().limit(10)</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
OLTP operations on <code>HadoopGraph</code> are not efficient. They require linear scans to execute and are unreasonable for large graphs. In such large graph situations, make use of <a href="#traversalvertexprogram">TraversalVertexProgram</a> which is the OLAP implementation of the Gremlin language. Hadoop-Gremlin provides various <code>GraphComputer</code> implementations to execute OLAP computations over a <code>HadoopGraph</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">gremlin&gt; hdfs.copyFromLocal('data/tinkerpop-classic-vertices.gio', 'tinkerpop-classic-vertices.gio')
==&gt;null
gremlin&gt; hdfs.ls()
==&gt;rw-r--r-- marko supergroup 891 tinkerpop-classic-vertices.gio
gremlin&gt; g = GraphFactory.open('../../../hadoop-gremlin/conf/hadoop-kryo.properties')
==&gt;hadoopgraph[kryoinputformat-&gt;kryooutputformat]
gremlin&gt; g.V().count()
==&gt;6
gremlin&gt; g.V().out().out().values('name')
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().groupBy{it.get().value('name')[1]}{it.get().value('name')}.next()
==&gt;a={marko=1, vadas=1}
==&gt;e={peter=1}
==&gt;i={ripple=1}
==&gt;o={lop=1, josh=1}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_olap_hadoop_gremlin">OLAP Hadoop-Gremlin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/hadoop-furnace.png" alt="hadoop-furnace" width="180"></span> Hadoop-Gremlin was designed to execute OLAP operations via <code>GraphComputer</code>. The OLTP examples presented previously are reproduced below, but using <code>TraversalVertexProgram</code> for the execution of the Gremlin traversal.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
As of TinkerPop3 3.0.0.M6, when using Hadoop-Gremlin OLAP from the Gremlin Console, the only Gremlin language subset supported is Gremlin-Groovy. Future versions will support other Gremlin language dialects.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>Graph</code> in TinkerPop3 can support any number of <code>GraphComputer</code> implementations. HadoopGraph supports two GraphComputer implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GiraphGraphComputer</code>: Leverages Giraph to execute TinkerPop3 OLAP computations.</p>
<div class="ulist">
<ul>
<li>
<p>The graph must fit within the total RAM of the Hadoop cluster (graph size restriction). Messages passing is coordinated via ZooKeeper for the in-memory graph (speedy traversals).</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>MapReduceGraphComputer</code>: Leverages Hadoop&#8217;s MapReduce to execute TinkerPop3 OLAP computations. (<strong>coming soon</strong>)</p>
<div class="ulist">
<ul>
<li>
<p>The graph must fit within the total disk space of the Hadoop cluster (supports massive graphs). Message passing is coordinates via MapReduce jobs on the on-dks graph (slow traversals).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_giraphgraphcomputer">GiraphGraphComputer</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/giraph-logo.png" alt="giraph-logo" width="100"></span> <a href="http://giraph.apache.org">Giraph</a> is an Apache Foundation project focused on OLAP-based graph processing. Giraph makes use of the distributed graph computing paradigm made popular by Google&#8217;s Pregel. In Giraph, developers write "vertex programs" that get executed at each vertex in parallel. These programs communicate with one another in a bulk synchronous parallel (BSP) manner. This model aligns with TinkerPop3&#8217;s <code>GraphComputer</code> API. TinkerPop3 provides an implementation of <code>GraphComputer</code> that works for Giraph called <code>GiraphGraphComputer</code>. Moreover, with TinkerPop3&#8217;s <a href="#mapreduce">MapReduce</a>-framework, the standard Giraph/Pregel model is extended to support an arbitrary number of MapReduce phases to aggregate and yield results from the graph. Below are examples using <code>GiraphGraphComputer</code> from the <a href="#gremlin-console">Gremlin-Console</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Be sure that the <a href="http://www.slf4j.org/">SLF4J</a> of Hadoop matches that of Giraph or else there will be conflicts. Simply copy the following jars to the <code>lib/</code> of the machines in the Hadoop cluster: <code>slf4j-api-a.b.c.jar</code> and <code>slf4j-log4j12-a.b.c.jar</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Giraph uses a large number of Hadoop counters. The default for Hadoop is 120. In <code>mapred-site.xml</code> it is possible to increase the limit it via the <code>mapreduce.job.counters.limit</code> property. A good value to use is 1000. This is a cluster-wide property so be sure to restart the cluster after updating.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The maximum number of workers can be no larger than the number of map-slots in the Hadoop cluster minus 1. For example, if the Hadoop cluster has 4 map slots, then <code>giraph.maxWorkers</code> can not be larger than 3. One map-slot is reserved for the master compute node and all other slots can be allocated as workers to execute the VertexPrograms on the vertices of the graph.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">gremlin&gt; :remote connect tinkerpop.hadoop ../../../hadoop-gremlin/conf/hadoop-kryo.properties
==&gt;hadoopgraph[kryoinputformat-&gt;kryooutputformat]
gremlin&gt; :&gt; g.V().count()
INFO  com.tinkerpop.gremlin.hadoop.process.computer.giraph.GiraphGraphComputer  - HadoopGremlin(Giraph): TraversalVertexProgram[HadoopGraphStep(vertex), CountStep, SideEffectCapStep]
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0037
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
INFO  com.tinkerpop.gremlin.hadoop.structure.HadoopGraph  - HadoopGremlin: CountMapReduce
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0038
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
==&gt;6
gremlin&gt; :&gt; g.V().out().out().values('name')
INFO  com.tinkerpop.gremlin.giraph.process.computer.giraph.GiraphGraphComputer  - HadoopGremlin(Giraph): TraversalVertexProgram[HadoopGraphStep(vertex), VertexStep(OUT), VertexStep(OUT), ElementValueStep(name)]
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0031
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
INFO  com.tinkerpop.gremlin.hadoop.structure.HadoopGraph  - HadoopGremlin: TraversalResultMapReduce
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0032
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
==&gt;ripple
==&gt;lop
gremlin&gt; :&gt; g.V().groupBy('a'){it.get().value('name')[1]}{it.get().value('name')}
INFO  com.tinkerpop.gremlin.giraph.process.computer.giraph.GiraphGraphComputer  - HadoopGremlin(Giraph): TraversalVertexProgram[HadoopGraphStep(vertex), GroupByStep@a, SideEffectCapStep(a)]
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0039
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
INFO  com.tinkerpop.gremlin.hadoop.structure.HadoopGraph  - HadoopGremlin: GroupByMapReduce[a]
INFO  org.apache.hadoop.mapred.JobClient  - Running job: job_201407281259_0040
INFO  org.apache.hadoop.mapred.JobClient  -  map 0% reduce 0%
...
==&gt;[a:[marko, vadas], e:[peter], i:[ripple], o:[lop, josh]]
gremlin&gt; result
==&gt;result[hadoopgraph[kryoinputformat-&gt;kryooutputformat],memory[size:1]]
gremlin&gt; result.memory.runtime
==&gt;20356
gremlin&gt; result.memory.keys()
==&gt;a
gremlin&gt; result.memory.a
==&gt;a={marko=1, vadas=1}
==&gt;e={peter=1}
==&gt;i={ripple=1}
==&gt;o={lop=1, josh=1}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Distributed graph computations on cluster-sized graphs can yield an enormous number of results. To be safe, Hadoop-Gremlin only returns up to 20 results to the console (with, of course, all the results being available in HDFS). If more traversal results are desired, access <code>result.memory().get(Graph.System.system('traversers'))</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="images/gremlin-sugar.png" alt="gremlin-sugar" width="50"></span> For those wanting to use the <a href="#sugar-plugin">SugarPlugin</a> with their submitted traversal, do <code>:remote config useSugar true</code> as well as <code>:plugin use tinkerpop.sugar</code> at the start of the Gremlin Console session if it is not already activated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>TraversalSupplier1</code> class mentioned in the <code>hadoop-kryo.properties</code> file is distributed with Hadoop-Gremlin. It declares what Gremlin-Java traversal to execute on the loaded <code>HadoopGraph</code>. This is the means by which traversals can be programmatically executed in Hadoop-Gremlin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="comment">// gremlin.traversalVertexProgram.traversalSupplier.type=CLASS</span>
<span class="comment">// gremlin.traversalVertexProgram.traversalSupplier.object=com.tinkerpop.gremlin.hadoop.process.computer.example.TraversalSupplier1</span>

<span class="directive">public</span> <span class="type">class</span> <span class="class">TraversalSupplier1</span> <span class="directive">implements</span> SSupplier&lt;Traversal&gt; {
    <span class="directive">public</span> Traversal get() {
        <span class="keyword">return</span> HadoopGraph.open().V().out().out().values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mapreducegraphcomputer">MapReduceGraphComputer</h4>
<div class="paragraph">
<p><strong>COMING SOON</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interacting_with_hdfs">Interacting with HDFS</h3>
<div class="paragraph">
<p>The distributed file system of Hadoop is called <a href="http://en.wikipedia.org/wiki/Apache_Hadoop#Hadoop_distributed_file_system">HDFS</a>. The results of any OLAP operation are stored in HDFS accessible via <code>hdfs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">gremlin&gt; hdfs.ls()
==&gt;rwxr-xr-x marko supergroup 0 (D) output
==&gt;rw-r--r-- marko supergroup 891 tinkerpop-classic-vertices.gio
gremlin&gt; hdfs.ls('output')
==&gt;rwxr-xr-x marko supergroup 0 (D) a
==&gt;rwxr-xr-x marko supergroup 0 (D) ^g
gremlin&gt; hdfs.ls('output/a')
==&gt;rw-r--r-- marko supergroup 0 _SUCCESS
==&gt;rwxr-xr-x marko supergroup 0 (D) _logs
==&gt;rw-r--r-- marko supergroup 332 part-r-00000
gremlin&gt; hdfs.head('output/a',ObjectWritable.class)
==&gt;a        {marko=1, vadas=1}
==&gt;e        {peter=1}
==&gt;i        {ripple=1}
==&gt;o        {lop=1, josh=1}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of the HDFS methods available are itemized below. Note that these methods are also available for the <em>local</em> variable:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:56%;">
<col style="width:43%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.ls(String path)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List the contents of the supplied directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.cp(String from, String to)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy the specified path to the specified path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.exists(String path)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the specified path exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.rm(String path)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove the specified path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.rmr(String path)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove the specified path and its contents recurssively.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.copyToLocal(String from, String to)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy the specified HDFS path to the specified local path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.copyFromLocal(String from, String to)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy the specified local path to the specified HDFS path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.mergeToLocal(String from, String to)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merge the files in path to the specified local path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.head(String path)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text display the data in the path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.head(String path, long lineCount)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text display only the first <code>totalKeyValues</code> in the path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdfs.head(String path, long totalKeyValues, Class&lt;Writable&gt; writableClass)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the path interpreting the key values as respective writable.</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_a_command_line_example">A Command Line Example</h3>
<div class="imageblock">
<div class="content">
<img src="images/pagerank-logo.png" alt="pagerank logo" width="300">
</div>
</div>
<div class="paragraph">
<p>The classic <a href="http://en.wikipedia.org/wiki/PageRank">PageRank</a> centrality algorithm can be executed over TinkerPop classic from the command line using <code>GiraphGraphComputer</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The extension <code>ldjson</code> in <code>hadoop-graphson.properties</code> refers to <a href="http://en.wikipedia.org/wiki/Line_Delimited_JSON">line-delimitated JSON</a> which is the file format used by <code>GraphSONWriter</code> when writing an <a href="http://en.wikipedia.org/wiki/Adjacency_list">adjacency list</a> representation of a graph.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">$ hadoop fs -copyFromLocal data/tinkerpop-classic-vertices.ldjson tinkerpop-classic-vertices.ldjson
$ hadoop fs -ls
Found 2 items
-rw-r--r--   1 marko supergroup       2356 2014-07-28 13:00 /user/marko/tinkerpop-classic-vertices.ldjson
$ hadoop jar target/hadoop-gremlin-3.0.0.M6-job.jar com.tinkerpop.gremlin.hadoop.process.computer.giraph.GiraphGraphComputer conf/hadoop-graphson.properties
14/07/29 12:08:27 INFO giraph.GiraphGraphComputer: HadoopGremlin(Giraph): PageRankVertexProgram[alpha=0.85,iterations=30]
14/07/29 12:08:28 INFO mapred.JobClient: Running job: job_201407281259_0041
14/07/29 12:08:29 INFO mapred.JobClient:  map 0% reduce 0%
14/07/29 12:08:51 INFO mapred.JobClient:  map 66% reduce 0%
14/07/29 12:08:52 INFO mapred.JobClient:  map 100% reduce 0%
14/07/29 12:08:54 INFO mapred.JobClient: Job complete: job_201407281259_0041
14/07/29 12:08:54 INFO mapred.JobClient: Counters: 57
14/07/29 12:08:54 INFO mapred.JobClient:   Map-Reduce Framework
14/07/29 12:08:54 INFO mapred.JobClient:     Spilled Records=0
14/07/29 12:08:54 INFO mapred.JobClient:     Map input records=3
14/07/29 12:08:54 INFO mapred.JobClient:     SPLIT_RAW_BYTES=132
14/07/29 12:08:54 INFO mapred.JobClient:     Map output records=0
14/07/29 12:08:54 INFO mapred.JobClient:     Total committed heap usage (bytes)=347602944
14/07/29 12:08:54 INFO mapred.JobClient:   Giraph Timers
14/07/29 12:08:54 INFO mapred.JobClient:     Shutdown (milliseconds)=385
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 1 (milliseconds)=89
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 23 (milliseconds)=28
14/07/29 12:08:54 INFO mapred.JobClient:     Input superstep (milliseconds)=1127
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 27 (milliseconds)=30
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 10 (milliseconds)=34
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 5 (milliseconds)=43
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 22 (milliseconds)=31
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 14 (milliseconds)=35
14/07/29 12:08:54 INFO mapred.JobClient:     Total (milliseconds)=4023
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 2 (milliseconds)=50
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 18 (milliseconds)=29
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 11 (milliseconds)=35
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 24 (milliseconds)=32
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 28 (milliseconds)=32
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 15 (milliseconds)=34
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 6 (milliseconds)=37
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 19 (milliseconds)=31
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 25 (milliseconds)=27
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 8 (milliseconds)=33
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 12 (milliseconds)=44
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 20 (milliseconds)=31
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 16 (milliseconds)=31
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 9 (milliseconds)=36
14/07/29 12:08:54 INFO mapred.JobClient:     Setup (milliseconds)=1119
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 3 (milliseconds)=50
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 7 (milliseconds)=38
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 13 (milliseconds)=36
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 29 (milliseconds)=37
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 26 (milliseconds)=40
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 0 (milliseconds)=293
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 21 (milliseconds)=46
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 17 (milliseconds)=32
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep 4 (milliseconds)=39
14/07/29 12:08:54 INFO mapred.JobClient:   File Input Format Counters
14/07/29 12:08:54 INFO mapred.JobClient:     Bytes Read=0
14/07/29 12:08:54 INFO mapred.JobClient:   Giraph Stats
14/07/29 12:08:54 INFO mapred.JobClient:     Aggregate finished vertices=0
14/07/29 12:08:54 INFO mapred.JobClient:     Aggregate edges=0
14/07/29 12:08:54 INFO mapred.JobClient:     Sent messages=6
14/07/29 12:08:54 INFO mapred.JobClient:     Current workers=2
14/07/29 12:08:54 INFO mapred.JobClient:     Last checkpointed superstep=0
14/07/29 12:08:54 INFO mapred.JobClient:     Current master task partition=0
14/07/29 12:08:54 INFO mapred.JobClient:     Superstep=30
14/07/29 12:08:54 INFO mapred.JobClient:     Aggregate vertices=6
14/07/29 12:08:54 INFO mapred.JobClient:   FileSystemCounters
14/07/29 12:08:54 INFO mapred.JobClient:     HDFS_BYTES_READ=2488
14/07/29 12:08:54 INFO mapred.JobClient:     FILE_BYTES_WRITTEN=250470
14/07/29 12:08:54 INFO mapred.JobClient:     HDFS_BYTES_WRITTEN=2719
14/07/29 12:08:54 INFO mapred.JobClient:   Job Counters
14/07/29 12:08:54 INFO mapred.JobClient:     Launched map tasks=3
14/07/29 12:08:54 INFO mapred.JobClient:     SLOTS_MILLIS_REDUCES=0
14/07/29 12:08:54 INFO mapred.JobClient:     Total time spent by all reduces waiting after reserving slots (ms)=0
14/07/29 12:08:54 INFO mapred.JobClient:     SLOTS_MILLIS_MAPS=31907
14/07/29 12:08:54 INFO mapred.JobClient:     Total time spent by all maps waiting after reserving slots (ms)=0
14/07/29 12:08:54 INFO mapred.JobClient:   File Output Format Counters
14/07/29 12:08:54 INFO mapred.JobClient:     Bytes Written=0
$ hadoop fs -cat output/^g/*
{&quot;inE&quot;:[],&quot;outE&quot;:[{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:9,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:0.4}},{&quot;inV&quot;:2,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:7,&quot;label&quot;:&quot;knows&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:0.5}},{&quot;inV&quot;:4,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:8,&quot;label&quot;:&quot;knows&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:1.0}}],&quot;id&quot;:1,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:3.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.15000000000000002,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:0,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;marko&quot;,&quot;properties&quot;:{}}],&quot;age&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;age&quot;,&quot;value&quot;:29,&quot;properties&quot;:{}}]}}
{&quot;inE&quot;:[{&quot;inV&quot;:5,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:10,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:4,&quot;properties&quot;:{&quot;weight&quot;:1.0}}],&quot;outE&quot;:[],&quot;id&quot;:5,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:0.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.23181250000000003,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:8,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;ripple&quot;,&quot;properties&quot;:{}}],&quot;lang&quot;:[{&quot;id&quot;:9,&quot;label&quot;:&quot;lang&quot;,&quot;value&quot;:&quot;java&quot;,&quot;properties&quot;:{}}]}}
{&quot;inE&quot;:[{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:9,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:0.4}},{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:11,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:4,&quot;properties&quot;:{&quot;weight&quot;:0.4}},{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:12,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:6,&quot;properties&quot;:{&quot;weight&quot;:0.2}}],&quot;outE&quot;:[],&quot;id&quot;:3,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:0.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.4018125,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:4,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;lop&quot;,&quot;properties&quot;:{}}],&quot;lang&quot;:[{&quot;id&quot;:5,&quot;label&quot;:&quot;lang&quot;,&quot;value&quot;:&quot;java&quot;,&quot;properties&quot;:{}}]}}
{&quot;inE&quot;:[{&quot;inV&quot;:4,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:8,&quot;label&quot;:&quot;knows&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:1.0}}],&quot;outE&quot;:[{&quot;inV&quot;:5,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:10,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:4,&quot;properties&quot;:{&quot;weight&quot;:1.0}},{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:11,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:4,&quot;properties&quot;:{&quot;weight&quot;:0.4}}],&quot;id&quot;:4,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:2.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.19250000000000003,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:6,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;josh&quot;,&quot;properties&quot;:{}}],&quot;age&quot;:[{&quot;id&quot;:7,&quot;label&quot;:&quot;age&quot;,&quot;value&quot;:32,&quot;properties&quot;:{}}]}}
{&quot;inE&quot;:[{&quot;inV&quot;:2,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:7,&quot;label&quot;:&quot;knows&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:1,&quot;properties&quot;:{&quot;weight&quot;:0.5}}],&quot;outE&quot;:[],&quot;id&quot;:2,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:0.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.19250000000000003,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:2,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;vadas&quot;,&quot;properties&quot;:{}}],&quot;age&quot;:[{&quot;id&quot;:3,&quot;label&quot;:&quot;age&quot;,&quot;value&quot;:27,&quot;properties&quot;:{}}]}}
{&quot;inE&quot;:[],&quot;outE&quot;:[{&quot;inV&quot;:3,&quot;inVLabel&quot;:&quot;vertex&quot;,&quot;outVLabel&quot;:&quot;vertex&quot;,&quot;id&quot;:12,&quot;label&quot;:&quot;created&quot;,&quot;type&quot;:&quot;edge&quot;,&quot;outV&quot;:6,&quot;properties&quot;:{&quot;weight&quot;:0.2}}],&quot;id&quot;:6,&quot;label&quot;:&quot;vertex&quot;,&quot;type&quot;:&quot;vertex&quot;,&quot;properties&quot;:{&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:1,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.edgeCount&quot;,&quot;value&quot;:1.0,&quot;properties&quot;:{}}],&quot;~gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:30,&quot;label&quot;:&quot;~gremlin.pageRankVertexProgram.pageRank&quot;,&quot;value&quot;:0.15000000000000002,&quot;properties&quot;:{}}],&quot;name&quot;:[{&quot;id&quot;:10,&quot;label&quot;:&quot;name&quot;,&quot;value&quot;:&quot;peter&quot;,&quot;properties&quot;:{}}],&quot;age&quot;:[{&quot;id&quot;:11,&quot;label&quot;:&quot;age&quot;,&quot;value&quot;:35,&quot;properties&quot;:{}}]}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vertex 4 ("josh") is isolated below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="js language-js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:[
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:[
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outVLabel</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">edge</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vertex</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:
    {
     <span class="key"><span class="delimiter">&quot;</span><span class="content">~gremlin.pageRankVertexProgram.edgeCount</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">~gremlin.pageRankVertexProgram.edgeCount</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="float">2.0</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{}}],
     <span class="key"><span class="delimiter">&quot;</span><span class="content">~gremlin.pageRankVertexProgram.pageRank</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">30</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">~gremlin.pageRankVertexProgram.pageRank</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="float">0.19250000000000003</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{}}],
     <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{}}],
     <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">32</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{}}]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="conclusion" class="sect0">Conclusion</h1>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/tinkerpop-character.png" alt="tinkerpop-character" width="100"></span> The world that we know, you and me, is but a subset of the world that Gremlin has weaved within The TinkerPop. Gremlin has constructed a fully connected graph and only the subset that makes logical sense to our traversing thoughts is the fragment we have come to know and have come to see one another within. But there are many more out there, within other webs of logics unfathomed. From any thought, every other thought, we come to realize that which is&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
<h1 id="tinkerpop-contributors" class="sect0">TinkerPop Contributors</h1>
<div class="paragraph">
<p>TinkerPop is a group of graph developers and vendors committed to providing a vendor-agnostic graph computing abstraction in support of technology interoperability.</p>
</div>
<div class="sect1">
<h2 id="_graph_developers">Graph Developers</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:29%;">
<col style="width:58%;">
<col style="width:11%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://markorodriguez.com">Marko A. Rodriguez</a> (2009)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TinkerPop co-founder and creator and developer of Gremlin.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://se.linkedin.com/in/neubauer">Peter Neubauer</a> (2009)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TinkerPop co-founder and Neo Technology representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://neo4j.org"><strong>Neo4j</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fortytwo.net">Joshua Shinavier</a> (2009)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TinkerPop co-founder and full-stack developer.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://ketrinayim.com">Ketrina Yim</a> (2009)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TinkerPop cartoonist and logo designer.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://stephen.genoprime.com/">Stephen Mallette</a> (2011)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary developer on every aspect of TinkerPop.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.linkedin.com/in/pierredewilde">Pierre De Wilde</a> (2011)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Documentation support and evangelist.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://github.com/pangloss">Derrick Wiebe</a> (2011)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creator of Pacer and Gremlin traversal developer.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://about.me/luca.garulli">Luca Garulli</a> (2012)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orient Technologies representative and Gremlin structure theorist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.orientechnologies.com/orientdb/"><strong>OrientDB</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.matthiasb.com">Matthias Brcheler</a> (2012)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aurelius representative and full-stack theorist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://titan.thinkaurelius.com"><strong>Titan</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://jglue.org">Bryn Cooke</a> (2013)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin domain specific language theorist.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://jamesthornton.com">James Thornton</a> (2013)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creator of Bulbs and TinkerPop evangelist.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://lambdazen.blogspot.com">Sridhar Ramachandran</a> (2013)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lambda Zen representative and Gremlin traversal theorist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://bitbucket.org/lambdazen/bitsy/wiki/Home"><strong>Bitsy</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.linkedin.com/pub/nick-quinn/3/ab4/a56/">Nicholas Quinn</a> (2013)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Objectivity representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.objectivity.com/infinitegraph"><strong>InfiniteGraph</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.linkedin.com/pub/xavier-sanchez/84/5b8/804">Xavier Sanchez</a> (2013)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sparsity Technologies representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.sparsity-technologies.com/#sparksee"><strong>Sparksee</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://twitter.com/dkuppitz">Daniel Kuppitz</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin traversal theorist and public technology support.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.michaelpollmeier.com">Michael Pollmeier</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin-Scala creator and traversal theorist.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://twitter.com/jbmusso">Jean-Baptiste Musso</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin-JavaScript creator.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bobbriody.com">Bob Briody</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin dashboard creator.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bigdata.com">Mike Personick</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bigdata representative and OLAP theorist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bigdata.com"><strong>Bigdata</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://twitter.com/mchacki">Michael Hackstein</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ArangoDB representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://arangodb.org"><strong>ArangoDB</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://github.com/MMcM">Michael McMahon</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FoundationDB representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://foundationdb.com"><strong>FoundationDB</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.linkedin.com/pub/ryan-webb/39/23a/ab8">Ryan Webb</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Johns Hopkins Applied Physics Laboratory representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/JHUAPL/AccumuloGraph"><strong>AccumuloGraph</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.linkedin.com/in/averyching">Avery Ching</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Giraph representative and OLAP theorist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://giraph.apache.org"><strong>Giraph</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://clarkparsia.com/about/profiles/kendall">Kendall Clark</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clark &amp; Parsia representative.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://stardog.com"><strong>Stardog</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://clarkparsia.com/about/profiles/mgrove">Michael Grove</a> (2014)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gremlin developer.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sect1">
<h2 id="_graph_vendors">Graph Vendors</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://arangodb.com"><img src="images/arangodb-logo.png" alt="arangodb-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://thinkaurelius.com"><img src="images/aurelius-logo.png" alt="aurelius-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://bigdata.com"><img src="images/bigdata-logo.png" alt="bigdata-logo" width="220"></a></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://clarkparsia.com"><img src="images/clark-and-parsia-logo.png" alt="clark-and-parsia-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="https://foundationdb.com"><img src="images/foundationdb-logo.png" alt="foundationdb-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://giraph.apache.org"><img src="images/apache-giraph-logo.png" alt="apache-giraph-logo" width="220"></a></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://www.jhuapl.edu"><img src="images/jhapl-logo.png" alt="jhapl-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://lambdazen.blogspot.com"><img src="images/lambda-zen-logo.png" alt="lambda-zen-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://neotechnology.com"><img src="images/neotechnology-logo.png" alt="neotechnology-logo" width="220"></a></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://www.objectivity.com"><img src="images/objectivity-logo.png" alt="objectivity-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://www.orientechnologies.com"><img src="images/orientechnologies-logo.png" alt="orientechnologies-logo" width="220"></a></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><a class="image" href="http://www.sparsity-technologies.com"><img src="images/sparsity-technologies-logo.png" alt="sparsity-technologies-logo" width="220"></a></span></p></td>
</tr>
</tbody>
</table>

</div>
</div>
<h1 id="acknowledgements" class="sect0">Acknowledgements</h1>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="images/yourkit-logo.png" alt="yourkit-logo" width="200"></span> YourKit supports the TinkerPop open source project with its full-featured Java Profiler. YourKit, LLC is the creator of innovative and intelligent tools for profiling Java and .NET applications. YourKit&#8217;s leading software products: <a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a> and <a href="http://www.yourkit.com/.net/profiler/index.jsp">YourKit .NET Profiler</a></p>
</div>
<div class="paragraph">
<p>&#8230;in the beginning.</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-12-02 08:30:59 MST
</div>
</div>
</body>
</html>